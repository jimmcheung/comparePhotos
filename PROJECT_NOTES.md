# PhotoCompare 项目需求与变更记录

## 1. 功能需求与设定

- **多图对比**：支持同时上传2-5张图片，进行细节对比。
- **同步缩放/平移**：任意图片的缩放、平移操作可同步到其他图片（可开关）。
- **EXIF 信息显示**：展示图片的相机型号、镜头、参数等EXIF信息。
- **深色/浅色主题切换**：支持主题切换。
- **演示模式**：全屏展示，适合录屏和演示。
- **响应式设计**：适配各种设备。
- **图片懒加载**：优化性能。
- **本地存储用户偏好**。
- **截图功能**：支持一键截取当前界面并自动下载，使用dom-to-image直接将DOM转换为图片，无需用户授权，保持界面完整性和视觉效果，文件名包含相机信息和时间戳。
- **标注功能**（即将开发）：支持对图片进行矩形、圆形、画笔等标注，标注可编辑、删除、同步、导出。
  - 标注开关和同步开关仅在图片上传后出现。
  - 标注开关开启时可绘制，关闭时可拖动图片，绘制内容随图片移动缩放。
  - 同步开关开启时绘制同步到所有图片，关闭时仅当前图片。
  - 工具栏风格参考iPadOS备忘录，支持矩形、圆形、画笔、三种粗细、五种预设色、自定义调色板、清空。
  - 工具栏可拖动，带优雅动画，标注开关开启时显示，关闭时隐藏。
  - 绘制采用SVG，保证缩放清晰度。
  - 支持撤销/重做（快捷键实现，无需界面按钮）。
  - 支持移动端触控适配。
  - 标注可编辑，需有选中按钮，操作风格类似Figma。
- **标注工具栏美化与交互细节**（已实现 iPadOS 备忘录风格）
  - 工具栏为横向浮动，极大圆角（两端完整半圆），毛玻璃磨砂背景，柔和阴影。
  - 工具/粗细/颜色/清空分组横向排列，按钮更大更圆润。
  - 工具/颜色/粗细选中有高亮外圈和阴影，动画优雅。
  - 拖动区已去除，整个工具栏空白区域都可拖动。
  - 画笔icon为拟真毛笔/涂鸦风格，调色盘icon为色盘，选中后中间显示当前色。
  - 清空按钮为垃圾桶icon，风格统一，无红色文字。
  - 工具栏初始位置为页面正中心偏下。
  - 工具栏出现动画为向上浮现，关闭时为向下淡出，整体更有"浮现感"。
  - 工具栏背景为完整的超大圆角矩形，内容有足够内边距，按钮不贴边，整体悬浮感强。
  - "更多颜色"按钮点击后弹出独立的色板弹窗，支持色板选择和色值输入，弹窗风格与工具栏一致，定位在调色盘icon下方。

## 2. 重要修改与修复方向

- **EXIF信息丢失修复**：所有图片上传/添加都必须统一调用`processImageFile`，保证EXIF信息正确提取和显示。
- **ImageInfo类型结构统一**：全局加上`file?: File`字段，类型安全一致。
- **关于弹窗GitHub链接修正**：所有关于信息弹窗中的GitHub仓库链接需指向 https://github.com/jimmcheung/photoCompare。
- **版本号管理**：所有涉及版本号的地方（页面、弹窗、README等）需同步更新。
- **每次功能/修复都需同步更新README和更新日志**。

## 3. 你的开发意图与偏好

- 代码风格要求简洁、无冗余、全局一致。
- 修改时要全局考虑，不要只改单点。
- 需求和设定要有文档记录，方便AI或新开发者快速理解。

## 4. AI助手开发约束（全局约束）

1. **全局考虑**  
   每次代码修改都要考虑对整个项目的影响，不能只改单点，需保证全局一致性和兼容性。

2. **精简代码结构**  
   代码实现要简洁、清晰，避免重复和冗余，能复用的逻辑尽量复用。

3. **不影响其他功能**  
   新增或修改功能时，必须保证现有功能的正常运行，不引入回归bug。

4. **不破坏CSS样式和视觉效果**  
   所有UI相关修改都要保证页面视觉风格、布局、响应式和交互体验不被破坏。

5. **不造成冗余功能和冗余代码**  
   禁止引入无用的功能、变量、组件、样式等，保持项目整洁。

## 3. 未来优化与待办事项

- **移动端标注体验优化**（待实现）
  - 标注绘制、选中、拖动、删除等操作在移动端（触摸屏）下流畅可用。
  - 工具栏、SVG 标注层、交互区域响应式适配。
  - 触摸事件兼容 pointer 事件，支持手指绘制和拖动标注。
  - 防止页面滚动穿透、误触、工具栏遮挡等。
  - 测试 iOS/Android 下的绘制、拖动、删除等操作流畅性，必要时增加兼容性处理。

### 2024-06-XX 标注同步与动画体验优化补充

- 同步标注模式下，采用全局唯一drawing状态，所有图片都渲染同一个物理坐标的drawing，pointer事件只在发起绘制的图片上处理，所有图片都能实时看到同一物理位置的绘制过程和结果。坐标换算、缩放、平移、标注等均以图片原始像素为基准，保证对比体验极致。优化结构不影响其他功能。
- 工具栏动画需严格保证出现时向上浮现、消失时向下淡出，动画完整播放后再卸载。
- 以上所有细节优化、交互修复、视觉统一等，均需全局考虑、结构精简、对标高标准，严格按AI开发约束推进。

### 2024-06-XX 标注工具栏与交互体验升级

1. 工具栏视觉与交互优化
   - 工具栏整体风格更现代，分组清晰，圆角、阴影、动画体验优化。
   - 工具栏初始位置居中偏下，支持拖动，拖动后记忆位置。
   - 工具栏所有按钮均为正圆，icon大小统一，内容居中。
   - 清空按钮初始无红色外圈，仅在 hover/focus 时显示红色高亮。

2. 颜色选择与弹窗
   - 预置颜色按钮中间的颜色圆形放大为25px，视觉更突出。
   - "更多颜色"按钮 icon 更换为极简色轮（SVG），尺寸可调，视觉更美观。
   - "更多颜色"弹窗用 Portal 渲染，定位更智能，优先显示在按钮上方，间距可调，始终可见。
   - 弹窗内可用色板和输入色值，选中后 customColor 和 annotationColor 同步。
   - 色板弹窗拖动选色时不会再误触发工具栏拖动，体验更自然。

3. 线宽选择全新交互
   - 线宽选择由多个按钮改为一个按钮，点击后弹出纵向排列的线宽菜单（Portal弹窗）。
   - 线宽菜单弹窗圆角加大（25px），风格与色板弹窗一致。
   - 线宽icon由不同粗细的正弦波SVG表示，振幅固定，所有线宽视觉统一。
   - 线宽icon默认黑色，hover/选中时为蓝色，按钮默认无外圈，hover/选中时显示高亮外圈。
   - 线宽菜单支持点击外部自动关闭，交互体验与下拉菜单一致。

4. 默认状态与交互细节
   - 开启标注时，默认颜色为红色（#FF3B30），线宽为中间值（4）。
   - 工具栏所有交互细节、视觉高亮、动画均与iPadOS备忘录风格对齐。
   - 代码结构更精简，所有弹窗均用 Portal 渲染，彻底避免父级样式干扰。

5. 体验与兼容性
   - 交互体验高度专业化，所有细节均有文档记录。
   - 代码结构精简，易于维护和扩展。
   - 兼容主流浏览器，移动端适配良好。

- 预置颜色按钮icon需为正圆，视觉统一。
- 点击"更多颜色"icon应弹出色盘弹窗。
- 清空按钮icon需为圆形外圈风格。
- 工具按钮（矩形、圆形、画笔、粗细）选中高亮时，图形需为统一大小的圆形。
- 绘制时，正在绘制的图形不能闪烁，需流畅。
- 关闭标注后应恢复图片拖动。
- 图片与绘制内容缩放需完全同步，不能有缓动差异。
- 以上所有细节优化、交互修复、视觉统一等，均需全局考虑、结构精简、对标高标准，不影响其他功能，严格按AI开发约束推进。

### 2024-06-XX 同步缩放/同步标注统一开关方案

- 设计决策：界面只保留一个"同步"开关（syncZoom），用户无需区分"同步缩放"和"同步标注"，极简体验。
- 技术实现：
  - 移除 annotationStore 中的 isSyncAnnotate/setSyncAnnotate 字段及相关逻辑。
  - ImageViewer 及所有同步相关逻辑全部依赖 useSettingsStore 的 syncZoom 状态。
  - 只要 syncZoom 开启，图片的缩放、平移、标注绘制都同步；关闭则全部独立。
- 优点：
  - 用户界面极简，只有一个同步开关。
  - 代码结构更清晰，所有同步相关逻辑都依赖同一个全局状态。
  - 满足"同步"开关一键控制所有同步体验的需求。

### 2024-06-XX 色板弹窗拖动冲突修复

- 问题：色板弹窗拖动选色时会导致整个工具栏一起拖动，严重影响体验。
- 原因：工具栏拖动监听了整个区域的 pointerdown，色板弹窗事件冒泡导致误触发。
- 解决方案：在色板弹窗根节点加 onPointerDown={e => e.stopPropagation()}，彻底阻止事件冒泡，保证色板拖动与工具栏拖动互不干扰。
- 优点：实现极简，结构清晰，不影响其他功能和交互。

### 2024-06-XX 标记（标注）功能设计与交互细节

1. 工具栏与标注工具
   - 工具栏初始位置：页面居中偏下，支持任意方向拖动，拖动后记忆位置。
   - 工具栏分组：形状（矩形、圆形、画笔）、线宽、颜色、清空，分割线明显。
   - 所有按钮：正圆，icon大小统一，内容居中，视觉呼吸感强。
   - 按钮高亮：选中时有高亮外圈，hover时有浅色外圈，未选中无外圈。
   - 清空按钮：初始无红色外圈，仅hover/focus时显示红色高亮。

2. 标注形状与线宽
   - 支持形状：矩形、圆形、自由画笔。
   - 线宽选择：单按钮，点击弹出纵向菜单，三种线宽（2/4/8），icon为正弦波SVG，振幅固定，线宽不同视觉统一。
   - 线宽icon：默认黑色，hover/选中为蓝色，按钮默认无外圈，hover/选中时显示高亮外圈。
   - 线宽菜单：圆角25px，点击外部自动关闭。

3. 颜色选择
   - 预置颜色：红、黄、蓝，按钮中间色块为25px正圆。
   - 更多颜色：极简色轮SVG icon，尺寸可调，icon中间显示当前自定义色。
   - 色板弹窗：Portal渲染，优先显示在按钮上方，间距可调，始终可见。
   - 弹窗内容：色板+色值输入，选中后customColor和annotationColor同步。
   - 弹窗交互：拖动选色时不会误触发工具栏拖动，点击外部自动关闭。

4. 标注绘制与交互
   - 默认状态：开启标注时，默认颜色为红色（#FF3B30），线宽为中间值（4）。
   - 标注绘制：SVG实现，缩放时不失真，绘制流畅无闪烁。
   - 标注同步：同步开关控制所有图片的标注同步，关闭时各自独立。
   - 标注选中：点击标注后高亮显示，选中有高亮外圈。
   - 标注编辑：支持选中、拖动、删除，操作风格类似Figma。
   - 标注撤销/重做：支持快捷键撤销/重做，无需界面按钮。
   - 标注清空：点击清空按钮可一键删除所有标注。

5. 状态切换与视觉反馈
   - 工具栏出现/消失：带有向上浮现/向下淡出动画，动画完整播放后再卸载DOM。
   - 按钮状态：点击前无高亮，点击后高亮，hover时有浅色外圈，focus时同hover。
   - 颜色/线宽/形状切换：切换后按钮高亮，icon同步变化。
   - 清空按钮：hover/focus时显示红色高亮外圈，未选中无外圈。

6. 位置、大小、颜色等细节
   - 工具栏：高度72px，宽度自适应内容，极大圆角（999px），毛玻璃背景，阴影柔和。
   - 按钮：40×40px正圆，icon居中，内容不贴边。
   - 分割线：高度36px，宽1.5px，颜色rgba(120,120,140,0.18)，分组明显。
   - 色板弹窗：宽220px，圆角18px阴影柔和，内容居中。
   - 线宽菜单：宽48px，圆角25px，纵向排列，按钮32×32px。
   - 标注颜色：预置红#FF3B30、黄#FFD60A、蓝#007AFF，自定义色支持任意HEX。
   - 标注线宽：2/4/8三档，icon为正弦波，振幅固定，线宽不同视觉统一。

7. 其他体验细节
   - 所有弹窗均用Portal渲染，彻底避免父级样式干扰。
   - 所有交互细节、视觉高亮、动画均与iPadOS备忘录风格对齐。
   - 代码结构精简，易于维护和扩展。
   - 兼容主流浏览器，移动端适配良好。

### 2024-06-XX 标注文字与通用选择/移动/删除功能设计

- 工具栏最前面新增"选择/移动"工具（鼠标指针icon，快捷键V），选中后可选中、拖动、删除任意标注（包括文字）。
- 只有在Move模式下，才能选中、拖动、删除标注。其他工具为绘制模式，仅能新建标注。
- 选中标注后，外圈高亮，标注上方浮现删除按钮，点击或按Delete键可删除。
- 文字标注输入时支持多行（回车换行），失焦后提交内容，内容为空时自动删除。
- 文字支持三种字体大小，切换方式与线宽一致。
- 文字颜色与当前标注颜色同步，字体大小三档（如14/18/24px）。
- 选中状态、拖动、删除等交互风格与Figma一致，体验统一。
- 移动端可通过长按或工具栏切换进入Move模式。
- 数据结构与SVG渲染已设计，详见代码注释。

- 撤销/重做功能：
  - 支持所有标注（矩形、圆形、画笔、文字）的撤销与重做。
  - 每张图片的标注维护独立的撤销/重做栈，互不影响。
  - 同步模式下，撤销/重做会同步作用于所有图片，关闭同步时仅影响当前图片。
  - 支持快捷键操作：Ctrl+Z/Cmd+Z 撤销，Ctrl+Y/Cmd+Y 重做，Delete/Backspace 删除选中标注。
  - 文字标注的添加、移动、删除、内容编辑等操作均可撤销/重做，体验与其他类型一致。
  - 撤销/重做采用全量快照方式，保证操作安全、体验流畅。
  - 撤销/重做仅影响标注内容，不影响图片缩放、平移等操作。

## 2024-05-20 v1.1.2

- 优化截图功能实现，使用dom-to-image替代屏幕捕获API，提供更简单友好的用户体验
- 取消截图时的授权提示和弹窗，实现一键截图无干扰体验
- 精确截取主内容区域，保持原始比例和样式
- 修复截图中图片拉伸和EXIF信息错位问题，确保视觉效果与实际呈现完全一致
- 改进截图方案及代码结构，简化实现方式，移除冗余代码
- 改进截图体验，提供更明确的用户反馈和错误处理

## 2024-06-XX v1.1.1

- 优化截图功能实现，使用dom-to-image直接生成DOM截图，提供更简单友好的用户体验
- 取消截图时的授权提示和弹窗，实现一键截图无干扰体验
- 精确截取主内容区域，保持原始比例和样式
- 修复截图中图片拉伸和EXIF信息错位问题，确保视觉效果与实际呈现完全一致
- 改进截图体验，提供更明确的用户反馈和错误处理
- 新增截图功能，支持一键截取当前界面内容并自动下载保存
- 截图文件名包含相机信息和时间戳，格式为"照片对比_相机品牌型号_时间.png"
- 截图过程中自动隐藏控制按钮和界面元素，保持视觉简洁
- 显示设置面板交互体验升级，添加优雅的开关动画效果
- 显示设置面板在深色模式下的UI适配优化，确保文字在深浅两种模式下都有良好可读性
- 完善同步开关逻辑，确保缩放按钮点击时的同步效果一致
- 优化缩放控制按钮组的位置和样式，改善整体UI布局
- 修复EXIF信息在特定情况下的显示问题，主要/次要信息栏显示逻辑优化
- 完善深色模式下的所有视觉元素，确保一致的设计语言和用户体验
- 修复面板和弹窗动画过程中的交互问题，改善出现和消失动画流畅度

## 2024-05-19 v1.1.0

- 升级版本号至1.1.0，完成常规版本号升级。
- 同步更新 package.json、package-lock.json、scripts/version.js 等相关文件。
- 保证所有涉及版本号的地方（页面、弹窗、README等）已同步。
- 变更已提交至本地仓库。

## 2024-06-XX UI与显示设置相关生效变更

1. **图片缩放按钮组（1x/2x/5x）**
   - 位置：EXIF信息栏上方，居中横排。
   - 按钮：36px正圆，背景与EXIF栏一致（bg-white/80 dark:bg-gray-900/80），字体`font-medium whitespace-nowrap text-[13px]`。
   - 高亮时scale放大到1.22，背景不变，文字颜色更深灰（text-gray-700/dark:text-gray-200）。
   - 文字：只保留1位小数，整数不显示小数点。
   - 交互：点击切换缩放，区间高亮，手动缩放时自动取消高亮。

2. **缩放比例显示开关**
   - 已移入显示设置菜单底部，样式仿iOS系统设置，左侧文字右侧圆角滑块。
   - 仅开启时显示缩放按钮组。

3. **显示设置菜单结构优化（2024-06-XX）**
   - 一级标题：显示设置
   - 二级小标题：EXIF信息，右侧有全选勾选框（勾选为"全选"，未勾选为"不全选"）。
   - EXIF信息分为主要/次要两栏，顶部有"主要""次要"小字。
   - 主要信息字段如：文件名、分辨率、相机型号等；次要信息如：镜头型号、拍摄时间等。
   - 缩放比例显示开关在EXIF信息下方。
   - 后续新设置可直接扩展。

> 以上内容为2024-06-XX后本对话生效的UI/交互相关更改，所有未生效或已被覆盖的历史改动已过滤。

### 2024-06-XX HEIC/HEIF/RAW格式支持与前端解码试错总结

#### 需求与目标
- 支持HEIF/HEIC及主流厂商RAW格式文件上传与对比。
- 常规图片格式直接导入，HEIF/RAW格式需弹窗提示转换，用户可选输出格式和质量。
- 转换失败时直接报错，不生成占位图。
- EXIF信息提取：HEIC/RAW转换时不再提取EXIF，仅做格式转换。
- EXIF显示：空值/无效值（如0、Unknown、0s等）自动隐藏。

#### 试错与调研过程
- 前端尝试集成libraw.js、raw-wasm、Photopea/rawwasm、wasm-imaging、photon、peerigon/wasm-image、wasm-image-convert等WASM库，均因资源失效、功能不全或不支持RAW解码而放弃。
- 国内外镜像、jsdelivr等均无法获取可用rawwasm资源。
- 结论：目前无高质量、可用的前端RAW解码WASM库。
- 现有heic-to、libheif-js等可用于HEIC/HEIF前端解码，已集成。
- 后端解码方案需上传图片到服务器，前端本地无法实现高质量RAW解码。

#### 方案与实现
- HEIC/HEIF格式转换弹窗支持用户自定义输出格式（JPEG/PNG）和质量。
- 转换进度条与弹窗交互优化，体验与初始上传、重新上传、添加图片一致。
- 深色模式、设置项等支持localStorage持久化。
- 代码全局冗余清理，未使用依赖、调试输出、无用注释全部移除。
- 需求、试错、结论已补充至本文档，便于后续开发和维护。

> 本轮需求与试错信息已整理归档，后续如有新格式或新技术可随时补充。

## 5. 未来功能与优化建议

### 5.1 代码优化建议

1. **组件拆分**
   - 将大型组件如`App.tsx`(485行)、`ImageViewer.tsx`(1344行)和`SettingsBar.tsx`(477行)拆分为更小的独立组件
   - 将移动端侧边栏组件提取为单独文件`MobileSidebar.tsx`
   - 将标注工具栏相关UI组件模块化，便于维护和扩展

2. **TypeScript类型定义优化**
   - 确保所有类型定义清晰，特别是ImageInfo类型在全局范围的一致性
   - 建立统一的类型定义文件，集中管理所有接口和类型
   - 为函数参数和返回值添加完整类型注解

3. **代码重构与模式优化**
   - 应用更多函数式编程模式，提高代码复用
   - 优化状态管理结构，减少不必要的状态更新
   - 实现更严格的组件职责分离，遵循单一职责原则

### 5.2 功能增强建议

1. **滑动对比模式**
   - 添加Split View模式，允许用户通过拖动分隔线比较两张照片
   - 支持垂直和水平分割模式
   - 可调整分隔线位置和样式

2. **批处理功能**
   - 添加批量调整EXIF信息功能
   - 支持批量重命名和导出
   - 图片批量格式转换（如HEIC→JPG/PNG）

3. **历史记录功能**
   - 记录用户之前比较过的照片组
   - 支持保存和恢复比较会话
   - 提供收藏夹功能，保存常用比较组

4. **图像分析功能**
   - 添加直方图显示
   - 支持亮度/对比度/饱和度分析
   - 提供噪点和锐度分析工具

5. **增强标注功能**
   - 添加箭头、线段等更多标注形状
   - 支持图层管理（显示/隐藏/锁定）
   - 标注组合与分组功能

### 5.3 性能优化建议

1. **图片加载与渲染优化**
   - 优化大图片加载策略，使用更高效的懒加载方案如Intersection Observer API
   - 实现图片渐进式加载，优先加载低分辨率预览
   - 根据设备屏幕分辨率和性能调整图片显示质量

2. **Web Worker处理**
   - 将EXIF信息提取移至Web Worker处理，避免阻塞主线程
   - 使用Worker处理图片格式转换
   - 耗时操作如批量处理放入Worker执行

3. **虚拟化与内存管理**
   - 使用虚拟化列表（如react-window）提高多图片渲染性能
   - 优化内存使用，防止大图片导致内存泄漏
   - 实现更智能的资源释放机制

4. **缓存与复用**
   - 实现缩略图缓存系统
   - EXIF信息缓存，避免重复提取
   - 优化React组件渲染周期，减少不必要的重渲染

### 5.4 用户体验改进建议

1. **引导式体验**
   - 为首次使用的用户增加功能引导
   - 提供交互式教程，展示核心功能使用方法
   - 在关键功能处添加提示信息

2. **快捷键支持扩展**
   - 完善键盘快捷键，覆盖所有主要功能
   - 支持自定义快捷键
   - 添加快捷键提示和帮助页面

3. **第三方服务集成**
   - 集成图片托管服务（如Imgur、七牛云等）导入图片
   - 支持从云服务（如Google Photos、iCloud等）直接导入
   - 提供社交媒体分享功能

4. **无障碍优化**
   - 提高应用的可访问性
   - 支持屏幕阅读器
   - 添加高对比度模式和字体大小调整

5. **多语言支持**
   - 实现国际化(i18n)框架
   - 支持英文、中文等多种语言
   - 根据用户浏览器设置自动选择语言

### 5.5 测试与代码质量建议

1. **单元测试**
   - 使用Jest和React Testing Library添加单元测试
   - 为核心组件和逻辑实现全面测试覆盖
   - 实现自动化测试流程

2. **E2E测试**
   - 使用Cypress或Playwright添加端到端测试
   - 覆盖关键用户流程
   - 实现跨浏览器兼容性测试

3. **代码规范与质量检查**
   - 配置ESLint和Prettier，确保代码风格一致
   - 使用Husky添加pre-commit钩子检查代码质量
   - 实现持续集成(CI)流程，自动运行测试和检查

4. **性能监控**
   - 添加性能监控工具
   - 跟踪关键指标如首次加载时间、交互延迟等
   - 设置性能预算和自动化性能测试

### 5.6 部署与构建优化建议

1. **代码分割与懒加载**
   - 优化打包大小，使用代码分割减少首次加载时间
   - 实现组件和功能的懒加载
   - 优化第三方库的引入方式

2. **PWA支持**
   - 添加渐进式Web应用支持，使应用可安装并离线使用
   - 实现离线缓存策略
   - 添加推送通知功能

3. **CI/CD流程优化**
   - 完善GitHub Actions工作流
   - 自动化部署流程
   - 添加版本发布和变更日志自动生成

4. **监控与错误追踪**
   - 集成错误追踪服务如Sentry
   - 添加用户行为分析
   - 实现自动崩溃报告和问题反馈机制

5. **安全增强**
   - 实现内容安全策略(CSP)
   - 防止XSS和其他常见安全问题
   - 敏感数据处理优化

### 2024-06-XX 关键帧功能设计与交互细节

1. 关键帧开关：在标注开关右侧增加关键帧开关按钮，样式为圆角滑动开关，风格与标注开关一致。
2. 关键帧面板：开启关键帧后，显示关键帧面板，面板样式与标注工具栏面板一致（毛玻璃、圆角、悬浮、Portal渲染），但内容为关键帧相关。
3. 关键帧槽位：面板上有5个关键帧槽位（按钮/卡片），可选中其中一个。每个槽位记录当前图片的缩放和位移状态。
4. 自动记录：用户缩放或拖动图片后，当前关键帧槽位会自动记录最新的缩放和位移。
5. 平滑过渡：切换关键帧时，图片自动平滑过渡到目标关键帧的缩放和位移状态。
6. 快捷键切换：支持键盘快捷键1~5快速切换关键帧。
7. 播放功能：面板左侧有播放按钮，点击后自动按设定时间依次平滑过渡1→2→3→4→5，空格键可控制播放/暂停。
8. 演示模式兼容：演示模式下，关键帧面板不可见，但快捷键依然可用。
9. 不影响现有功能和样式：所有实现需与现有标注、缩放、同步等功能兼容，UI风格一致，代码结构清晰。

---

> 本文档会随着你的新需求、设定、开发原则自动补充和更新，任何AI助手或开发者只需阅读本文件即可快速理解你的开发意图和项目历史。 