import{r as p,a as rs,g as Ir,R as ie,b as dt}from"./vendor-Dja1Ap5q.js";import{h as ss,v as Pr}from"./heic-kq-hUwqs.js";(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))r(i);new MutationObserver(i=>{for(const o of i)if(o.type==="childList")for(const a of o.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&r(a)}).observe(document,{childList:!0,subtree:!0});function t(i){const o={};return i.integrity&&(o.integrity=i.integrity),i.referrerPolicy&&(o.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?o.credentials="include":i.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function r(i){if(i.ep)return;i.ep=!0;const o=t(i);fetch(i.href,o)}})();var Er={exports:{}},Bt={};/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var is=p,os=Symbol.for("react.element"),as=Symbol.for("react.fragment"),ls=Object.prototype.hasOwnProperty,cs=is.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,ds={key:!0,ref:!0,__self:!0,__source:!0};function Nr(n,e,t){var r,i={},o=null,a=null;t!==void 0&&(o=""+t),e.key!==void 0&&(o=""+e.key),e.ref!==void 0&&(a=e.ref);for(r in e)ls.call(e,r)&&!ds.hasOwnProperty(r)&&(i[r]=e[r]);if(n&&n.defaultProps)for(r in e=n.defaultProps,e)i[r]===void 0&&(i[r]=e[r]);return{$$typeof:os,type:n,key:o,ref:a,props:i,_owner:cs.current}}Bt.Fragment=as;Bt.jsx=Nr;Bt.jsxs=Nr;Er.exports=Bt;var s=Er.exports,on={},Yn=rs;on.createRoot=Yn.createRoot,on.hydrateRoot=Yn.hydrateRoot;const us={},Kn=n=>{let e;const t=new Set,r=(d,g)=>{const k=typeof d=="function"?d(e):d;if(!Object.is(k,e)){const D=e;e=g??(typeof k!="object"||k===null)?k:Object.assign({},e,k),t.forEach(I=>I(e,D))}},i=()=>e,h={setState:r,getState:i,getInitialState:()=>u,subscribe:d=>(t.add(d),()=>t.delete(d)),destroy:()=>{(us?"production":void 0)!=="production"&&console.warn("[DEPRECATED] The `destroy` method will be unsupported in a future version. Instead use unsubscribe function returned by subscribe. Everything will be garbage-collected if store is garbage-collected."),t.clear()}},u=e=n(r,i,h);return h},hs=n=>n?Kn(n):Kn;var Mr={exports:{}},Tr={},Ar={exports:{}},Dr={};/**
 * @license React
 * use-sync-external-store-shim.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var ht=p;function fs(n,e){return n===e&&(n!==0||1/n===1/e)||n!==n&&e!==e}var ps=typeof Object.is=="function"?Object.is:fs,gs=ht.useState,ms=ht.useEffect,xs=ht.useLayoutEffect,ys=ht.useDebugValue;function bs(n,e){var t=e(),r=gs({inst:{value:t,getSnapshot:e}}),i=r[0].inst,o=r[1];return xs(function(){i.value=t,i.getSnapshot=e,qt(i)&&o({inst:i})},[n,t,e]),ms(function(){return qt(i)&&o({inst:i}),n(function(){qt(i)&&o({inst:i})})},[n]),ys(t),t}function qt(n){var e=n.getSnapshot;n=n.value;try{var t=e();return!ps(n,t)}catch{return!0}}function vs(n,e){return e()}var ws=typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"?vs:bs;Dr.useSyncExternalStore=ht.useSyncExternalStore!==void 0?ht.useSyncExternalStore:ws;Ar.exports=Dr;var ks=Ar.exports;/**
 * @license React
 * use-sync-external-store-shim/with-selector.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Ut=p,Ss=ks;function Cs(n,e){return n===e&&(n!==0||1/n===1/e)||n!==n&&e!==e}var js=typeof Object.is=="function"?Object.is:Cs,Is=Ss.useSyncExternalStore,Ps=Ut.useRef,Es=Ut.useEffect,Ns=Ut.useMemo,Ms=Ut.useDebugValue;Tr.useSyncExternalStoreWithSelector=function(n,e,t,r,i){var o=Ps(null);if(o.current===null){var a={hasValue:!1,value:null};o.current=a}else a=o.current;o=Ns(function(){function h(D){if(!u){if(u=!0,d=D,D=r(D),i!==void 0&&a.hasValue){var I=a.value;if(i(I,D))return g=I}return g=D}if(I=g,js(d,D))return I;var y=r(D);return i!==void 0&&i(I,y)?(d=D,I):(d=D,g=y)}var u=!1,d,g,k=t===void 0?null:t;return[function(){return h(e())},k===null?void 0:function(){return h(k())}]},[e,t,r,i]);var l=Is(n,o[0],o[1]);return Es(function(){a.hasValue=!0,a.value=l},[l]),Ms(l),l};Mr.exports=Tr;var Ts=Mr.exports;const As=Ir(Ts),Lr={},{useDebugValue:Ds}=ie,{useSyncExternalStoreWithSelector:Ls}=As;let Jn=!1;const Fs=n=>n;function Rs(n,e=Fs,t){(Lr?"production":void 0)!=="production"&&t&&!Jn&&(console.warn("[DEPRECATED] Use `createWithEqualityFn` instead of `create` or use `useStoreWithEqualityFn` instead of `useStore`. They can be imported from 'zustand/traditional'. https://github.com/pmndrs/zustand/discussions/1937"),Jn=!0);const r=Ls(n.subscribe,n.getState,n.getServerState||n.getInitialState,e,t);return Ds(r),r}const qn=n=>{(Lr?"production":void 0)!=="production"&&typeof n!="function"&&console.warn("[DEPRECATED] Passing a vanilla store will be unsupported in a future version. Instead use `import { useStore } from 'zustand'`.");const e=typeof n=="function"?hs(n):n,t=(r,i)=>Rs(e,r,i);return Object.assign(t,e),t},$t=n=>n?qn(n):qn,Os={};function Bs(n,e){let t;try{t=n()}catch{return}return{getItem:i=>{var o;const a=h=>h===null?null:JSON.parse(h,void 0),l=(o=t.getItem(i))!=null?o:null;return l instanceof Promise?l.then(a):a(l)},setItem:(i,o)=>t.setItem(i,JSON.stringify(o,void 0)),removeItem:i=>t.removeItem(i)}}const wt=n=>e=>{try{const t=n(e);return t instanceof Promise?t:{then(r){return wt(r)(t)},catch(r){return this}}}catch(t){return{then(r){return this},catch(r){return wt(r)(t)}}}},Us=(n,e)=>(t,r,i)=>{let o={getStorage:()=>localStorage,serialize:JSON.stringify,deserialize:JSON.parse,partialize:M=>M,version:0,merge:(M,P)=>({...P,...M}),...e},a=!1;const l=new Set,h=new Set;let u;try{u=o.getStorage()}catch{}if(!u)return n((...M)=>{console.warn(`[zustand persist middleware] Unable to update item '${o.name}', the given storage is currently unavailable.`),t(...M)},r,i);const d=wt(o.serialize),g=()=>{const M=o.partialize({...r()});let P;const N=d({state:M,version:o.version}).then(V=>u.setItem(o.name,V)).catch(V=>{P=V});if(P)throw P;return N},k=i.setState;i.setState=(M,P)=>{k(M,P),g()};const D=n((...M)=>{t(...M),g()},r,i);let I;const y=()=>{var M;if(!u)return;a=!1,l.forEach(N=>N(r()));const P=((M=o.onRehydrateStorage)==null?void 0:M.call(o,r()))||void 0;return wt(u.getItem.bind(u))(o.name).then(N=>{if(N)return o.deserialize(N)}).then(N=>{if(N)if(typeof N.version=="number"&&N.version!==o.version){if(o.migrate)return o.migrate(N.state,N.version);console.error("State loaded from storage couldn't be migrated since no migrate function was provided")}else return N.state}).then(N=>{var V;return I=o.merge(N,(V=r())!=null?V:D),t(I,!0),g()}).then(()=>{P==null||P(I,void 0),a=!0,h.forEach(N=>N(I))}).catch(N=>{P==null||P(void 0,N)})};return i.persist={setOptions:M=>{o={...o,...M},M.getStorage&&(u=M.getStorage())},clearStorage:()=>{u==null||u.removeItem(o.name)},getOptions:()=>o,rehydrate:()=>y(),hasHydrated:()=>a,onHydrate:M=>(l.add(M),()=>{l.delete(M)}),onFinishHydration:M=>(h.add(M),()=>{h.delete(M)})},y(),I||D},$s=(n,e)=>(t,r,i)=>{let o={storage:Bs(()=>localStorage),partialize:y=>y,version:0,merge:(y,M)=>({...M,...y}),...e},a=!1;const l=new Set,h=new Set;let u=o.storage;if(!u)return n((...y)=>{console.warn(`[zustand persist middleware] Unable to update item '${o.name}', the given storage is currently unavailable.`),t(...y)},r,i);const d=()=>{const y=o.partialize({...r()});return u.setItem(o.name,{state:y,version:o.version})},g=i.setState;i.setState=(y,M)=>{g(y,M),d()};const k=n((...y)=>{t(...y),d()},r,i);i.getInitialState=()=>k;let D;const I=()=>{var y,M;if(!u)return;a=!1,l.forEach(N=>{var V;return N((V=r())!=null?V:k)});const P=((M=o.onRehydrateStorage)==null?void 0:M.call(o,(y=r())!=null?y:k))||void 0;return wt(u.getItem.bind(u))(o.name).then(N=>{if(N)if(typeof N.version=="number"&&N.version!==o.version){if(o.migrate)return[!0,o.migrate(N.state,N.version)];console.error("State loaded from storage couldn't be migrated since no migrate function was provided")}else return[!1,N.state];return[!1,void 0]}).then(N=>{var V;const[ee,v]=N;if(D=o.merge(v,(V=r())!=null?V:k),t(D,!0),ee)return d()}).then(()=>{P==null||P(D,void 0),D=r(),a=!0,h.forEach(N=>N(D))}).catch(N=>{P==null||P(void 0,N)})};return i.persist={setOptions:y=>{o={...o,...y},y.storage&&(u=y.storage)},clearStorage:()=>{u==null||u.removeItem(o.name)},getOptions:()=>o,rehydrate:()=>I(),hasHydrated:()=>a,onHydrate:y=>(l.add(y),()=>{l.delete(y)}),onFinishHydration:y=>(h.add(y),()=>{h.delete(y)})},o.skipHydration||I(),D||k},zs=(n,e)=>"getStorage"in e||"serialize"in e||"deserialize"in e?((Os?"production":void 0)!=="production"&&console.warn("[DEPRECATED] `getStorage`, `serialize` and `deserialize` options are deprecated. Use `storage` option instead."),Us(n,e)):$s(n,e),Ws=zs,De=$t()(Ws(n=>({themeMode:window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light",syncZoom:!0,syncDraw:!1,presentationMode:!1,visibleExifFields:["Make","Model","ISO","FNumber","ExposureTime","FocalLength","LensModel","DateTimeOriginal"],demoMode:!1,exifSettings:{FileName:!1,Resolution:!0,Make:!0,Model:!0,LensModel:!1,FocalLength:!0,FNumber:!0,ExposureTime:!0,ISO:!1,DateTimeOriginal:!1},showZoomControls:!1,showExifInfo:!0,borderRadius:"0.5rem",gridGap:"1rem",setThemeMode:e=>n({themeMode:e}),toggleSyncZoom:()=>n(e=>({syncZoom:!e.syncZoom})),toggleSyncDraw:()=>n(e=>({syncDraw:!e.syncDraw})),togglePresentationMode:()=>n(e=>({presentationMode:!e.presentationMode})),toggleDemoMode:()=>n(e=>({demoMode:!e.demoMode})),toggleExifSetting:e=>n(t=>({exifSettings:{...t.exifSettings,[e]:!t.exifSettings[e]}})),toggleExifField:e=>n(t=>({visibleExifFields:t.visibleExifFields.includes(e)?t.visibleExifFields.filter(r=>r!==e):[...t.visibleExifFields,e]})),toggleAllExifSettings:e=>n(t=>{const r={...t.exifSettings};return Object.keys(r).forEach(i=>{r[i]=e}),{exifSettings:r}}),toggleShowZoomControls:()=>n(e=>({showZoomControls:!e.showZoomControls})),toggleShowExifInfo:()=>n(e=>({showExifInfo:!e.showExifInfo})),setBorderRadius:e=>n({borderRadius:e}),setGridGap:e=>n({gridGap:e})}),{name:"photo-compare-settings",partialize:n=>({themeMode:n.themeMode,syncZoom:n.syncZoom,syncDraw:n.syncDraw,presentationMode:n.presentationMode,visibleExifFields:n.visibleExifFields,demoMode:n.demoMode,exifSettings:n.exifSettings,showZoomControls:n.showZoomControls,showExifInfo:n.showExifInfo,borderRadius:n.borderRadius,gridGap:n.gridGap})})),kt=$t((n,e)=>({images:[],lastImageUrl:null,hasViewedImages:!1,addImages:t=>n(r=>({images:[...r.images,...t],hasViewedImages:!0})),addImage:t=>n(r=>({images:[...r.images,t],hasViewedImages:!0})),removeImage:t=>n(r=>{var o;const i=r.images.filter(a=>a.id!==t);return i.length===0&&r.images.length>0?{images:i,lastImageUrl:((o=r.images.find(a=>a.id===t))==null?void 0:o.url)||null}:{images:i}}),clearImages:()=>n({images:[]}),resetState:()=>n({images:[],lastImageUrl:null,hasViewedImages:!1})})),Ie=$t((n,e)=>({isAnnotateMode:!1,setAnnotateMode:t=>n({isAnnotateMode:t}),annotationToolbar:{visible:!1,position:{x:100,y:100}},setToolbarVisible:t=>n(r=>({annotationToolbar:{...r.annotationToolbar,visible:t}})),setToolbarPosition:t=>n(r=>({annotationToolbar:{...r.annotationToolbar,position:t}})),annotationTool:"rect",setAnnotationTool:t=>n({annotationTool:t}),annotationStrokeWidth:2,setStrokeWidth:t=>n({annotationStrokeWidth:t}),annotationColor:"#FF0000",setAnnotationColor:t=>n({annotationColor:t}),annotationFontSize:18,setAnnotationFontSize:t=>n({annotationFontSize:t}),annotations:{},addAnnotation:(t,r)=>n(i=>({annotations:{...i.annotations,[t]:[...i.annotations[t]||[],r]}})),setAnnotations:(t,r)=>n(i=>({annotations:{...i.annotations,[t]:r}})),clearAnnotations:t=>n(r=>({annotations:{...r.annotations,[t]:[]}})),selectedAnnotationId:{},setSelectedAnnotationId:(t,r)=>n(i=>({selectedAnnotationId:{...i.selectedAnnotationId,[t]:r}})),moveAnnotation:(t,r,i,o)=>n(a=>{const l=a.annotations[t]||[],h=l.findIndex(k=>k.id===r);if(h===-1)return{};const u=l[h];let d=u.points;u.type==="rect"||u.type==="ellipse"?d=[u.points[0]+i,u.points[1]+o,u.points[2]+i,u.points[3]+o]:u.type==="pen"?d=u.points.map((k,D)=>D%2===0?k+i:k+o):u.type==="text"&&(d=[u.points[0]+i,u.points[1]+o]);const g=[...l];return g[h]={...u,points:d},{annotations:{...a.annotations,[t]:g}}}),deleteAnnotation:(t,r)=>n(i=>{const o=i.annotations[t]||[];if(o.findIndex(h=>h.id===r)===-1)return{};e().pushUndo(t,o);const l=o.filter(h=>h.id!==r);return{annotations:{...i.annotations,[t]:l},selectedAnnotationId:{...i.selectedAnnotationId,[t]:null}}}),undoStack:{},redoStack:{},pushUndo:(t,r)=>n(i=>({undoStack:{...i.undoStack,[t]:[...i.undoStack[t]||[],JSON.parse(JSON.stringify(r))]},redoStack:{...i.redoStack,[t]:[]}})),undo:t=>n(r=>{const i=r.undoStack[t]||[];if(i.length===0)return{};const o=r.redoStack[t]||[],a=i[i.length-1];return{annotations:{...r.annotations,[t]:a},undoStack:{...r.undoStack,[t]:i.slice(0,-1)},redoStack:{...r.redoStack,[t]:[...o,r.annotations[t]||[]]}}}),redo:t=>n(r=>{const i=r.redoStack[t]||[];if(i.length===0)return{};const o=r.undoStack[t]||[],a=i[i.length-1];return{annotations:{...r.annotations,[t]:a},redoStack:{...r.redoStack,[t]:i.slice(0,-1)},undoStack:{...r.undoStack,[t]:[...o,r.annotations[t]||[]]}}}),drawing:null,setDrawing:t=>n({drawing:t}),editingTextId:null,setEditingTextId:t=>n({editingTextId:t})})),Zn=[{scale:1,offsetX:0,offsetY:0},{scale:1,offsetX:0,offsetY:0},{scale:1,offsetX:0,offsetY:0},{scale:1,offsetX:0,offsetY:0},{scale:1,offsetX:0,offsetY:0}],yn=$t(n=>({enabled:!1,keyframes:Zn,currentIdx:0,playing:!1,frameDuration:3e3,transitionDuration:2e3,transitionEasing:"ease-in-out",setEnabled:e=>n({enabled:e}),setKeyframe:(e,t)=>n(r=>{const i=[...r.keyframes];return i[e]=t,{keyframes:i}}),setCurrentIdx:e=>n({currentIdx:e}),setPlaying:e=>n({playing:e}),setFrameDuration:e=>n({frameDuration:e}),setTransitionDuration:e=>n({transitionDuration:e}),setTransitionEasing:e=>n({transitionEasing:e}),reset:()=>n({keyframes:Zn,currentIdx:0,playing:!1})}));var zt=typeof self<"u"?self:global;const St=typeof navigator<"u",Hs=St&&typeof HTMLImageElement>"u",Dt=!(typeof global>"u"||typeof process>"u"||!process.versions||!process.versions.node),Wt=zt.Buffer,Pt=zt.BigInt,Ht=!!Wt,Vs=n=>n;function Lt(n,e=Vs){if(Dt)try{return typeof require=="function"?Promise.resolve(e(require(n))):import(n).then(e)}catch{console.warn(`Couldn't load ${n}`)}}let bn=zt.fetch;const _s=n=>bn=n;if(!zt.fetch){const n=Lt("http",r=>r),e=Lt("https",r=>r),t=(r,{headers:i}={})=>new Promise(async(o,a)=>{let{port:l,hostname:h,pathname:u,protocol:d,search:g}=new URL(r);const k={method:"GET",hostname:h,path:encodeURI(u)+g,headers:i};l!==""&&(k.port=Number(l));const D=(d==="https:"?await e:await n).request(k,I=>{if(I.statusCode===301||I.statusCode===302){let y=new URL(I.headers.location,r).toString();return t(y,{headers:i}).then(o).catch(a)}o({status:I.statusCode,arrayBuffer:()=>new Promise(y=>{let M=[];I.on("data",P=>M.push(P)),I.on("end",()=>y(Buffer.concat(M)))})})});D.on("error",a),D.end()});_s(t)}function Z(n,e,t){return e in n?Object.defineProperty(n,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):n[e]=t,n}const Ft=n=>Fr(n)?void 0:n,Gs=n=>n!==void 0;function Fr(n){return n===void 0||(n instanceof Map?n.size===0:Object.values(n).filter(Gs).length===0)}function Se(n){let e=new Error(n);throw delete e.stack,e}function et(n){return(n=function(e){for(;e.endsWith("\0");)e=e.slice(0,-1);return e}(n).trim())===""?void 0:n}function an(n){let e=function(t){let r=0;return t.ifd0.enabled&&(r+=1024),t.exif.enabled&&(r+=2048),t.makerNote&&(r+=2048),t.userComment&&(r+=1024),t.gps.enabled&&(r+=512),t.interop.enabled&&(r+=100),t.ifd1.enabled&&(r+=1024),r+2048}(n);return n.jfif.enabled&&(e+=50),n.xmp.enabled&&(e+=2e4),n.iptc.enabled&&(e+=14e3),n.icc.enabled&&(e+=6e3),e}const ln=n=>String.fromCharCode.apply(null,n),Qn=typeof TextDecoder<"u"?new TextDecoder("utf-8"):void 0;function Rr(n){return Qn?Qn.decode(n):Ht?Buffer.from(n).toString("utf8"):decodeURIComponent(escape(ln(n)))}let Ze=class ct{static from(e,t){return e instanceof this&&e.le===t?e:new ct(e,void 0,void 0,t)}constructor(e,t=0,r,i){if(typeof i=="boolean"&&(this.le=i),Array.isArray(e)&&(e=new Uint8Array(e)),e===0)this.byteOffset=0,this.byteLength=0;else if(e instanceof ArrayBuffer){r===void 0&&(r=e.byteLength-t);let o=new DataView(e,t,r);this._swapDataView(o)}else if(e instanceof Uint8Array||e instanceof DataView||e instanceof ct){r===void 0&&(r=e.byteLength-t),(t+=e.byteOffset)+r>e.byteOffset+e.byteLength&&Se("Creating view outside of available memory in ArrayBuffer");let o=new DataView(e.buffer,t,r);this._swapDataView(o)}else if(typeof e=="number"){let o=new DataView(new ArrayBuffer(e));this._swapDataView(o)}else Se("Invalid input argument for BufferView: "+e)}_swapArrayBuffer(e){this._swapDataView(new DataView(e))}_swapBuffer(e){this._swapDataView(new DataView(e.buffer,e.byteOffset,e.byteLength))}_swapDataView(e){this.dataView=e,this.buffer=e.buffer,this.byteOffset=e.byteOffset,this.byteLength=e.byteLength}_lengthToEnd(e){return this.byteLength-e}set(e,t,r=ct){return e instanceof DataView||e instanceof ct?e=new Uint8Array(e.buffer,e.byteOffset,e.byteLength):e instanceof ArrayBuffer&&(e=new Uint8Array(e)),e instanceof Uint8Array||Se("BufferView.set(): Invalid data argument."),this.toUint8().set(e,t),new r(this,t,e.byteLength)}subarray(e,t){return t=t||this._lengthToEnd(e),new ct(this,e,t)}toUint8(){return new Uint8Array(this.buffer,this.byteOffset,this.byteLength)}getUint8Array(e,t){return new Uint8Array(this.buffer,this.byteOffset+e,t)}getString(e=0,t=this.byteLength){return Rr(this.getUint8Array(e,t))}getLatin1String(e=0,t=this.byteLength){let r=this.getUint8Array(e,t);return ln(r)}getUnicodeString(e=0,t=this.byteLength){const r=[];for(let i=0;i<t&&e+i<this.byteLength;i+=2)r.push(this.getUint16(e+i));return ln(r)}getInt8(e){return this.dataView.getInt8(e)}getUint8(e){return this.dataView.getUint8(e)}getInt16(e,t=this.le){return this.dataView.getInt16(e,t)}getInt32(e,t=this.le){return this.dataView.getInt32(e,t)}getUint16(e,t=this.le){return this.dataView.getUint16(e,t)}getUint32(e,t=this.le){return this.dataView.getUint32(e,t)}getFloat32(e,t=this.le){return this.dataView.getFloat32(e,t)}getFloat64(e,t=this.le){return this.dataView.getFloat64(e,t)}getFloat(e,t=this.le){return this.dataView.getFloat32(e,t)}getDouble(e,t=this.le){return this.dataView.getFloat64(e,t)}getUintBytes(e,t,r){switch(t){case 1:return this.getUint8(e,r);case 2:return this.getUint16(e,r);case 4:return this.getUint32(e,r);case 8:return this.getUint64&&this.getUint64(e,r)}}getUint(e,t,r){switch(t){case 8:return this.getUint8(e,r);case 16:return this.getUint16(e,r);case 32:return this.getUint32(e,r);case 64:return this.getUint64&&this.getUint64(e,r)}}toString(e){return this.dataView.toString(e,this.constructor.name)}ensureChunk(){}};function cn(n,e){Se(`${n} '${e}' was not loaded, try using full build of exifr.`)}class vn extends Map{constructor(e){super(),this.kind=e}get(e,t){return this.has(e)||cn(this.kind,e),t&&(e in t||function(r,i){Se(`Unknown ${r} '${i}'.`)}(this.kind,e),t[e].enabled||cn(this.kind,e)),super.get(e)}keyList(){return Array.from(this.keys())}}var Oe=new vn("file parser"),ke=new vn("segment parser"),Be=new vn("file reader");function Xs(n,e){return typeof n=="string"?er(n,e):St&&!Hs&&n instanceof HTMLImageElement?er(n.src,e):n instanceof Uint8Array||n instanceof ArrayBuffer||n instanceof DataView?new Ze(n):St&&n instanceof Blob?dn(n,e,"blob",st):void Se("Invalid input argument")}function er(n,e){return(t=n).startsWith("data:")||t.length>1e4?un(n,e,"base64"):Dt&&n.includes("://")?dn(n,e,"url",rt):Dt?un(n,e,"fs"):St?dn(n,e,"url",rt):void Se("Invalid input argument");var t}async function dn(n,e,t,r){return Be.has(t)?un(n,e,t):r?async function(i,o){let a=await o(i);return new Ze(a)}(n,r):void Se(`Parser ${t} is not loaded`)}async function un(n,e,t){let r=new(Be.get(t))(n,e);return await r.read(),r}const rt=n=>bn(n).then(e=>e.arrayBuffer()),st=n=>new Promise((e,t)=>{let r=new FileReader;r.onloadend=()=>e(r.result||new ArrayBuffer),r.onerror=t,r.readAsArrayBuffer(n)});let Ys=class extends Map{get tagKeys(){return this.allKeys||(this.allKeys=Array.from(this.keys())),this.allKeys}get tagValues(){return this.allValues||(this.allValues=Array.from(this.values())),this.allValues}};function we(n,e,t){let r=new Ys;for(let[i,o]of t)r.set(i,o);if(Array.isArray(e))for(let i of e)n.set(i,r);else n.set(e,r);return r}function it(n,e,t){let r,i=n.get(e);for(r of t)i.set(r[0],r[1])}const Pe=new Map,Fe=new Map,Je=new Map,Ge=["chunked","firstChunkSize","firstChunkSizeNode","firstChunkSizeBrowser","chunkSize","chunkLimit"],ft=["jfif","xmp","icc","iptc","ihdr"],ot=["tiff",...ft],be=["ifd0","ifd1","exif","gps","interop"],Xe=[...ot,...be],Ye=["makerNote","userComment"],pt=["translateKeys","translateValues","reviveValues","multiSegment"],Ke=[...pt,"sanitize","mergeOutput","silentErrors"];class Or{get translate(){return this.translateKeys||this.translateValues||this.reviveValues}}let mt=class extends Or{get needed(){return this.enabled||this.deps.size>0}constructor(e,t,r,i){if(super(),Z(this,"enabled",!1),Z(this,"skip",new Set),Z(this,"pick",new Set),Z(this,"deps",new Set),Z(this,"translateKeys",!1),Z(this,"translateValues",!1),Z(this,"reviveValues",!1),this.key=e,this.enabled=t,this.parse=this.enabled,this.applyInheritables(i),this.canBeFiltered=be.includes(e),this.canBeFiltered&&(this.dict=Pe.get(e)),r!==void 0)if(Array.isArray(r))this.parse=this.enabled=!0,this.canBeFiltered&&r.length>0&&this.translateTagSet(r,this.pick);else if(typeof r=="object"){if(this.enabled=!0,this.parse=r.parse!==!1,this.canBeFiltered){let{pick:o,skip:a}=r;o&&o.length>0&&this.translateTagSet(o,this.pick),a&&a.length>0&&this.translateTagSet(a,this.skip)}this.applyInheritables(r)}else r===!0||r===!1?this.parse=this.enabled=r:Se(`Invalid options argument: ${r}`)}applyInheritables(e){let t,r;for(t of pt)r=e[t],r!==void 0&&(this[t]=r)}translateTagSet(e,t){if(this.dict){let r,i,{tagKeys:o,tagValues:a}=this.dict;for(r of e)typeof r=="string"?(i=a.indexOf(r),i===-1&&(i=o.indexOf(Number(r))),i!==-1&&t.add(Number(o[i]))):t.add(r)}else for(let r of e)t.add(r)}finalizeFilters(){!this.enabled&&this.deps.size>0?(this.enabled=!0,Rt(this.pick,this.deps)):this.enabled&&this.pick.size>0&&Rt(this.pick,this.deps)}};var Te={jfif:!1,tiff:!0,xmp:!1,icc:!1,iptc:!1,ifd0:!0,ifd1:!1,exif:!0,gps:!0,interop:!1,ihdr:void 0,makerNote:!1,userComment:!1,multiSegment:!1,skip:[],pick:[],translateKeys:!0,translateValues:!0,reviveValues:!0,sanitize:!0,mergeOutput:!0,silentErrors:!0,chunked:!0,firstChunkSize:void 0,firstChunkSizeNode:512,firstChunkSizeBrowser:65536,chunkSize:65536,chunkLimit:5},tr=new Map;let at=class extends Or{static useCached(e){let t=tr.get(e);return t!==void 0||(t=new this(e),tr.set(e,t)),t}constructor(e){super(),e===!0?this.setupFromTrue():e===void 0?this.setupFromUndefined():Array.isArray(e)?this.setupFromArray(e):typeof e=="object"?this.setupFromObject(e):Se(`Invalid options argument ${e}`),this.firstChunkSize===void 0&&(this.firstChunkSize=St?this.firstChunkSizeBrowser:this.firstChunkSizeNode),this.mergeOutput&&(this.ifd1.enabled=!1),this.filterNestedSegmentTags(),this.traverseTiffDependencyTree(),this.checkLoadedPlugins()}setupFromUndefined(){let e;for(e of Ge)this[e]=Te[e];for(e of Ke)this[e]=Te[e];for(e of Ye)this[e]=Te[e];for(e of Xe)this[e]=new mt(e,Te[e],void 0,this)}setupFromTrue(){let e;for(e of Ge)this[e]=Te[e];for(e of Ke)this[e]=Te[e];for(e of Ye)this[e]=!0;for(e of Xe)this[e]=new mt(e,!0,void 0,this)}setupFromArray(e){let t;for(t of Ge)this[t]=Te[t];for(t of Ke)this[t]=Te[t];for(t of Ye)this[t]=Te[t];for(t of Xe)this[t]=new mt(t,!1,void 0,this);this.setupGlobalFilters(e,void 0,be)}setupFromObject(e){let t;for(t of(be.ifd0=be.ifd0||be.image,be.ifd1=be.ifd1||be.thumbnail,Object.assign(this,e),Ge))this[t]=Zt(e[t],Te[t]);for(t of Ke)this[t]=Zt(e[t],Te[t]);for(t of Ye)this[t]=Zt(e[t],Te[t]);for(t of ot)this[t]=new mt(t,Te[t],e[t],this);for(t of be)this[t]=new mt(t,Te[t],e[t],this.tiff);this.setupGlobalFilters(e.pick,e.skip,be,Xe),e.tiff===!0?this.batchEnableWithBool(be,!0):e.tiff===!1?this.batchEnableWithUserValue(be,e):Array.isArray(e.tiff)?this.setupGlobalFilters(e.tiff,void 0,be):typeof e.tiff=="object"&&this.setupGlobalFilters(e.tiff.pick,e.tiff.skip,be)}batchEnableWithBool(e,t){for(let r of e)this[r].enabled=t}batchEnableWithUserValue(e,t){for(let r of e){let i=t[r];this[r].enabled=i!==!1&&i!==void 0}}setupGlobalFilters(e,t,r,i=r){if(e&&e.length){for(let a of i)this[a].enabled=!1;let o=nr(e,r);for(let[a,l]of o)Rt(this[a].pick,l),this[a].enabled=!0}else if(t&&t.length){let o=nr(t,r);for(let[a,l]of o)Rt(this[a].skip,l)}}filterNestedSegmentTags(){let{ifd0:e,exif:t,xmp:r,iptc:i,icc:o}=this;this.makerNote?t.deps.add(37500):t.skip.add(37500),this.userComment?t.deps.add(37510):t.skip.add(37510),r.enabled||e.skip.add(700),i.enabled||e.skip.add(33723),o.enabled||e.skip.add(34675)}traverseTiffDependencyTree(){let{ifd0:e,exif:t,gps:r,interop:i}=this;i.needed&&(t.deps.add(40965),e.deps.add(40965)),t.needed&&e.deps.add(34665),r.needed&&e.deps.add(34853),this.tiff.enabled=be.some(o=>this[o].enabled===!0)||this.makerNote||this.userComment;for(let o of be)this[o].finalizeFilters()}get onlyTiff(){return!ft.map(e=>this[e].enabled).some(e=>e===!0)&&this.tiff.enabled}checkLoadedPlugins(){for(let e of ot)this[e].enabled&&!ke.has(e)&&cn("segment parser",e)}};function nr(n,e){let t,r,i,o,a=[];for(i of e){for(o of(t=Pe.get(i),r=[],t))(n.includes(o[0])||n.includes(o[1]))&&r.push(o[0]);r.length&&a.push([i,r])}return a}function Zt(n,e){return n!==void 0?n:e!==void 0?e:void 0}function Rt(n,e){for(let t of e)n.add(t)}Z(at,"default",Te);class Qe{constructor(e){Z(this,"parsers",{}),Z(this,"output",{}),Z(this,"errors",[]),Z(this,"pushToErrors",t=>this.errors.push(t)),this.options=at.useCached(e)}async read(e){this.file=await Xs(e,this.options)}setup(){if(this.fileParser)return;let{file:e}=this,t=e.getUint16(0);for(let[r,i]of Oe)if(i.canHandle(e,t))return this.fileParser=new i(this.options,this.file,this.parsers),e[r]=!0;this.file.close&&this.file.close(),Se("Unknown file format")}async parse(){let{output:e,errors:t}=this;return this.setup(),this.options.silentErrors?(await this.executeParsers().catch(this.pushToErrors),t.push(...this.fileParser.errors)):await this.executeParsers(),this.file.close&&this.file.close(),this.options.silentErrors&&t.length>0&&(e.errors=t),Ft(e)}async executeParsers(){let{output:e}=this;await this.fileParser.parse();let t=Object.values(this.parsers).map(async r=>{let i=await r.parse();r.assignToOutput(e,i)});this.options.silentErrors&&(t=t.map(r=>r.catch(this.pushToErrors))),await Promise.all(t)}async extractThumbnail(){this.setup();let{options:e,file:t}=this,r=ke.get("tiff",e);var i;if(t.tiff?i={start:0,type:"tiff"}:t.jpeg&&(i=await this.fileParser.getOrFindSegment("tiff")),i===void 0)return;let o=await this.fileParser.ensureSegmentChunk(i),a=this.parsers.tiff=new r(o,e,t),l=await a.extractThumbnail();return t.close&&t.close(),l}}async function Vt(n,e){let t=new Qe(e);return await t.read(n),t.parse()}var Ks=Object.freeze({__proto__:null,parse:Vt,Exifr:Qe,fileParsers:Oe,segmentParsers:ke,fileReaders:Be,tagKeys:Pe,tagValues:Fe,tagRevivers:Je,createDictionary:we,extendDictionary:it,fetchUrlAsArrayBuffer:rt,readBlobAsArrayBuffer:st,chunkedProps:Ge,otherSegments:ft,segments:ot,tiffBlocks:be,segmentsAndBlocks:Xe,tiffExtractables:Ye,inheritables:pt,allFormatters:Ke,Options:at});class _t{constructor(e,t,r){Z(this,"errors",[]),Z(this,"ensureSegmentChunk",async i=>{let o=i.start,a=i.size||65536;if(this.file.chunked)if(this.file.available(o,a))i.chunk=this.file.subarray(o,a);else try{i.chunk=await this.file.readChunk(o,a)}catch(l){Se(`Couldn't read segment: ${JSON.stringify(i)}. ${l.message}`)}else this.file.byteLength>o+a?i.chunk=this.file.subarray(o,a):i.size===void 0?i.chunk=this.file.subarray(o):Se("Segment unreachable: "+JSON.stringify(i));return i.chunk}),this.extendOptions&&this.extendOptions(e),this.options=e,this.file=t,this.parsers=r}injectSegment(e,t){this.options[e].enabled&&this.createParser(e,t)}createParser(e,t){let r=new(ke.get(e))(t,this.options,this.file);return this.parsers[e]=r}createParsers(e){for(let t of e){let{type:r,chunk:i}=t,o=this.options[r];if(o&&o.enabled){let a=this.parsers[r];a&&a.append||a||this.createParser(r,i)}}}async readSegments(e){let t=e.map(this.ensureSegmentChunk);await Promise.all(t)}}class Le{static findPosition(e,t){let r=e.getUint16(t+2)+2,i=typeof this.headerLength=="function"?this.headerLength(e,t,r):this.headerLength,o=t+i,a=r-i;return{offset:t,length:r,headerLength:i,start:o,size:a,end:o+a}}static parse(e,t={}){return new this(e,new at({[this.type]:t}),e).parse()}normalizeInput(e){return e instanceof Ze?e:new Ze(e)}constructor(e,t={},r){Z(this,"errors",[]),Z(this,"raw",new Map),Z(this,"handleError",i=>{if(!this.options.silentErrors)throw i;this.errors.push(i.message)}),this.chunk=this.normalizeInput(e),this.file=r,this.type=this.constructor.type,this.globalOptions=this.options=t,this.localOptions=t[this.type],this.canTranslate=this.localOptions&&this.localOptions.translate}translate(){this.canTranslate&&(this.translated=this.translateBlock(this.raw,this.type))}get output(){return this.translated?this.translated:this.raw?Object.fromEntries(this.raw):void 0}translateBlock(e,t){let r=Je.get(t),i=Fe.get(t),o=Pe.get(t),a=this.options[t],l=a.reviveValues&&!!r,h=a.translateValues&&!!i,u=a.translateKeys&&!!o,d={};for(let[g,k]of e)l&&r.has(g)?k=r.get(g)(k):h&&i.has(g)&&(k=this.translateValue(k,i.get(g))),u&&o.has(g)&&(g=o.get(g)||g),d[g]=k;return d}translateValue(e,t){return t[e]||t.DEFAULT||e}assignToOutput(e,t){this.assignObjectToOutput(e,this.constructor.type,t)}assignObjectToOutput(e,t,r){if(this.globalOptions.mergeOutput)return Object.assign(e,r);e[t]?Object.assign(e[t],r):e[t]=r}}Z(Le,"headerLength",4),Z(Le,"type",void 0),Z(Le,"multiSegment",!1),Z(Le,"canHandle",()=>!1);function Js(n){return n===192||n===194||n===196||n===219||n===221||n===218||n===254}function qs(n){return n>=224&&n<=239}function Zs(n,e,t){for(let[r,i]of ke)if(i.canHandle(n,e,t))return r}class rr extends _t{constructor(...e){super(...e),Z(this,"appSegments",[]),Z(this,"jpegSegments",[]),Z(this,"unknownSegments",[])}static canHandle(e,t){return t===65496}async parse(){await this.findAppSegments(),await this.readSegments(this.appSegments),this.mergeMultiSegments(),this.createParsers(this.mergedAppSegments||this.appSegments)}setupSegmentFinderArgs(e){e===!0?(this.findAll=!0,this.wanted=new Set(ke.keyList())):(e=e===void 0?ke.keyList().filter(t=>this.options[t].enabled):e.filter(t=>this.options[t].enabled&&ke.has(t)),this.findAll=!1,this.remaining=new Set(e),this.wanted=new Set(e)),this.unfinishedMultiSegment=!1}async findAppSegments(e=0,t){this.setupSegmentFinderArgs(t);let{file:r,findAll:i,wanted:o,remaining:a}=this;if(!i&&this.file.chunked&&(i=Array.from(o).some(l=>{let h=ke.get(l),u=this.options[l];return h.multiSegment&&u.multiSegment}),i&&await this.file.readWhole()),e=this.findAppSegmentsInRange(e,r.byteLength),!this.options.onlyTiff&&r.chunked){let l=!1;for(;a.size>0&&!l&&(r.canReadNextChunk||this.unfinishedMultiSegment);){let{nextChunkOffset:h}=r,u=this.appSegments.some(d=>!this.file.available(d.offset||d.start,d.length||d.size));if(l=e>h&&!u?!await r.readNextChunk(e):!await r.readNextChunk(h),(e=this.findAppSegmentsInRange(e,r.byteLength))===void 0)return}}}findAppSegmentsInRange(e,t){t-=2;let r,i,o,a,l,h,{file:u,findAll:d,wanted:g,remaining:k,options:D}=this;for(;e<t;e++)if(u.getUint8(e)===255){if(r=u.getUint8(e+1),qs(r)){if(i=u.getUint16(e+2),o=Zs(u,e,i),o&&g.has(o)&&(a=ke.get(o),l=a.findPosition(u,e),h=D[o],l.type=o,this.appSegments.push(l),!d&&(a.multiSegment&&h.multiSegment?(this.unfinishedMultiSegment=l.chunkNumber<l.chunkCount,this.unfinishedMultiSegment||k.delete(o)):k.delete(o),k.size===0)))break;D.recordUnknownSegments&&(l=Le.findPosition(u,e),l.marker=r,this.unknownSegments.push(l)),e+=i+1}else if(Js(r)){if(i=u.getUint16(e+2),r===218&&D.stopAfterSos!==!1)return;D.recordJpegSegments&&this.jpegSegments.push({offset:e,length:i,marker:r}),e+=i+1}}return e}mergeMultiSegments(){if(!this.appSegments.some(t=>t.multiSegment))return;let e=function(t,r){let i,o,a,l=new Map;for(let h=0;h<t.length;h++)i=t[h],o=i[r],l.has(o)?a=l.get(o):l.set(o,a=[]),a.push(i);return Array.from(l)}(this.appSegments,"type");this.mergedAppSegments=e.map(([t,r])=>{let i=ke.get(t,this.options);return i.handleMultiSegments?{type:t,chunk:i.handleMultiSegments(r)}:r[0]})}getSegment(e){return this.appSegments.find(t=>t.type===e)}async getOrFindSegment(e){let t=this.getSegment(e);return t===void 0&&(await this.findAppSegments(0,[e]),t=this.getSegment(e)),t}}Z(rr,"type","jpeg"),Oe.set("jpeg",rr);const Qs=[void 0,1,1,2,4,8,1,1,2,4,8,4,8,4];class ei extends Le{parseHeader(){var e=this.chunk.getUint16();e===18761?this.le=!0:e===19789&&(this.le=!1),this.chunk.le=this.le,this.headerParsed=!0}parseTags(e,t,r=new Map){let{pick:i,skip:o}=this.options[t];i=new Set(i);let a=i.size>0,l=o.size===0,h=this.chunk.getUint16(e);e+=2;for(let u=0;u<h;u++){let d=this.chunk.getUint16(e);if(a){if(i.has(d)&&(r.set(d,this.parseTag(e,d,t)),i.delete(d),i.size===0))break}else!l&&o.has(d)||r.set(d,this.parseTag(e,d,t));e+=12}return r}parseTag(e,t,r){let{chunk:i}=this,o=i.getUint16(e+2),a=i.getUint32(e+4),l=Qs[o];if(l*a<=4?e+=8:e=i.getUint32(e+8),(o<1||o>13)&&Se(`Invalid TIFF value type. block: ${r.toUpperCase()}, tag: ${t.toString(16)}, type: ${o}, offset ${e}`),e>i.byteLength&&Se(`Invalid TIFF value offset. block: ${r.toUpperCase()}, tag: ${t.toString(16)}, type: ${o}, offset ${e} is outside of chunk size ${i.byteLength}`),o===1)return i.getUint8Array(e,a);if(o===2)return et(i.getString(e,a));if(o===7)return i.getUint8Array(e,a);if(a===1)return this.parseTagValue(o,e);{let h=new(function(d){switch(d){case 1:return Uint8Array;case 3:return Uint16Array;case 4:return Uint32Array;case 5:return Array;case 6:return Int8Array;case 8:return Int16Array;case 9:return Int32Array;case 10:return Array;case 11:return Float32Array;case 12:return Float64Array;default:return Array}}(o))(a),u=l;for(let d=0;d<a;d++)h[d]=this.parseTagValue(o,e),e+=u;return h}}parseTagValue(e,t){let{chunk:r}=this;switch(e){case 1:return r.getUint8(t);case 3:return r.getUint16(t);case 4:return r.getUint32(t);case 5:return r.getUint32(t)/r.getUint32(t+4);case 6:return r.getInt8(t);case 8:return r.getInt16(t);case 9:return r.getInt32(t);case 10:return r.getInt32(t)/r.getInt32(t+4);case 11:return r.getFloat(t);case 12:return r.getDouble(t);case 13:return r.getUint32(t);default:Se(`Invalid tiff type ${e}`)}}}class Qt extends ei{static canHandle(e,t){return e.getUint8(t+1)===225&&e.getUint32(t+4)===1165519206&&e.getUint16(t+8)===0}async parse(){this.parseHeader();let{options:e}=this;return e.ifd0.enabled&&await this.parseIfd0Block(),e.exif.enabled&&await this.safeParse("parseExifBlock"),e.gps.enabled&&await this.safeParse("parseGpsBlock"),e.interop.enabled&&await this.safeParse("parseInteropBlock"),e.ifd1.enabled&&await this.safeParse("parseThumbnailBlock"),this.createOutput()}safeParse(e){let t=this[e]();return t.catch!==void 0&&(t=t.catch(this.handleError)),t}findIfd0Offset(){this.ifd0Offset===void 0&&(this.ifd0Offset=this.chunk.getUint32(4))}findIfd1Offset(){if(this.ifd1Offset===void 0){this.findIfd0Offset();let e=this.chunk.getUint16(this.ifd0Offset),t=this.ifd0Offset+2+12*e;this.ifd1Offset=this.chunk.getUint32(t)}}parseBlock(e,t){let r=new Map;return this[t]=r,this.parseTags(e,t,r),r}async parseIfd0Block(){if(this.ifd0)return;let{file:e}=this;this.findIfd0Offset(),this.ifd0Offset<8&&Se("Malformed EXIF data"),!e.chunked&&this.ifd0Offset>e.byteLength&&Se(`IFD0 offset points to outside of file.
this.ifd0Offset: ${this.ifd0Offset}, file.byteLength: ${e.byteLength}`),e.tiff&&await e.ensureChunk(this.ifd0Offset,an(this.options));let t=this.parseBlock(this.ifd0Offset,"ifd0");return t.size!==0?(this.exifOffset=t.get(34665),this.interopOffset=t.get(40965),this.gpsOffset=t.get(34853),this.xmp=t.get(700),this.iptc=t.get(33723),this.icc=t.get(34675),this.options.sanitize&&(t.delete(34665),t.delete(40965),t.delete(34853),t.delete(700),t.delete(33723),t.delete(34675)),t):void 0}async parseExifBlock(){if(this.exif||(this.ifd0||await this.parseIfd0Block(),this.exifOffset===void 0))return;this.file.tiff&&await this.file.ensureChunk(this.exifOffset,an(this.options));let e=this.parseBlock(this.exifOffset,"exif");return this.interopOffset||(this.interopOffset=e.get(40965)),this.makerNote=e.get(37500),this.userComment=e.get(37510),this.options.sanitize&&(e.delete(40965),e.delete(37500),e.delete(37510)),this.unpack(e,41728),this.unpack(e,41729),e}unpack(e,t){let r=e.get(t);r&&r.length===1&&e.set(t,r[0])}async parseGpsBlock(){if(this.gps||(this.ifd0||await this.parseIfd0Block(),this.gpsOffset===void 0))return;let e=this.parseBlock(this.gpsOffset,"gps");return e&&e.has(2)&&e.has(4)&&(e.set("latitude",sr(...e.get(2),e.get(1))),e.set("longitude",sr(...e.get(4),e.get(3)))),e}async parseInteropBlock(){if(!this.interop&&(this.ifd0||await this.parseIfd0Block(),this.interopOffset!==void 0||this.exif||await this.parseExifBlock(),this.interopOffset!==void 0))return this.parseBlock(this.interopOffset,"interop")}async parseThumbnailBlock(e=!1){if(!this.ifd1&&!this.ifd1Parsed&&(!this.options.mergeOutput||e))return this.findIfd1Offset(),this.ifd1Offset>0&&(this.parseBlock(this.ifd1Offset,"ifd1"),this.ifd1Parsed=!0),this.ifd1}async extractThumbnail(){if(this.headerParsed||this.parseHeader(),this.ifd1Parsed||await this.parseThumbnailBlock(!0),this.ifd1===void 0)return;let e=this.ifd1.get(513),t=this.ifd1.get(514);return this.chunk.getUint8Array(e,t)}get image(){return this.ifd0}get thumbnail(){return this.ifd1}createOutput(){let e,t,r,i={};for(t of be)if(e=this[t],!Fr(e))if(r=this.canTranslate?this.translateBlock(e,t):Object.fromEntries(e),this.options.mergeOutput){if(t==="ifd1")continue;Object.assign(i,r)}else i[t]=r;return this.makerNote&&(i.makerNote=this.makerNote),this.userComment&&(i.userComment=this.userComment),i}assignToOutput(e,t){if(this.globalOptions.mergeOutput)Object.assign(e,t);else for(let[r,i]of Object.entries(t))this.assignObjectToOutput(e,r,i)}}function sr(n,e,t,r){var i=n+e/60+t/3600;return r!=="S"&&r!=="W"||(i*=-1),i}Z(Qt,"type","tiff"),Z(Qt,"headerLength",10),ke.set("tiff",Qt);var ti=Object.freeze({__proto__:null,default:Ks,Exifr:Qe,fileParsers:Oe,segmentParsers:ke,fileReaders:Be,tagKeys:Pe,tagValues:Fe,tagRevivers:Je,createDictionary:we,extendDictionary:it,fetchUrlAsArrayBuffer:rt,readBlobAsArrayBuffer:st,chunkedProps:Ge,otherSegments:ft,segments:ot,tiffBlocks:be,segmentsAndBlocks:Xe,tiffExtractables:Ye,inheritables:pt,allFormatters:Ke,Options:at,parse:Vt});const wn={ifd0:!1,ifd1:!1,exif:!1,gps:!1,interop:!1,sanitize:!1,reviveValues:!0,translateKeys:!1,translateValues:!1,mergeOutput:!1},kn=Object.assign({},wn,{firstChunkSize:4e4,gps:[1,2,3,4]});async function Br(n){let e=new Qe(kn);await e.read(n);let t=await e.parse();if(t&&t.gps){let{latitude:r,longitude:i}=t.gps;return{latitude:r,longitude:i}}}const Sn=Object.assign({},wn,{tiff:!1,ifd1:!0,mergeOutput:!1});async function Ur(n){let e=new Qe(Sn);await e.read(n);let t=await e.extractThumbnail();return t&&Ht?Wt.from(t):t}async function $r(n){let e=await this.thumbnail(n);if(e!==void 0){let t=new Blob([e]);return URL.createObjectURL(t)}}const Cn=Object.assign({},wn,{firstChunkSize:4e4,ifd0:[274]});async function jn(n){let e=new Qe(Cn);await e.read(n);let t=await e.parse();if(t&&t.ifd0)return t.ifd0[274]}const In=Object.freeze({1:{dimensionSwapped:!1,scaleX:1,scaleY:1,deg:0,rad:0},2:{dimensionSwapped:!1,scaleX:-1,scaleY:1,deg:0,rad:0},3:{dimensionSwapped:!1,scaleX:1,scaleY:1,deg:180,rad:180*Math.PI/180},4:{dimensionSwapped:!1,scaleX:-1,scaleY:1,deg:180,rad:180*Math.PI/180},5:{dimensionSwapped:!0,scaleX:1,scaleY:-1,deg:90,rad:90*Math.PI/180},6:{dimensionSwapped:!0,scaleX:1,scaleY:1,deg:90,rad:90*Math.PI/180},7:{dimensionSwapped:!0,scaleX:1,scaleY:-1,deg:270,rad:270*Math.PI/180},8:{dimensionSwapped:!0,scaleX:1,scaleY:1,deg:270,rad:270*Math.PI/180}});let tt=!0,nt=!0;if(typeof navigator=="object"){let n=navigator.userAgent;if(n.includes("iPad")||n.includes("iPhone")){let e=n.match(/OS (\d+)_(\d+)/);if(e){let[,t,r]=e;tt=Number(t)+.1*Number(r)<13.4,nt=!1}}else if(n.includes("OS X 10")){let[,e]=n.match(/OS X 10[_.](\d+)/);tt=nt=Number(e)<15}if(n.includes("Chrome/")){let[,e]=n.match(/Chrome\/(\d+)/);tt=nt=Number(e)<81}else if(n.includes("Firefox/")){let[,e]=n.match(/Firefox\/(\d+)/);tt=nt=Number(e)<77}}async function zr(n){let e=await jn(n);return Object.assign({canvas:tt,css:nt},In[e])}class ni extends Ze{constructor(...e){super(...e),Z(this,"ranges",new ri),this.byteLength!==0&&this.ranges.add(0,this.byteLength)}_tryExtend(e,t,r){if(e===0&&this.byteLength===0&&r){let i=new DataView(r.buffer||r,r.byteOffset,r.byteLength);this._swapDataView(i)}else{let i=e+t;if(i>this.byteLength){let{dataView:o}=this._extend(i);this._swapDataView(o)}}}_extend(e){let t;t=Ht?Wt.allocUnsafe(e):new Uint8Array(e);let r=new DataView(t.buffer,t.byteOffset,t.byteLength);return t.set(new Uint8Array(this.buffer,this.byteOffset,this.byteLength),0),{uintView:t,dataView:r}}subarray(e,t,r=!1){return t=t||this._lengthToEnd(e),r&&this._tryExtend(e,t),this.ranges.add(e,t),super.subarray(e,t)}set(e,t,r=!1){r&&this._tryExtend(t,e.byteLength,e);let i=super.set(e,t);return this.ranges.add(t,i.byteLength),i}async ensureChunk(e,t){this.chunked&&(this.ranges.available(e,t)||await this.readChunk(e,t))}available(e,t){return this.ranges.available(e,t)}}class ri{constructor(){Z(this,"list",[])}get length(){return this.list.length}add(e,t,r=0){let i=e+t,o=this.list.filter(a=>ir(e,a.offset,i)||ir(e,a.end,i));if(o.length>0){e=Math.min(e,...o.map(l=>l.offset)),i=Math.max(i,...o.map(l=>l.end)),t=i-e;let a=o.shift();a.offset=e,a.length=t,a.end=i,this.list=this.list.filter(l=>!o.includes(l))}else this.list.push({offset:e,length:t,end:i})}available(e,t){let r=e+t;return this.list.some(i=>i.offset<=e&&r<=i.end)}}function ir(n,e,t){return n<=e&&e<=t}class Gt extends ni{constructor(e,t){super(0),Z(this,"chunksRead",0),this.input=e,this.options=t}async readWhole(){this.chunked=!1,await this.readChunk(this.nextChunkOffset)}async readChunked(){this.chunked=!0,await this.readChunk(0,this.options.firstChunkSize)}async readNextChunk(e=this.nextChunkOffset){if(this.fullyRead)return this.chunksRead++,!1;let t=this.options.chunkSize,r=await this.readChunk(e,t);return!!r&&r.byteLength===t}async readChunk(e,t){if(this.chunksRead++,(t=this.safeWrapAddress(e,t))!==0)return this._readChunk(e,t)}safeWrapAddress(e,t){return this.size!==void 0&&e+t>this.size?Math.max(0,this.size-e):t}get nextChunkOffset(){if(this.ranges.list.length!==0)return this.ranges.list[0].length}get canReadNextChunk(){return this.chunksRead<this.options.chunkLimit}get fullyRead(){return this.size!==void 0&&this.nextChunkOffset===this.size}read(){return this.options.chunked?this.readChunked():this.readWhole()}close(){}}Be.set("blob",class extends Gt{async readWhole(){this.chunked=!1;let n=await st(this.input);this._swapArrayBuffer(n)}readChunked(){return this.chunked=!0,this.size=this.input.size,super.readChunked()}async _readChunk(n,e){let t=e?n+e:void 0,r=this.input.slice(n,t),i=await st(r);return this.set(i,n,!0)}});var si=Object.freeze({__proto__:null,default:ti,Exifr:Qe,fileParsers:Oe,segmentParsers:ke,fileReaders:Be,tagKeys:Pe,tagValues:Fe,tagRevivers:Je,createDictionary:we,extendDictionary:it,fetchUrlAsArrayBuffer:rt,readBlobAsArrayBuffer:st,chunkedProps:Ge,otherSegments:ft,segments:ot,tiffBlocks:be,segmentsAndBlocks:Xe,tiffExtractables:Ye,inheritables:pt,allFormatters:Ke,Options:at,parse:Vt,gpsOnlyOptions:kn,gps:Br,thumbnailOnlyOptions:Sn,thumbnail:Ur,thumbnailUrl:$r,orientationOnlyOptions:Cn,orientation:jn,rotations:In,get rotateCanvas(){return tt},get rotateCss(){return nt},rotation:zr});Be.set("url",class extends Gt{async readWhole(){this.chunked=!1;let n=await rt(this.input);n instanceof ArrayBuffer?this._swapArrayBuffer(n):n instanceof Uint8Array&&this._swapBuffer(n)}async _readChunk(n,e){let t=e?n+e-1:void 0,r=this.options.httpHeaders||{};(n||t)&&(r.range=`bytes=${[n,t].join("-")}`);let i=await bn(this.input,{headers:r}),o=await i.arrayBuffer(),a=o.byteLength;if(i.status!==416)return a!==e&&(this.size=n+a),this.set(o,n,!0)}});Ze.prototype.getUint64=function(n){let e=this.getUint32(n),t=this.getUint32(n+4);return e<1048575?e<<32|t:typeof Pt!==void 0?(console.warn("Using BigInt because of type 64uint but JS can only handle 53b numbers."),Pt(e)<<Pt(32)|Pt(t)):void Se("Trying to read 64b value but JS can only handle 53b numbers.")};class ii extends _t{parseBoxes(e=0){let t=[];for(;e<this.file.byteLength-4;){let r=this.parseBoxHead(e);if(t.push(r),r.length===0)break;e+=r.length}return t}parseSubBoxes(e){e.boxes=this.parseBoxes(e.start)}findBox(e,t){return e.boxes===void 0&&this.parseSubBoxes(e),e.boxes.find(r=>r.kind===t)}parseBoxHead(e){let t=this.file.getUint32(e),r=this.file.getString(e+4,4),i=e+8;return t===1&&(t=this.file.getUint64(e+8),i+=8),{offset:e,length:t,kind:r,start:i}}parseBoxFullHead(e){if(e.version!==void 0)return;let t=this.file.getUint32(e.start);e.version=t>>24,e.start+=4}}class Wr extends ii{static canHandle(e,t){if(t!==0)return!1;let r=e.getUint16(2);if(r>50)return!1;let i=16,o=[];for(;i<r;)o.push(e.getString(i,4)),i+=4;return o.includes(this.type)}async parse(){let e=this.file.getUint32(0),t=this.parseBoxHead(e);for(;t.kind!=="meta";)e+=t.length,await this.file.ensureChunk(e,16),t=this.parseBoxHead(e);await this.file.ensureChunk(t.offset,t.length),this.parseBoxFullHead(t),this.parseSubBoxes(t),this.options.icc.enabled&&await this.findIcc(t),this.options.tiff.enabled&&await this.findExif(t)}async registerSegment(e,t,r){await this.file.ensureChunk(t,r);let i=this.file.subarray(t,r);this.createParser(e,i)}async findIcc(e){let t=this.findBox(e,"iprp");if(t===void 0)return;let r=this.findBox(t,"ipco");if(r===void 0)return;let i=this.findBox(r,"colr");i!==void 0&&await this.registerSegment("icc",i.offset+12,i.length)}async findExif(e){let t=this.findBox(e,"iinf");if(t===void 0)return;let r=this.findBox(e,"iloc");if(r===void 0)return;let i=this.findExifLocIdInIinf(t),o=this.findExtentInIloc(r,i);if(o===void 0)return;let[a,l]=o;await this.file.ensureChunk(a,l);let h=4+this.file.getUint32(a);a+=h,l-=h,await this.registerSegment("tiff",a,l)}findExifLocIdInIinf(e){this.parseBoxFullHead(e);let t,r,i,o,a=e.start,l=this.file.getUint16(a);for(a+=2;l--;){if(t=this.parseBoxHead(a),this.parseBoxFullHead(t),r=t.start,t.version>=2&&(i=t.version===3?4:2,o=this.file.getString(r+i+2,4),o==="Exif"))return this.file.getUintBytes(r,i);a+=t.length}}get8bits(e){let t=this.file.getUint8(e);return[t>>4,15&t]}findExtentInIloc(e,t){this.parseBoxFullHead(e);let r=e.start,[i,o]=this.get8bits(r++),[a,l]=this.get8bits(r++),h=e.version===2?4:2,u=e.version===1||e.version===2?2:0,d=l+i+o,g=e.version===2?4:2,k=this.file.getUintBytes(r,g);for(r+=g;k--;){let D=this.file.getUintBytes(r,h);r+=h+u+2+a;let I=this.file.getUint16(r);if(r+=2,D===t)return I>1&&console.warn(`ILOC box has more than one extent but we're only processing one
Please create an issue at https://github.com/MikeKovarik/exifr with this file`),[this.file.getUintBytes(r+l,i),this.file.getUintBytes(r+l+i,o)];r+=I*d}}}class Hr extends Wr{}Z(Hr,"type","heic");class or extends Wr{}Z(or,"type","avif"),Oe.set("heic",Hr),Oe.set("avif",or),we(Pe,["ifd0","ifd1"],[[256,"ImageWidth"],[257,"ImageHeight"],[258,"BitsPerSample"],[259,"Compression"],[262,"PhotometricInterpretation"],[270,"ImageDescription"],[271,"Make"],[272,"Model"],[273,"StripOffsets"],[274,"Orientation"],[277,"SamplesPerPixel"],[278,"RowsPerStrip"],[279,"StripByteCounts"],[282,"XResolution"],[283,"YResolution"],[284,"PlanarConfiguration"],[296,"ResolutionUnit"],[301,"TransferFunction"],[305,"Software"],[306,"ModifyDate"],[315,"Artist"],[316,"HostComputer"],[317,"Predictor"],[318,"WhitePoint"],[319,"PrimaryChromaticities"],[513,"ThumbnailOffset"],[514,"ThumbnailLength"],[529,"YCbCrCoefficients"],[530,"YCbCrSubSampling"],[531,"YCbCrPositioning"],[532,"ReferenceBlackWhite"],[700,"ApplicationNotes"],[33432,"Copyright"],[33723,"IPTC"],[34665,"ExifIFD"],[34675,"ICC"],[34853,"GpsIFD"],[330,"SubIFD"],[40965,"InteropIFD"],[40091,"XPTitle"],[40092,"XPComment"],[40093,"XPAuthor"],[40094,"XPKeywords"],[40095,"XPSubject"]]),we(Pe,"exif",[[33434,"ExposureTime"],[33437,"FNumber"],[34850,"ExposureProgram"],[34852,"SpectralSensitivity"],[34855,"ISO"],[34858,"TimeZoneOffset"],[34859,"SelfTimerMode"],[34864,"SensitivityType"],[34865,"StandardOutputSensitivity"],[34866,"RecommendedExposureIndex"],[34867,"ISOSpeed"],[34868,"ISOSpeedLatitudeyyy"],[34869,"ISOSpeedLatitudezzz"],[36864,"ExifVersion"],[36867,"DateTimeOriginal"],[36868,"CreateDate"],[36873,"GooglePlusUploadCode"],[36880,"OffsetTime"],[36881,"OffsetTimeOriginal"],[36882,"OffsetTimeDigitized"],[37121,"ComponentsConfiguration"],[37122,"CompressedBitsPerPixel"],[37377,"ShutterSpeedValue"],[37378,"ApertureValue"],[37379,"BrightnessValue"],[37380,"ExposureCompensation"],[37381,"MaxApertureValue"],[37382,"SubjectDistance"],[37383,"MeteringMode"],[37384,"LightSource"],[37385,"Flash"],[37386,"FocalLength"],[37393,"ImageNumber"],[37394,"SecurityClassification"],[37395,"ImageHistory"],[37396,"SubjectArea"],[37500,"MakerNote"],[37510,"UserComment"],[37520,"SubSecTime"],[37521,"SubSecTimeOriginal"],[37522,"SubSecTimeDigitized"],[37888,"AmbientTemperature"],[37889,"Humidity"],[37890,"Pressure"],[37891,"WaterDepth"],[37892,"Acceleration"],[37893,"CameraElevationAngle"],[40960,"FlashpixVersion"],[40961,"ColorSpace"],[40962,"ExifImageWidth"],[40963,"ExifImageHeight"],[40964,"RelatedSoundFile"],[41483,"FlashEnergy"],[41486,"FocalPlaneXResolution"],[41487,"FocalPlaneYResolution"],[41488,"FocalPlaneResolutionUnit"],[41492,"SubjectLocation"],[41493,"ExposureIndex"],[41495,"SensingMethod"],[41728,"FileSource"],[41729,"SceneType"],[41730,"CFAPattern"],[41985,"CustomRendered"],[41986,"ExposureMode"],[41987,"WhiteBalance"],[41988,"DigitalZoomRatio"],[41989,"FocalLengthIn35mmFormat"],[41990,"SceneCaptureType"],[41991,"GainControl"],[41992,"Contrast"],[41993,"Saturation"],[41994,"Sharpness"],[41996,"SubjectDistanceRange"],[42016,"ImageUniqueID"],[42032,"OwnerName"],[42033,"SerialNumber"],[42034,"LensInfo"],[42035,"LensMake"],[42036,"LensModel"],[42037,"LensSerialNumber"],[42080,"CompositeImage"],[42081,"CompositeImageCount"],[42082,"CompositeImageExposureTimes"],[42240,"Gamma"],[59932,"Padding"],[59933,"OffsetSchema"],[65e3,"OwnerName"],[65001,"SerialNumber"],[65002,"Lens"],[65100,"RawFile"],[65101,"Converter"],[65102,"WhiteBalance"],[65105,"Exposure"],[65106,"Shadows"],[65107,"Brightness"],[65108,"Contrast"],[65109,"Saturation"],[65110,"Sharpness"],[65111,"Smoothness"],[65112,"MoireFilter"],[40965,"InteropIFD"]]),we(Pe,"gps",[[0,"GPSVersionID"],[1,"GPSLatitudeRef"],[2,"GPSLatitude"],[3,"GPSLongitudeRef"],[4,"GPSLongitude"],[5,"GPSAltitudeRef"],[6,"GPSAltitude"],[7,"GPSTimeStamp"],[8,"GPSSatellites"],[9,"GPSStatus"],[10,"GPSMeasureMode"],[11,"GPSDOP"],[12,"GPSSpeedRef"],[13,"GPSSpeed"],[14,"GPSTrackRef"],[15,"GPSTrack"],[16,"GPSImgDirectionRef"],[17,"GPSImgDirection"],[18,"GPSMapDatum"],[19,"GPSDestLatitudeRef"],[20,"GPSDestLatitude"],[21,"GPSDestLongitudeRef"],[22,"GPSDestLongitude"],[23,"GPSDestBearingRef"],[24,"GPSDestBearing"],[25,"GPSDestDistanceRef"],[26,"GPSDestDistance"],[27,"GPSProcessingMethod"],[28,"GPSAreaInformation"],[29,"GPSDateStamp"],[30,"GPSDifferential"],[31,"GPSHPositioningError"]]),we(Fe,["ifd0","ifd1"],[[274,{1:"Horizontal (normal)",2:"Mirror horizontal",3:"Rotate 180",4:"Mirror vertical",5:"Mirror horizontal and rotate 270 CW",6:"Rotate 90 CW",7:"Mirror horizontal and rotate 90 CW",8:"Rotate 270 CW"}],[296,{1:"None",2:"inches",3:"cm"}]]);let bt=we(Fe,"exif",[[34850,{0:"Not defined",1:"Manual",2:"Normal program",3:"Aperture priority",4:"Shutter priority",5:"Creative program",6:"Action program",7:"Portrait mode",8:"Landscape mode"}],[37121,{0:"-",1:"Y",2:"Cb",3:"Cr",4:"R",5:"G",6:"B"}],[37383,{0:"Unknown",1:"Average",2:"CenterWeightedAverage",3:"Spot",4:"MultiSpot",5:"Pattern",6:"Partial",255:"Other"}],[37384,{0:"Unknown",1:"Daylight",2:"Fluorescent",3:"Tungsten (incandescent light)",4:"Flash",9:"Fine weather",10:"Cloudy weather",11:"Shade",12:"Daylight fluorescent (D 5700 - 7100K)",13:"Day white fluorescent (N 4600 - 5400K)",14:"Cool white fluorescent (W 3900 - 4500K)",15:"White fluorescent (WW 3200 - 3700K)",17:"Standard light A",18:"Standard light B",19:"Standard light C",20:"D55",21:"D65",22:"D75",23:"D50",24:"ISO studio tungsten",255:"Other"}],[37385,{0:"Flash did not fire",1:"Flash fired",5:"Strobe return light not detected",7:"Strobe return light detected",9:"Flash fired, compulsory flash mode",13:"Flash fired, compulsory flash mode, return light not detected",15:"Flash fired, compulsory flash mode, return light detected",16:"Flash did not fire, compulsory flash mode",24:"Flash did not fire, auto mode",25:"Flash fired, auto mode",29:"Flash fired, auto mode, return light not detected",31:"Flash fired, auto mode, return light detected",32:"No flash function",65:"Flash fired, red-eye reduction mode",69:"Flash fired, red-eye reduction mode, return light not detected",71:"Flash fired, red-eye reduction mode, return light detected",73:"Flash fired, compulsory flash mode, red-eye reduction mode",77:"Flash fired, compulsory flash mode, red-eye reduction mode, return light not detected",79:"Flash fired, compulsory flash mode, red-eye reduction mode, return light detected",89:"Flash fired, auto mode, red-eye reduction mode",93:"Flash fired, auto mode, return light not detected, red-eye reduction mode",95:"Flash fired, auto mode, return light detected, red-eye reduction mode"}],[41495,{1:"Not defined",2:"One-chip color area sensor",3:"Two-chip color area sensor",4:"Three-chip color area sensor",5:"Color sequential area sensor",7:"Trilinear sensor",8:"Color sequential linear sensor"}],[41728,{1:"Film Scanner",2:"Reflection Print Scanner",3:"Digital Camera"}],[41729,{1:"Directly photographed"}],[41985,{0:"Normal",1:"Custom",2:"HDR (no original saved)",3:"HDR (original saved)",4:"Original (for HDR)",6:"Panorama",7:"Portrait HDR",8:"Portrait"}],[41986,{0:"Auto",1:"Manual",2:"Auto bracket"}],[41987,{0:"Auto",1:"Manual"}],[41990,{0:"Standard",1:"Landscape",2:"Portrait",3:"Night",4:"Other"}],[41991,{0:"None",1:"Low gain up",2:"High gain up",3:"Low gain down",4:"High gain down"}],[41996,{0:"Unknown",1:"Macro",2:"Close",3:"Distant"}],[42080,{0:"Unknown",1:"Not a Composite Image",2:"General Composite Image",3:"Composite Image Captured While Shooting"}]]);const ar={1:"No absolute unit of measurement",2:"Inch",3:"Centimeter"};bt.set(37392,ar),bt.set(41488,ar);const en={0:"Normal",1:"Low",2:"High"};function lr(n){return typeof n=="object"&&n.length!==void 0?n[0]:n}function cr(n){let e=Array.from(n).slice(1);return e[1]>15&&(e=e.map(t=>String.fromCharCode(t))),e[2]!=="0"&&e[2]!==0||e.pop(),e.join(".")}function tn(n){if(typeof n=="string"){var[e,t,r,i,o,a]=n.trim().split(/[-: ]/g).map(Number),l=new Date(e,t-1,r);return Number.isNaN(i)||Number.isNaN(o)||Number.isNaN(a)||(l.setHours(i),l.setMinutes(o),l.setSeconds(a)),Number.isNaN(+l)?n:l}}function xt(n){if(typeof n=="string")return n;let e=[];if(n[1]===0&&n[n.length-1]===0)for(let t=0;t<n.length;t+=2)e.push(dr(n[t+1],n[t]));else for(let t=0;t<n.length;t+=2)e.push(dr(n[t],n[t+1]));return et(String.fromCodePoint(...e))}function dr(n,e){return n<<8|e}bt.set(41992,en),bt.set(41993,en),bt.set(41994,en),we(Je,["ifd0","ifd1"],[[50827,function(n){return typeof n!="string"?Rr(n):n}],[306,tn],[40091,xt],[40092,xt],[40093,xt],[40094,xt],[40095,xt]]),we(Je,"exif",[[40960,cr],[36864,cr],[36867,tn],[36868,tn],[40962,lr],[40963,lr]]),we(Je,"gps",[[0,n=>Array.from(n).join(".")],[7,n=>Array.from(n).join(":")]]);class nn extends Le{static canHandle(e,t){return e.getUint8(t+1)===225&&e.getUint32(t+4)===1752462448&&e.getString(t+4,20)==="http://ns.adobe.com/"}static headerLength(e,t){return e.getString(t+4,34)==="http://ns.adobe.com/xmp/extension/"?79:33}static findPosition(e,t){let r=super.findPosition(e,t);return r.multiSegment=r.extended=r.headerLength===79,r.multiSegment?(r.chunkCount=e.getUint8(t+72),r.chunkNumber=e.getUint8(t+76),e.getUint8(t+77)!==0&&r.chunkNumber++):(r.chunkCount=1/0,r.chunkNumber=-1),r}static handleMultiSegments(e){return e.map(t=>t.chunk.getString()).join("")}normalizeInput(e){return typeof e=="string"?e:Ze.from(e).getString()}parse(e=this.chunk){if(!this.localOptions.parse)return e;e=function(o){let a={},l={};for(let h of Xr)a[h]=[],l[h]=0;return o.replace(ci,(h,u,d)=>{if(u==="<"){let g=++l[d];return a[d].push(g),`${h}#${g}`}return`${h}#${a[d].pop()}`})}(e);let t=ut.findAll(e,"rdf","Description");t.length===0&&t.push(new ut("rdf","Description",void 0,e));let r,i={};for(let o of t)for(let a of o.properties)r=li(a.ns,i),Vr(a,r);return function(o){let a;for(let l in o)a=o[l]=Ft(o[l]),a===void 0&&delete o[l];return Ft(o)}(i)}assignToOutput(e,t){if(this.localOptions.parse)for(let[r,i]of Object.entries(t))switch(r){case"tiff":this.assignObjectToOutput(e,"ifd0",i);break;case"exif":this.assignObjectToOutput(e,"exif",i);break;case"xmlns":break;default:this.assignObjectToOutput(e,r,i)}else e.xmp=t}}Z(nn,"type","xmp"),Z(nn,"multiSegment",!0),ke.set("xmp",nn);class Ot{static findAll(e){return _r(e,/([a-zA-Z0-9-]+):([a-zA-Z0-9-]+)=("[^"]*"|'[^']*')/gm).map(Ot.unpackMatch)}static unpackMatch(e){let t=e[1],r=e[2],i=e[3].slice(1,-1);return i=Gr(i),new Ot(t,r,i)}constructor(e,t,r){this.ns=e,this.name=t,this.value=r}serialize(){return this.value}}class ut{static findAll(e,t,r){if(t!==void 0||r!==void 0){t=t||"[\\w\\d-]+",r=r||"[\\w\\d-]+";var i=new RegExp(`<(${t}):(${r})(#\\d+)?((\\s+?[\\w\\d-:]+=("[^"]*"|'[^']*'))*\\s*)(\\/>|>([\\s\\S]*?)<\\/\\1:\\2\\3>)`,"gm")}else i=/<([\w\d-]+):([\w\d-]+)(#\d+)?((\s+?[\w\d-:]+=("[^"]*"|'[^']*'))*\s*)(\/>|>([\s\S]*?)<\/\1:\2\3>)/gm;return _r(e,i).map(ut.unpackMatch)}static unpackMatch(e){let t=e[1],r=e[2],i=e[4],o=e[8];return new ut(t,r,i,o)}constructor(e,t,r,i){this.ns=e,this.name=t,this.attrString=r,this.innerXml=i,this.attrs=Ot.findAll(r),this.children=ut.findAll(i),this.value=this.children.length===0?Gr(i):void 0,this.properties=[...this.attrs,...this.children]}get isPrimitive(){return this.value!==void 0&&this.attrs.length===0&&this.children.length===0}get isListContainer(){return this.children.length===1&&this.children[0].isList}get isList(){let{ns:e,name:t}=this;return e==="rdf"&&(t==="Seq"||t==="Bag"||t==="Alt")}get isListItem(){return this.ns==="rdf"&&this.name==="li"}serialize(){if(this.properties.length===0&&this.value===void 0)return;if(this.isPrimitive)return this.value;if(this.isListContainer)return this.children[0].serialize();if(this.isList)return ai(this.children.map(oi));if(this.isListItem&&this.children.length===1&&this.attrs.length===0)return this.children[0].serialize();let e={};for(let t of this.properties)Vr(t,e);return this.value!==void 0&&(e.value=this.value),Ft(e)}}function Vr(n,e){let t=n.serialize();t!==void 0&&(e[n.name]=t)}var oi=n=>n.serialize(),ai=n=>n.length===1?n[0]:n,li=(n,e)=>e[n]?e[n]:e[n]={};function _r(n,e){let t,r=[];if(!n)return r;for(;(t=e.exec(n))!==null;)r.push(t);return r}function Gr(n){if(function(r){return r==null||r==="null"||r==="undefined"||r===""||r.trim()===""}(n))return;let e=Number(n);if(!Number.isNaN(e))return e;let t=n.toLowerCase();return t==="true"||t!=="false"&&n.trim()}const Xr=["rdf:li","rdf:Seq","rdf:Bag","rdf:Alt","rdf:Description"],ci=new RegExp(`(<|\\/)(${Xr.join("|")})`,"g");var di=Object.freeze({__proto__:null,default:si,Exifr:Qe,fileParsers:Oe,segmentParsers:ke,fileReaders:Be,tagKeys:Pe,tagValues:Fe,tagRevivers:Je,createDictionary:we,extendDictionary:it,fetchUrlAsArrayBuffer:rt,readBlobAsArrayBuffer:st,chunkedProps:Ge,otherSegments:ft,segments:ot,tiffBlocks:be,segmentsAndBlocks:Xe,tiffExtractables:Ye,inheritables:pt,allFormatters:Ke,Options:at,parse:Vt,gpsOnlyOptions:kn,gps:Br,thumbnailOnlyOptions:Sn,thumbnail:Ur,thumbnailUrl:$r,orientationOnlyOptions:Cn,orientation:jn,rotations:In,get rotateCanvas(){return tt},get rotateCss(){return nt},rotation:zr});let ur=Lt("fs",n=>n.promises);Be.set("fs",class extends Gt{async readWhole(){this.chunked=!1,this.fs=await ur;let n=await this.fs.readFile(this.input);this._swapBuffer(n)}async readChunked(){this.chunked=!0,this.fs=await ur,await this.open(),await this.readChunk(0,this.options.firstChunkSize)}async open(){this.fh===void 0&&(this.fh=await this.fs.open(this.input,"r"),this.size=(await this.fh.stat(this.input)).size)}async _readChunk(n,e){this.fh===void 0&&await this.open(),n+e>this.size&&(e=this.size-n);var t=this.subarray(n,e,!0);return await this.fh.read(t.dataView,0,e,n),t}async close(){if(this.fh){let n=this.fh;this.fh=void 0,await n.close()}}});Be.set("base64",class extends Gt{constructor(...n){super(...n),this.input=this.input.replace(/^data:([^;]+);base64,/gim,""),this.size=this.input.length/4*3,this.input.endsWith("==")?this.size-=2:this.input.endsWith("=")&&(this.size-=1)}async _readChunk(n,e){let t,r,i=this.input;n===void 0?(n=0,t=0,r=0):(t=4*Math.floor(n/3),r=n-t/4*3),e===void 0&&(e=this.size);let o=n+e,a=t+4*Math.ceil(o/3);i=i.slice(t,a);let l=Math.min(e,this.size-n);if(Ht){let h=Wt.from(i,"base64").slice(r,r+l);return this.set(h,n,!0)}{let h=this.subarray(n,l,!0),u=atob(i),d=h.toUint8();for(let g=0;g<l;g++)d[g]=u.charCodeAt(r+g);return h}}});class hr extends _t{static canHandle(e,t){return t===18761||t===19789}extendOptions(e){let{ifd0:t,xmp:r,iptc:i,icc:o}=e;r.enabled&&t.deps.add(700),i.enabled&&t.deps.add(33723),o.enabled&&t.deps.add(34675),t.finalizeFilters()}async parse(){let{tiff:e,xmp:t,iptc:r,icc:i}=this.options;if(e.enabled||t.enabled||r.enabled||i.enabled){let o=Math.max(an(this.options),this.options.chunkSize);await this.file.ensureChunk(0,o),this.createParser("tiff",this.file),this.parsers.tiff.parseHeader(),await this.parsers.tiff.parseIfd0Block(),this.adaptTiffPropAsSegment("xmp"),this.adaptTiffPropAsSegment("iptc"),this.adaptTiffPropAsSegment("icc")}}adaptTiffPropAsSegment(e){if(this.parsers.tiff[e]){let t=this.parsers.tiff[e];this.injectSegment(e,t)}}}Z(hr,"type","tiff"),Oe.set("tiff",hr);let ui=Lt("zlib");const hi=["ihdr","iccp","text","itxt","exif"];class fr extends _t{constructor(...e){super(...e),Z(this,"catchError",t=>this.errors.push(t)),Z(this,"metaChunks",[]),Z(this,"unknownChunks",[])}static canHandle(e,t){return t===35152&&e.getUint32(0)===2303741511&&e.getUint32(4)===218765834}async parse(){let{file:e}=this;await this.findPngChunksInRange(8,e.byteLength),await this.readSegments(this.metaChunks),this.findIhdr(),this.parseTextChunks(),await this.findExif().catch(this.catchError),await this.findXmp().catch(this.catchError),await this.findIcc().catch(this.catchError)}async findPngChunksInRange(e,t){let{file:r}=this;for(;e<t;){let i=r.getUint32(e),o=r.getUint32(e+4),a=r.getString(e+4,4).toLowerCase(),l=i+4+4+4,h={type:a,offset:e,length:l,start:e+4+4,size:i,marker:o};hi.includes(a)?this.metaChunks.push(h):this.unknownChunks.push(h),e+=l}}parseTextChunks(){let e=this.metaChunks.filter(t=>t.type==="text");for(let t of e){let[r,i]=this.file.getString(t.start,t.size).split("\0");this.injectKeyValToIhdr(r,i)}}injectKeyValToIhdr(e,t){let r=this.parsers.ihdr;r&&r.raw.set(e,t)}findIhdr(){let e=this.metaChunks.find(t=>t.type==="ihdr");e&&this.options.ihdr.enabled!==!1&&this.createParser("ihdr",e.chunk)}async findExif(){let e=this.metaChunks.find(t=>t.type==="exif");e&&this.injectSegment("tiff",e.chunk)}async findXmp(){let e=this.metaChunks.filter(t=>t.type==="itxt");for(let t of e)t.chunk.getString(0,17)==="XML:com.adobe.xmp"&&this.injectSegment("xmp",t.chunk)}async findIcc(){let e=this.metaChunks.find(l=>l.type==="iccp");if(!e)return;let{chunk:t}=e,r=t.getUint8Array(0,81),i=0;for(;i<80&&r[i]!==0;)i++;let o=i+2,a=t.getString(0,i);if(this.injectKeyValToIhdr("ProfileName",a),Dt){let l=await ui,h=t.getUint8Array(o);h=l.inflateSync(h),this.injectSegment("icc",h)}}}Z(fr,"type","png"),Oe.set("png",fr),we(Pe,"interop",[[1,"InteropIndex"],[2,"InteropVersion"],[4096,"RelatedImageFileFormat"],[4097,"RelatedImageWidth"],[4098,"RelatedImageHeight"]]),it(Pe,"ifd0",[[11,"ProcessingSoftware"],[254,"SubfileType"],[255,"OldSubfileType"],[263,"Thresholding"],[264,"CellWidth"],[265,"CellLength"],[266,"FillOrder"],[269,"DocumentName"],[280,"MinSampleValue"],[281,"MaxSampleValue"],[285,"PageName"],[286,"XPosition"],[287,"YPosition"],[290,"GrayResponseUnit"],[297,"PageNumber"],[321,"HalftoneHints"],[322,"TileWidth"],[323,"TileLength"],[332,"InkSet"],[337,"TargetPrinter"],[18246,"Rating"],[18249,"RatingPercent"],[33550,"PixelScale"],[34264,"ModelTransform"],[34377,"PhotoshopSettings"],[50706,"DNGVersion"],[50707,"DNGBackwardVersion"],[50708,"UniqueCameraModel"],[50709,"LocalizedCameraModel"],[50736,"DNGLensInfo"],[50739,"ShadowScale"],[50740,"DNGPrivateData"],[33920,"IntergraphMatrix"],[33922,"ModelTiePoint"],[34118,"SEMInfo"],[34735,"GeoTiffDirectory"],[34736,"GeoTiffDoubleParams"],[34737,"GeoTiffAsciiParams"],[50341,"PrintIM"],[50721,"ColorMatrix1"],[50722,"ColorMatrix2"],[50723,"CameraCalibration1"],[50724,"CameraCalibration2"],[50725,"ReductionMatrix1"],[50726,"ReductionMatrix2"],[50727,"AnalogBalance"],[50728,"AsShotNeutral"],[50729,"AsShotWhiteXY"],[50730,"BaselineExposure"],[50731,"BaselineNoise"],[50732,"BaselineSharpness"],[50734,"LinearResponseLimit"],[50735,"CameraSerialNumber"],[50741,"MakerNoteSafety"],[50778,"CalibrationIlluminant1"],[50779,"CalibrationIlluminant2"],[50781,"RawDataUniqueID"],[50827,"OriginalRawFileName"],[50828,"OriginalRawFileData"],[50831,"AsShotICCProfile"],[50832,"AsShotPreProfileMatrix"],[50833,"CurrentICCProfile"],[50834,"CurrentPreProfileMatrix"],[50879,"ColorimetricReference"],[50885,"SRawType"],[50898,"PanasonicTitle"],[50899,"PanasonicTitle2"],[50931,"CameraCalibrationSig"],[50932,"ProfileCalibrationSig"],[50933,"ProfileIFD"],[50934,"AsShotProfileName"],[50936,"ProfileName"],[50937,"ProfileHueSatMapDims"],[50938,"ProfileHueSatMapData1"],[50939,"ProfileHueSatMapData2"],[50940,"ProfileToneCurve"],[50941,"ProfileEmbedPolicy"],[50942,"ProfileCopyright"],[50964,"ForwardMatrix1"],[50965,"ForwardMatrix2"],[50966,"PreviewApplicationName"],[50967,"PreviewApplicationVersion"],[50968,"PreviewSettingsName"],[50969,"PreviewSettingsDigest"],[50970,"PreviewColorSpace"],[50971,"PreviewDateTime"],[50972,"RawImageDigest"],[50973,"OriginalRawFileDigest"],[50981,"ProfileLookTableDims"],[50982,"ProfileLookTableData"],[51043,"TimeCodes"],[51044,"FrameRate"],[51058,"TStop"],[51081,"ReelName"],[51089,"OriginalDefaultFinalSize"],[51090,"OriginalBestQualitySize"],[51091,"OriginalDefaultCropSize"],[51105,"CameraLabel"],[51107,"ProfileHueSatMapEncoding"],[51108,"ProfileLookTableEncoding"],[51109,"BaselineExposureOffset"],[51110,"DefaultBlackRender"],[51111,"NewRawImageDigest"],[51112,"RawToPreviewGain"]]);let pr=[[273,"StripOffsets"],[279,"StripByteCounts"],[288,"FreeOffsets"],[289,"FreeByteCounts"],[291,"GrayResponseCurve"],[292,"T4Options"],[293,"T6Options"],[300,"ColorResponseUnit"],[320,"ColorMap"],[324,"TileOffsets"],[325,"TileByteCounts"],[326,"BadFaxLines"],[327,"CleanFaxData"],[328,"ConsecutiveBadFaxLines"],[330,"SubIFD"],[333,"InkNames"],[334,"NumberofInks"],[336,"DotRange"],[338,"ExtraSamples"],[339,"SampleFormat"],[340,"SMinSampleValue"],[341,"SMaxSampleValue"],[342,"TransferRange"],[343,"ClipPath"],[344,"XClipPathUnits"],[345,"YClipPathUnits"],[346,"Indexed"],[347,"JPEGTables"],[351,"OPIProxy"],[400,"GlobalParametersIFD"],[401,"ProfileType"],[402,"FaxProfile"],[403,"CodingMethods"],[404,"VersionYear"],[405,"ModeNumber"],[433,"Decode"],[434,"DefaultImageColor"],[435,"T82Options"],[437,"JPEGTables"],[512,"JPEGProc"],[515,"JPEGRestartInterval"],[517,"JPEGLosslessPredictors"],[518,"JPEGPointTransforms"],[519,"JPEGQTables"],[520,"JPEGDCTables"],[521,"JPEGACTables"],[559,"StripRowCounts"],[999,"USPTOMiscellaneous"],[18247,"XP_DIP_XML"],[18248,"StitchInfo"],[28672,"SonyRawFileType"],[28688,"SonyToneCurve"],[28721,"VignettingCorrection"],[28722,"VignettingCorrParams"],[28724,"ChromaticAberrationCorrection"],[28725,"ChromaticAberrationCorrParams"],[28726,"DistortionCorrection"],[28727,"DistortionCorrParams"],[29895,"SonyCropTopLeft"],[29896,"SonyCropSize"],[32781,"ImageID"],[32931,"WangTag1"],[32932,"WangAnnotation"],[32933,"WangTag3"],[32934,"WangTag4"],[32953,"ImageReferencePoints"],[32954,"RegionXformTackPoint"],[32955,"WarpQuadrilateral"],[32956,"AffineTransformMat"],[32995,"Matteing"],[32996,"DataType"],[32997,"ImageDepth"],[32998,"TileDepth"],[33300,"ImageFullWidth"],[33301,"ImageFullHeight"],[33302,"TextureFormat"],[33303,"WrapModes"],[33304,"FovCot"],[33305,"MatrixWorldToScreen"],[33306,"MatrixWorldToCamera"],[33405,"Model2"],[33421,"CFARepeatPatternDim"],[33422,"CFAPattern2"],[33423,"BatteryLevel"],[33424,"KodakIFD"],[33445,"MDFileTag"],[33446,"MDScalePixel"],[33447,"MDColorTable"],[33448,"MDLabName"],[33449,"MDSampleInfo"],[33450,"MDPrepDate"],[33451,"MDPrepTime"],[33452,"MDFileUnits"],[33589,"AdventScale"],[33590,"AdventRevision"],[33628,"UIC1Tag"],[33629,"UIC2Tag"],[33630,"UIC3Tag"],[33631,"UIC4Tag"],[33918,"IntergraphPacketData"],[33919,"IntergraphFlagRegisters"],[33921,"INGRReserved"],[34016,"Site"],[34017,"ColorSequence"],[34018,"IT8Header"],[34019,"RasterPadding"],[34020,"BitsPerRunLength"],[34021,"BitsPerExtendedRunLength"],[34022,"ColorTable"],[34023,"ImageColorIndicator"],[34024,"BackgroundColorIndicator"],[34025,"ImageColorValue"],[34026,"BackgroundColorValue"],[34027,"PixelIntensityRange"],[34028,"TransparencyIndicator"],[34029,"ColorCharacterization"],[34030,"HCUsage"],[34031,"TrapIndicator"],[34032,"CMYKEquivalent"],[34152,"AFCP_IPTC"],[34232,"PixelMagicJBIGOptions"],[34263,"JPLCartoIFD"],[34306,"WB_GRGBLevels"],[34310,"LeafData"],[34687,"TIFF_FXExtensions"],[34688,"MultiProfiles"],[34689,"SharedData"],[34690,"T88Options"],[34732,"ImageLayer"],[34750,"JBIGOptions"],[34856,"Opto-ElectricConvFactor"],[34857,"Interlace"],[34908,"FaxRecvParams"],[34909,"FaxSubAddress"],[34910,"FaxRecvTime"],[34929,"FedexEDR"],[34954,"LeafSubIFD"],[37387,"FlashEnergy"],[37388,"SpatialFrequencyResponse"],[37389,"Noise"],[37390,"FocalPlaneXResolution"],[37391,"FocalPlaneYResolution"],[37392,"FocalPlaneResolutionUnit"],[37397,"ExposureIndex"],[37398,"TIFF-EPStandardID"],[37399,"SensingMethod"],[37434,"CIP3DataFile"],[37435,"CIP3Sheet"],[37436,"CIP3Side"],[37439,"StoNits"],[37679,"MSDocumentText"],[37680,"MSPropertySetStorage"],[37681,"MSDocumentTextPosition"],[37724,"ImageSourceData"],[40965,"InteropIFD"],[40976,"SamsungRawPointersOffset"],[40977,"SamsungRawPointersLength"],[41217,"SamsungRawByteOrder"],[41218,"SamsungRawUnknown"],[41484,"SpatialFrequencyResponse"],[41485,"Noise"],[41489,"ImageNumber"],[41490,"SecurityClassification"],[41491,"ImageHistory"],[41494,"TIFF-EPStandardID"],[41995,"DeviceSettingDescription"],[42112,"GDALMetadata"],[42113,"GDALNoData"],[44992,"ExpandSoftware"],[44993,"ExpandLens"],[44994,"ExpandFilm"],[44995,"ExpandFilterLens"],[44996,"ExpandScanner"],[44997,"ExpandFlashLamp"],[46275,"HasselbladRawImage"],[48129,"PixelFormat"],[48130,"Transformation"],[48131,"Uncompressed"],[48132,"ImageType"],[48256,"ImageWidth"],[48257,"ImageHeight"],[48258,"WidthResolution"],[48259,"HeightResolution"],[48320,"ImageOffset"],[48321,"ImageByteCount"],[48322,"AlphaOffset"],[48323,"AlphaByteCount"],[48324,"ImageDataDiscard"],[48325,"AlphaDataDiscard"],[50215,"OceScanjobDesc"],[50216,"OceApplicationSelector"],[50217,"OceIDNumber"],[50218,"OceImageLogic"],[50255,"Annotations"],[50459,"HasselbladExif"],[50547,"OriginalFileName"],[50560,"USPTOOriginalContentType"],[50656,"CR2CFAPattern"],[50710,"CFAPlaneColor"],[50711,"CFALayout"],[50712,"LinearizationTable"],[50713,"BlackLevelRepeatDim"],[50714,"BlackLevel"],[50715,"BlackLevelDeltaH"],[50716,"BlackLevelDeltaV"],[50717,"WhiteLevel"],[50718,"DefaultScale"],[50719,"DefaultCropOrigin"],[50720,"DefaultCropSize"],[50733,"BayerGreenSplit"],[50737,"ChromaBlurRadius"],[50738,"AntiAliasStrength"],[50752,"RawImageSegmentation"],[50780,"BestQualityScale"],[50784,"AliasLayerMetadata"],[50829,"ActiveArea"],[50830,"MaskedAreas"],[50935,"NoiseReductionApplied"],[50974,"SubTileBlockSize"],[50975,"RowInterleaveFactor"],[51008,"OpcodeList1"],[51009,"OpcodeList2"],[51022,"OpcodeList3"],[51041,"NoiseProfile"],[51114,"CacheVersion"],[51125,"DefaultUserCrop"],[51157,"NikonNEFInfo"],[65024,"KdcIFD"]];it(Pe,"ifd0",pr),it(Pe,"exif",pr),we(Fe,"gps",[[23,{M:"Magnetic North",T:"True North"}],[25,{K:"Kilometers",M:"Miles",N:"Nautical Miles"}]]);class rn extends Le{static canHandle(e,t){return e.getUint8(t+1)===224&&e.getUint32(t+4)===1246120262&&e.getUint8(t+8)===0}parse(){return this.parseTags(),this.translate(),this.output}parseTags(){this.raw=new Map([[0,this.chunk.getUint16(0)],[2,this.chunk.getUint8(2)],[3,this.chunk.getUint16(3)],[5,this.chunk.getUint16(5)],[7,this.chunk.getUint8(7)],[8,this.chunk.getUint8(8)]])}}Z(rn,"type","jfif"),Z(rn,"headerLength",9),ke.set("jfif",rn),we(Pe,"jfif",[[0,"JFIFVersion"],[2,"ResolutionUnit"],[3,"XResolution"],[5,"YResolution"],[7,"ThumbnailWidth"],[8,"ThumbnailHeight"]]);class gr extends Le{parse(){return this.parseTags(),this.translate(),this.output}parseTags(){this.raw=new Map([[0,this.chunk.getUint32(0)],[4,this.chunk.getUint32(4)],[8,this.chunk.getUint8(8)],[9,this.chunk.getUint8(9)],[10,this.chunk.getUint8(10)],[11,this.chunk.getUint8(11)],[12,this.chunk.getUint8(12)],...Array.from(this.raw)])}}Z(gr,"type","ihdr"),ke.set("ihdr",gr),we(Pe,"ihdr",[[0,"ImageWidth"],[4,"ImageHeight"],[8,"BitDepth"],[9,"ColorType"],[10,"Compression"],[11,"Filter"],[12,"Interlace"]]),we(Fe,"ihdr",[[9,{0:"Grayscale",2:"RGB",3:"Palette",4:"Grayscale with Alpha",6:"RGB with Alpha",DEFAULT:"Unknown"}],[10,{0:"Deflate/Inflate",DEFAULT:"Unknown"}],[11,{0:"Adaptive",DEFAULT:"Unknown"}],[12,{0:"Noninterlaced",1:"Adam7 Interlace",DEFAULT:"Unknown"}]]);class At extends Le{static canHandle(e,t){return e.getUint8(t+1)===226&&e.getUint32(t+4)===1229144927}static findPosition(e,t){let r=super.findPosition(e,t);return r.chunkNumber=e.getUint8(t+16),r.chunkCount=e.getUint8(t+17),r.multiSegment=r.chunkCount>1,r}static handleMultiSegments(e){return function(t){let r=function(i){let o=i[0].constructor,a=0;for(let u of i)a+=u.length;let l=new o(a),h=0;for(let u of i)l.set(u,h),h+=u.length;return l}(t.map(i=>i.chunk.toUint8()));return new Ze(r)}(e)}parse(){return this.raw=new Map,this.parseHeader(),this.parseTags(),this.translate(),this.output}parseHeader(){let{raw:e}=this;this.chunk.byteLength<84&&Se("ICC header is too short");for(let[t,r]of Object.entries(fi)){t=parseInt(t,10);let i=r(this.chunk,t);i!=="\0\0\0\0"&&e.set(t,i)}}parseTags(){let e,t,r,i,o,{raw:a}=this,l=this.chunk.getUint32(128),h=132,u=this.chunk.byteLength;for(;l--;){if(e=this.chunk.getString(h,4),t=this.chunk.getUint32(h+4),r=this.chunk.getUint32(h+8),i=this.chunk.getString(t,4),t+r>u)return void console.warn("reached the end of the first ICC chunk. Enable options.tiff.multiSegment to read all ICC segments.");o=this.parseTag(i,t,r),o!==void 0&&o!=="\0\0\0\0"&&a.set(e,o),h+=12}}parseTag(e,t,r){switch(e){case"desc":return this.parseDesc(t);case"mluc":return this.parseMluc(t);case"text":return this.parseText(t,r);case"sig ":return this.parseSig(t)}if(!(t+r>this.chunk.byteLength))return this.chunk.getUint8Array(t,r)}parseDesc(e){let t=this.chunk.getUint32(e+8)-1;return et(this.chunk.getString(e+12,t))}parseText(e,t){return et(this.chunk.getString(e+8,t-8))}parseSig(e){return et(this.chunk.getString(e+8,4))}parseMluc(e){let{chunk:t}=this,r=t.getUint32(e+8),i=t.getUint32(e+12),o=e+16,a=[];for(let l=0;l<r;l++){let h=t.getString(o+0,2),u=t.getString(o+2,2),d=t.getUint32(o+4),g=t.getUint32(o+8)+e,k=et(t.getUnicodeString(g,d));a.push({lang:h,country:u,text:k}),o+=i}return r===1?a[0].text:a}translateValue(e,t){return typeof e=="string"?t[e]||t[e.toLowerCase()]||e:t[e]||e}}Z(At,"type","icc"),Z(At,"multiSegment",!0),Z(At,"headerLength",18);const fi={4:ze,8:function(n,e){return[n.getUint8(e),n.getUint8(e+1)>>4,n.getUint8(e+1)%16].map(t=>t.toString(10)).join(".")},12:ze,16:ze,20:ze,24:function(n,e){const t=n.getUint16(e),r=n.getUint16(e+2)-1,i=n.getUint16(e+4),o=n.getUint16(e+6),a=n.getUint16(e+8),l=n.getUint16(e+10);return new Date(Date.UTC(t,r,i,o,a,l))},36:ze,40:ze,48:ze,52:ze,64:(n,e)=>n.getUint32(e),80:ze};function ze(n,e){return et(n.getString(e,4))}ke.set("icc",At),we(Pe,"icc",[[4,"ProfileCMMType"],[8,"ProfileVersion"],[12,"ProfileClass"],[16,"ColorSpaceData"],[20,"ProfileConnectionSpace"],[24,"ProfileDateTime"],[36,"ProfileFileSignature"],[40,"PrimaryPlatform"],[44,"CMMFlags"],[48,"DeviceManufacturer"],[52,"DeviceModel"],[56,"DeviceAttributes"],[64,"RenderingIntent"],[68,"ConnectionSpaceIlluminant"],[80,"ProfileCreator"],[84,"ProfileID"],["Header","ProfileHeader"],["MS00","WCSProfiles"],["bTRC","BlueTRC"],["bXYZ","BlueMatrixColumn"],["bfd","UCRBG"],["bkpt","MediaBlackPoint"],["calt","CalibrationDateTime"],["chad","ChromaticAdaptation"],["chrm","Chromaticity"],["ciis","ColorimetricIntentImageState"],["clot","ColorantTableOut"],["clro","ColorantOrder"],["clrt","ColorantTable"],["cprt","ProfileCopyright"],["crdi","CRDInfo"],["desc","ProfileDescription"],["devs","DeviceSettings"],["dmdd","DeviceModelDesc"],["dmnd","DeviceMfgDesc"],["dscm","ProfileDescriptionML"],["fpce","FocalPlaneColorimetryEstimates"],["gTRC","GreenTRC"],["gXYZ","GreenMatrixColumn"],["gamt","Gamut"],["kTRC","GrayTRC"],["lumi","Luminance"],["meas","Measurement"],["meta","Metadata"],["mmod","MakeAndModel"],["ncl2","NamedColor2"],["ncol","NamedColor"],["ndin","NativeDisplayInfo"],["pre0","Preview0"],["pre1","Preview1"],["pre2","Preview2"],["ps2i","PS2RenderingIntent"],["ps2s","PostScript2CSA"],["psd0","PostScript2CRD0"],["psd1","PostScript2CRD1"],["psd2","PostScript2CRD2"],["psd3","PostScript2CRD3"],["pseq","ProfileSequenceDesc"],["psid","ProfileSequenceIdentifier"],["psvm","PS2CRDVMSize"],["rTRC","RedTRC"],["rXYZ","RedMatrixColumn"],["resp","OutputResponse"],["rhoc","ReflectionHardcopyOrigColorimetry"],["rig0","PerceptualRenderingIntentGamut"],["rig2","SaturationRenderingIntentGamut"],["rpoc","ReflectionPrintOutputColorimetry"],["sape","SceneAppearanceEstimates"],["scoe","SceneColorimetryEstimates"],["scrd","ScreeningDesc"],["scrn","Screening"],["targ","CharTarget"],["tech","Technology"],["vcgt","VideoCardGamma"],["view","ViewingConditions"],["vued","ViewingCondDesc"],["wtpt","MediaWhitePoint"]]);const Et={"4d2p":"Erdt Systems",AAMA:"Aamazing Technologies",ACER:"Acer",ACLT:"Acolyte Color Research",ACTI:"Actix Sytems",ADAR:"Adara Technology",ADBE:"Adobe",ADI:"ADI Systems",AGFA:"Agfa Graphics",ALMD:"Alps Electric",ALPS:"Alps Electric",ALWN:"Alwan Color Expertise",AMTI:"Amiable Technologies",AOC:"AOC International",APAG:"Apago",APPL:"Apple Computer",AST:"AST","AT&T":"AT&T",BAEL:"BARBIERI electronic",BRCO:"Barco NV",BRKP:"Breakpoint",BROT:"Brother",BULL:"Bull",BUS:"Bus Computer Systems","C-IT":"C-Itoh",CAMR:"Intel",CANO:"Canon",CARR:"Carroll Touch",CASI:"Casio",CBUS:"Colorbus PL",CEL:"Crossfield",CELx:"Crossfield",CGS:"CGS Publishing Technologies International",CHM:"Rochester Robotics",CIGL:"Colour Imaging Group, London",CITI:"Citizen",CL00:"Candela",CLIQ:"Color IQ",CMCO:"Chromaco",CMiX:"CHROMiX",COLO:"Colorgraphic Communications",COMP:"Compaq",COMp:"Compeq/Focus Technology",CONR:"Conrac Display Products",CORD:"Cordata Technologies",CPQ:"Compaq",CPRO:"ColorPro",CRN:"Cornerstone",CTX:"CTX International",CVIS:"ColorVision",CWC:"Fujitsu Laboratories",DARI:"Darius Technology",DATA:"Dataproducts",DCP:"Dry Creek Photo",DCRC:"Digital Contents Resource Center, Chung-Ang University",DELL:"Dell Computer",DIC:"Dainippon Ink and Chemicals",DICO:"Diconix",DIGI:"Digital","DL&C":"Digital Light & Color",DPLG:"Doppelganger",DS:"Dainippon Screen",DSOL:"DOOSOL",DUPN:"DuPont",EPSO:"Epson",ESKO:"Esko-Graphics",ETRI:"Electronics and Telecommunications Research Institute",EVER:"Everex Systems",EXAC:"ExactCODE",Eizo:"Eizo",FALC:"Falco Data Products",FF:"Fuji Photo Film",FFEI:"FujiFilm Electronic Imaging",FNRD:"Fnord Software",FORA:"Fora",FORE:"Forefront Technology",FP:"Fujitsu",FPA:"WayTech Development",FUJI:"Fujitsu",FX:"Fuji Xerox",GCC:"GCC Technologies",GGSL:"Global Graphics Software",GMB:"Gretagmacbeth",GMG:"GMG",GOLD:"GoldStar Technology",GOOG:"Google",GPRT:"Giantprint",GTMB:"Gretagmacbeth",GVC:"WayTech Development",GW2K:"Sony",HCI:"HCI",HDM:"Heidelberger Druckmaschinen",HERM:"Hermes",HITA:"Hitachi America",HP:"Hewlett-Packard",HTC:"Hitachi",HiTi:"HiTi Digital",IBM:"IBM",IDNT:"Scitex",IEC:"Hewlett-Packard",IIYA:"Iiyama North America",IKEG:"Ikegami Electronics",IMAG:"Image Systems",IMI:"Ingram Micro",INTC:"Intel",INTL:"N/A (INTL)",INTR:"Intra Electronics",IOCO:"Iocomm International Technology",IPS:"InfoPrint Solutions Company",IRIS:"Scitex",ISL:"Ichikawa Soft Laboratory",ITNL:"N/A (ITNL)",IVM:"IVM",IWAT:"Iwatsu Electric",Idnt:"Scitex",Inca:"Inca Digital Printers",Iris:"Scitex",JPEG:"Joint Photographic Experts Group",JSFT:"Jetsoft Development",JVC:"JVC Information Products",KART:"Scitex",KFC:"KFC Computek Components",KLH:"KLH Computers",KMHD:"Konica Minolta",KNCA:"Konica",KODA:"Kodak",KYOC:"Kyocera",Kart:"Scitex",LCAG:"Leica",LCCD:"Leeds Colour",LDAK:"Left Dakota",LEAD:"Leading Technology",LEXM:"Lexmark International",LINK:"Link Computer",LINO:"Linotronic",LITE:"Lite-On",Leaf:"Leaf",Lino:"Linotronic",MAGC:"Mag Computronic",MAGI:"MAG Innovision",MANN:"Mannesmann",MICN:"Micron Technology",MICR:"Microtek",MICV:"Microvitec",MINO:"Minolta",MITS:"Mitsubishi Electronics America",MITs:"Mitsuba",MNLT:"Minolta",MODG:"Modgraph",MONI:"Monitronix",MONS:"Monaco Systems",MORS:"Morse Technology",MOTI:"Motive Systems",MSFT:"Microsoft",MUTO:"MUTOH INDUSTRIES",Mits:"Mitsubishi Electric",NANA:"NANAO",NEC:"NEC",NEXP:"NexPress Solutions",NISS:"Nissei Sangyo America",NKON:"Nikon",NONE:"none",OCE:"Oce Technologies",OCEC:"OceColor",OKI:"Oki",OKID:"Okidata",OKIP:"Okidata",OLIV:"Olivetti",OLYM:"Olympus",ONYX:"Onyx Graphics",OPTI:"Optiquest",PACK:"Packard Bell",PANA:"Matsushita Electric Industrial",PANT:"Pantone",PBN:"Packard Bell",PFU:"PFU",PHIL:"Philips Consumer Electronics",PNTX:"HOYA",POne:"Phase One A/S",PREM:"Premier Computer Innovations",PRIN:"Princeton Graphic Systems",PRIP:"Princeton Publishing Labs",QLUX:"Hong Kong",QMS:"QMS",QPCD:"QPcard AB",QUAD:"QuadLaser",QUME:"Qume",RADI:"Radius",RDDx:"Integrated Color Solutions",RDG:"Roland DG",REDM:"REDMS Group",RELI:"Relisys",RGMS:"Rolf Gierling Multitools",RICO:"Ricoh",RNLD:"Edmund Ronald",ROYA:"Royal",RPC:"Ricoh Printing Systems",RTL:"Royal Information Electronics",SAMP:"Sampo",SAMS:"Samsung",SANT:"Jaime Santana Pomares",SCIT:"Scitex",SCRN:"Dainippon Screen",SDP:"Scitex",SEC:"Samsung",SEIK:"Seiko Instruments",SEIk:"Seikosha",SGUY:"ScanGuy.com",SHAR:"Sharp Laboratories",SICC:"International Color Consortium",SONY:"Sony",SPCL:"SpectraCal",STAR:"Star",STC:"Sampo Technology",Scit:"Scitex",Sdp:"Scitex",Sony:"Sony",TALO:"Talon Technology",TAND:"Tandy",TATU:"Tatung",TAXA:"TAXAN America",TDS:"Tokyo Denshi Sekei",TECO:"TECO Information Systems",TEGR:"Tegra",TEKT:"Tektronix",TI:"Texas Instruments",TMKR:"TypeMaker",TOSB:"Toshiba",TOSH:"Toshiba",TOTK:"TOTOKU ELECTRIC",TRIU:"Triumph",TSBT:"Toshiba",TTX:"TTX Computer Products",TVM:"TVM Professional Monitor",TW:"TW Casper",ULSX:"Ulead Systems",UNIS:"Unisys",UTZF:"Utz Fehlau & Sohn",VARI:"Varityper",VIEW:"Viewsonic",VISL:"Visual communication",VIVO:"Vivo Mobile Communication",WANG:"Wang",WLBR:"Wilbur Imaging",WTG2:"Ware To Go",WYSE:"WYSE Technology",XERX:"Xerox",XRIT:"X-Rite",ZRAN:"Zoran",Zebr:"Zebra Technologies",appl:"Apple Computer",bICC:"basICColor",berg:"bergdesign",ceyd:"Integrated Color Solutions",clsp:"MacDermid ColorSpan",ds:"Dainippon Screen",dupn:"DuPont",ffei:"FujiFilm Electronic Imaging",flux:"FluxData",iris:"Scitex",kart:"Scitex",lcms:"Little CMS",lino:"Linotronic",none:"none",ob4d:"Erdt Systems",obic:"Medigraph",quby:"Qubyx Sarl",scit:"Scitex",scrn:"Dainippon Screen",sdp:"Scitex",siwi:"SIWI GRAFIKA",yxym:"YxyMaster"},mr={scnr:"Scanner",mntr:"Monitor",prtr:"Printer",link:"Device Link",abst:"Abstract",spac:"Color Space Conversion Profile",nmcl:"Named Color",cenc:"ColorEncodingSpace profile",mid:"MultiplexIdentification profile",mlnk:"MultiplexLink profile",mvis:"MultiplexVisualization profile",nkpf:"Nikon Input Device Profile (NON-STANDARD!)"};we(Fe,"icc",[[4,Et],[12,mr],[40,Object.assign({},Et,mr)],[48,Et],[80,Et],[64,{0:"Perceptual",1:"Relative Colorimetric",2:"Saturation",3:"Absolute Colorimetric"}],["tech",{amd:"Active Matrix Display",crt:"Cathode Ray Tube Display",kpcd:"Photo CD",pmd:"Passive Matrix Display",dcam:"Digital Camera",dcpj:"Digital Cinema Projector",dmpc:"Digital Motion Picture Camera",dsub:"Dye Sublimation Printer",epho:"Electrophotographic Printer",esta:"Electrostatic Printer",flex:"Flexography",fprn:"Film Writer",fscn:"Film Scanner",grav:"Gravure",ijet:"Ink Jet Printer",imgs:"Photo Image Setter",mpfr:"Motion Picture Film Recorder",mpfs:"Motion Picture Film Scanner",offs:"Offset Lithography",pjtv:"Projection Television",rpho:"Photographic Paper Printer",rscn:"Reflective Scanner",silk:"Silkscreen",twax:"Thermal Wax Printer",vidc:"Video Camera",vidm:"Video Monitor"}]]);class Nt extends Le{static canHandle(e,t,r){return e.getUint8(t+1)===237&&e.getString(t+4,9)==="Photoshop"&&this.containsIptc8bim(e,t,r)!==void 0}static headerLength(e,t,r){let i,o=this.containsIptc8bim(e,t,r);if(o!==void 0)return i=e.getUint8(t+o+7),i%2!=0&&(i+=1),i===0&&(i=4),o+8+i}static containsIptc8bim(e,t,r){for(let i=0;i<r;i++)if(this.isIptcSegmentHead(e,t+i))return i}static isIptcSegmentHead(e,t){return e.getUint8(t)===56&&e.getUint32(t)===943868237&&e.getUint16(t+4)===1028}parse(){let{raw:e}=this,t=this.chunk.byteLength-1,r=!1;for(let i=0;i<t;i++)if(this.chunk.getUint8(i)===28&&this.chunk.getUint8(i+1)===2){r=!0;let o=this.chunk.getUint16(i+3),a=this.chunk.getUint8(i+2),l=this.chunk.getLatin1String(i+5,o);e.set(a,this.pluralizeValue(e.get(a),l)),i+=4+o}else if(r)break;return this.translate(),this.output}pluralizeValue(e,t){return e!==void 0?e instanceof Array?(e.push(t),e):[e,t]:t}}Z(Nt,"type","iptc"),Z(Nt,"translateValues",!1),Z(Nt,"reviveValues",!1),ke.set("iptc",Nt),we(Pe,"iptc",[[0,"ApplicationRecordVersion"],[3,"ObjectTypeReference"],[4,"ObjectAttributeReference"],[5,"ObjectName"],[7,"EditStatus"],[8,"EditorialUpdate"],[10,"Urgency"],[12,"SubjectReference"],[15,"Category"],[20,"SupplementalCategories"],[22,"FixtureIdentifier"],[25,"Keywords"],[26,"ContentLocationCode"],[27,"ContentLocationName"],[30,"ReleaseDate"],[35,"ReleaseTime"],[37,"ExpirationDate"],[38,"ExpirationTime"],[40,"SpecialInstructions"],[42,"ActionAdvised"],[45,"ReferenceService"],[47,"ReferenceDate"],[50,"ReferenceNumber"],[55,"DateCreated"],[60,"TimeCreated"],[62,"DigitalCreationDate"],[63,"DigitalCreationTime"],[65,"OriginatingProgram"],[70,"ProgramVersion"],[75,"ObjectCycle"],[80,"Byline"],[85,"BylineTitle"],[90,"City"],[92,"Sublocation"],[95,"State"],[100,"CountryCode"],[101,"Country"],[103,"OriginalTransmissionReference"],[105,"Headline"],[110,"Credit"],[115,"Source"],[116,"CopyrightNotice"],[118,"Contact"],[120,"Caption"],[121,"LocalCaption"],[122,"Writer"],[125,"RasterizedCaption"],[130,"ImageType"],[131,"ImageOrientation"],[135,"LanguageIdentifier"],[150,"AudioType"],[151,"AudioSamplingRate"],[152,"AudioSamplingResolution"],[153,"AudioDuration"],[154,"AudioOutcue"],[184,"JobID"],[185,"MasterDocumentID"],[186,"ShortDocumentID"],[187,"UniqueDocumentID"],[188,"OwnerID"],[200,"ObjectPreviewFileFormat"],[201,"ObjectPreviewFileVersion"],[202,"ObjectPreviewData"],[221,"Prefs"],[225,"ClassifyState"],[228,"SimilarityIndex"],[230,"DocumentNotes"],[231,"DocumentHistory"],[232,"ExifCameraInfo"],[255,"CatalogSets"]]),we(Fe,"iptc",[[10,{0:"0 (reserved)",1:"1 (most urgent)",2:"2",3:"3",4:"4",5:"5 (normal urgency)",6:"6",7:"7",8:"8 (least urgent)",9:"9 (user-defined priority)"}],[75,{a:"Morning",b:"Both Morning and Evening",p:"Evening"}],[131,{L:"Landscape",P:"Portrait",S:"Square"}]]);const pi=async n=>{try{return await ss(n)}catch(e){console.warn("检查HEIC格式时出错:",e);const t=n.name.toLowerCase();return t.endsWith(".heic")||t.endsWith(".heif")}},gi=async(n,e=.85,t)=>{typeof t=="function"&&t(10);try{console.log("开始转换HEIC格式:",n.name);const r=await Pr({blob:n,type:"image/jpeg",quality:e});return typeof t=="function"&&t(100),console.log("HEIC转换成功:",n.name),r instanceof Blob?r:new Blob([r],{type:"image/jpeg"})}catch(r){console.error("HEIC转JPEG失败:",r),typeof t=="function"&&t(50);try{return console.log("使用备用方法转换HEIC:",n.name),await new Promise((i,o)=>{const a=new FileReader;a.onload=l=>{const h=new Image;h.onload=()=>{const u=document.createElement("canvas");u.width=h.width,u.height=h.height;const d=u.getContext("2d");if(!d){o(new Error("无法创建Canvas上下文"));return}d.drawImage(h,0,0),typeof t=="function"&&t(90),u.toBlob(g=>{g?(typeof t=="function"&&t(100),i(g)):o(new Error("Canvas转换失败"))},"image/jpeg",e)},h.onerror=()=>{o(new Error("图像加载失败"))},h.src=URL.createObjectURL(n)},a.onerror=()=>{o(new Error("文件读取失败"))},a.readAsArrayBuffer(n)})}catch(i){throw console.error("备用转换方法也失败:",i),new Error("无法转换HEIC格式图像，请尝试转换为JPEG后再上传")}}},mi=async(n,e)=>{typeof e=="function"&&e(10);try{console.log("开始转换HEIC格式为PNG:",n.name);const t=await Pr({blob:n,type:"image/png",quality:1});return typeof e=="function"&&e(100),console.log("HEIC转PNG成功:",n.name),t instanceof Blob?t:new Blob([t],{type:"image/png"})}catch(t){console.error("HEIC转PNG失败:",t),typeof e=="function"&&e(50);try{return console.log("使用备用方法转换HEIC为PNG:",n.name),await new Promise((r,i)=>{const o=new FileReader;o.onload=a=>{const l=new Image;l.onload=()=>{const h=document.createElement("canvas");h.width=l.width,h.height=l.height;const u=h.getContext("2d");if(!u){i(new Error("无法创建Canvas上下文"));return}u.drawImage(l,0,0),typeof e=="function"&&e(90),h.toBlob(d=>{d?(typeof e=="function"&&e(100),r(d)):i(new Error("Canvas转换失败"))},"image/png")},l.onerror=()=>{i(new Error("图像加载失败"))},l.src=URL.createObjectURL(n)},o.onerror=()=>{i(new Error("文件读取失败"))},o.readAsArrayBuffer(n)})}catch(r){throw console.error("备用转换方法也失败:",r),new Error("无法转换HEIC格式图像，请尝试转换为JPEG后再上传")}}},xi=async(n,e="image/jpeg",t=.85,r)=>{try{return e==="image/png"?mi(n,r):gi(n,t,r)}catch(i){throw console.error("HEIC转换失败:",i),typeof r=="function"&&r(100),i}},hn=async n=>{var e;try{const t=URL.createObjectURL(n),r=await new Promise(o=>{const a=new Image;a.onload=()=>{o({width:a.naturalWidth,height:a.naturalHeight})},a.onerror=()=>{o({width:0,height:0})},a.src=t,setTimeout(()=>o({width:0,height:0}),3e3)});let i={};try{i=await di.parse(n,{pick:["Make","Model","LensModel","FocalLength","FNumber","ExposureTime","ISO","DateTimeOriginal"]})||{}}catch(o){console.warn("EXIF提取警告:",o)}return{id:`${Date.now()}-${Math.random().toString(36).substring(2)}-${n.name}`,file:n,url:t,name:n.name,exif:{FileName:n.name,Resolution:`${r.width} × ${r.height}`,Make:(i==null?void 0:i.Make)||"Unknown",Model:(i==null?void 0:i.Model)||"Unknown",LensModel:(i==null?void 0:i.LensModel)||"Unknown",FocalLength:(i==null?void 0:i.FocalLength)||0,FNumber:(i==null?void 0:i.FNumber)||0,ExposureTime:((e=i==null?void 0:i.ExposureTime)==null?void 0:e.toString())||"0",ISO:(i==null?void 0:i.ISO)||0,DateTimeOriginal:(i==null?void 0:i.DateTimeOriginal)||"Unknown"}}}catch(t){throw console.error("图像处理失败:",t),t}},xr=({isOpen:n,files:e,onClose:t,onConfirm:r,onCancel:i,isConverting:o,outputFormat:a,setOutputFormat:l,quality:h,setQuality:u})=>{const{themeMode:d}=De(),g=d==="dark";if(!n)return null;const k=y=>"HEIF/HEIC",D=y=>{switch(y){case"pending":return{label:"等待转换",color:g?"text-gray-400":"text-gray-500"};case"converting":return{label:"转换中",color:"text-sky-500"};case"success":return{label:"转换成功",color:"text-green-500"};case"error":return{label:"转换失败",color:"text-red-500"};default:return{label:"未知状态",color:"text-gray-500"}}},I=()=>{if(!o)return"";const y=e.length,M=e.filter(N=>N.status==="success"||N.status==="error").length,P=e.filter(N=>N.status==="error").length;return M<y?`正在转换 (${M}/${y})`:P>0?`转换完成，${P} 个文件失败`:"转换成功"};return s.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/50 backdrop-blur-sm",children:s.jsx("div",{className:"w-full max-w-lg rounded-xl shadow-2xl",style:{background:"var(--control-bg)",color:"var(--control-text)",border:"1px solid var(--control-border)"},children:s.jsxs("div",{className:"p-6",children:[s.jsx("h2",{className:"text-xl font-semibold mb-4",children:"HEIC/HEIF格式图片需要进行转换"}),s.jsx("p",{className:"text-sm mb-4",children:"HEIC/HEIF格式需要转换为JPG或PNG后才能正常显示，而且前端无法识别EXIF信息。你可以选择转换的格式和质量："}),s.jsxs("div",{className:"flex items-center gap-6 mb-4",children:[s.jsxs("div",{children:[s.jsx("label",{className:"mr-2",children:"输出格式："}),s.jsxs("select",{value:a,onChange:y=>l(y.target.value),className:"border rounded px-2 py-1",style:{background:"var(--control-bg)",color:"var(--control-text)",borderColor:"var(--control-border)"},children:[s.jsx("option",{value:"image/jpeg",children:"JPEG"}),s.jsx("option",{value:"image/png",children:"PNG"})]})]}),s.jsxs("div",{children:[s.jsx("label",{className:"mr-2",children:"JPEG质量："}),s.jsx("input",{type:"range",min:.1,max:1,step:.01,value:h,onChange:y=>u(Number(y.target.value)),disabled:a!=="image/jpeg",className:"align-middle",style:{width:120}}),s.jsx("span",{className:"ml-2 text-xs",children:h.toFixed(2)})]})]}),s.jsx("div",{className:"mt-4 mb-6 rounded-lg overflow-hidden border",style:{borderColor:"var(--control-border)",background:"var(--control-bg)"},children:s.jsx("div",{className:"max-h-64 overflow-y-auto",children:s.jsxs("table",{className:"w-full",children:[s.jsx("thead",{children:s.jsxs("tr",{style:{background:g?"rgba(0,0,0,0.2)":"rgba(0,0,0,0.05)"},children:[s.jsx("th",{className:"px-4 py-2 text-left text-xs",children:"文件名"}),s.jsx("th",{className:"px-4 py-2 text-left text-xs",children:"格式"}),s.jsx("th",{className:"px-4 py-2 text-right text-xs",children:"状态"})]})}),s.jsx("tbody",{className:"divide-y",style:{borderColor:"var(--control-border)"},children:e.map((y,M)=>{const P=D(y.status);return s.jsxs("tr",{className:"hover:bg-black/5 dark:hover:bg-white/5",children:[s.jsx("td",{className:"px-4 py-3 text-sm truncate max-w-[180px]",children:y.file.name}),s.jsx("td",{className:"px-4 py-3 text-sm",children:k(y.type)}),s.jsxs("td",{className:"px-4 py-3 text-sm text-right",children:[s.jsx("span",{className:P.color,children:P.label}),y.status==="converting"&&y.progress!==void 0&&s.jsx("div",{className:"w-full mt-1 bg-gray-200 dark:bg-gray-700 rounded-full h-1.5",children:s.jsx("div",{className:"bg-sky-500 h-1.5 rounded-full",style:{width:`${y.progress}%`}})}),y.status==="error"&&y.error&&s.jsx("div",{className:"text-xs text-red-500 mt-1",children:y.error})]})]},M)})})]})})}),o&&s.jsxs("div",{className:"mb-6",children:[s.jsx("p",{className:"text-sm font-medium mb-2",children:I()}),s.jsx("div",{className:"w-full bg-gray-200 dark:bg-gray-700 rounded-full h-2",children:s.jsx("div",{className:"bg-sky-500 h-2 rounded-full transition-all duration-300",style:{width:`${e.filter(y=>y.status==="success"||y.status==="error").length/e.length*100}%`}})})]}),s.jsxs("div",{className:"flex justify-end space-x-3",children:[!o&&s.jsxs(s.Fragment,{children:[s.jsx("button",{onClick:i,className:"px-4 py-2 rounded text-sm font-medium",style:{background:"var(--control-bg)",color:"var(--control-text)",border:"1px solid var(--control-border)"},children:"取消"}),s.jsx("button",{onClick:r,className:"px-4 py-2 bg-sky-500 text-white rounded text-sm font-medium hover:bg-sky-600",children:"开始转换"})]}),o&&s.jsx("button",{onClick:t,disabled:e.some(y=>y.status==="converting"),className:`px-4 py-2 rounded text-sm font-medium
                  ${e.some(y=>y.status==="converting")?"bg-gray-400 text-gray-200 cursor-not-allowed":"bg-sky-500 text-white hover:bg-sky-600"}`,children:e.every(y=>y.status==="success"||y.status==="error")?"完成":"关闭"})]})]})})})},yi=async(n,e="image/jpeg",t=.85,r)=>{try{r&&r(10);const i=await xi(n,e,t,r);return r&&r(100),i}catch(i){return console.error("HEIF转换失败:",i),null}},bi=async n=>{try{if(await pi(n))return{needsConversion:!0,type:"heif"}}catch(e){console.warn("检查HEIF格式时出错:",e);const t=n.name.toLowerCase();if(t.endsWith(".heic")||t.endsWith(".heif"))return{needsConversion:!0,type:"heif"}}return{needsConversion:!1}},fn=n=>{const e=typeof n=="string"?parseFloat(n):n;if(e===0||isNaN(e))return"0s";if(e===1)return"1s";if(e>=1)return`${e}s`;const r=[2,4,8,15,30,60,125,250,500,1e3,2e3,4e3,8e3].find(I=>Math.abs(1/I-e)<1e-4);if(r)return`1/${r}s`;const i=e.toFixed(6),[o,a]=i.split("."),l=a.replace(/0+$/,""),h=Math.pow(10,l.length),u=parseInt(l),d=(I,y)=>y?d(y,I%y):I,g=d(u,h),k=u/g,D=h/g;return`${k}/${D}s`},vi=/\.(jpg|jpeg|png|gif|webp|bmp)$/i,wi=/\.(heic|heif)$/i,ki=()=>{const{themeMode:n,demoMode:e}=De(),{addImages:t,clearImages:r,removeImage:i,images:o,addImage:a}=kt(),[l,h]=p.useState(!1),u=n==="dark",[d,g]=p.useState(!1),[k,D]=p.useState([]),[I,y]=p.useState([]),[M,P]=p.useState(!1),[N,V]=p.useState(!0),[ee,v]=p.useState("image/jpeg"),[ae,F]=p.useState(.85);p.useEffect(()=>{},[]);const E=p.useCallback(async(m,Q=!0)=>{if(m.length){Q&&o.length>0&&r(),h(!0);try{const he=await Promise.all(m.map(hn));t(he)}catch(he){console.error("图片处理失败:",he),alert("部分图片处理失败，请重试")}finally{h(!1)}}},[t,r,o.length]),A=p.useCallback(async(m,Q=!0)=>{if(!m.length)return;const he=[],O=[];for(const z of Array.from(m)){const pe=z.name.toLowerCase();if(vi.test(pe))O.push(z);else if(wi.test(pe))try{const{needsConversion:de,type:ue}=await bi(z);de&&ue?he.push({file:z,type:ue,status:"pending"}):O.push(z)}catch(de){console.warn(`检查文件格式失败: ${z.name}`,de)}}he.length>0?(D(he),y(O),V(Q),v("image/jpeg"),F(.85),g(!0)):O.length>0&&E(O,Q)},[E]),w=p.useCallback(async()=>{if(k.length===0)return;P(!0);const m=[],Q=(O,z)=>{D(pe=>pe.map((de,ue)=>ue===O?{...de,...z}:de))};for(let O=0;O<k.length;O++){const z=k[O];try{if(Q(O,{status:"converting",progress:0}),z.type==="heif"){const pe=await yi(z.file,ee,ae,de=>{Q(O,{progress:de})});if(pe){const de=ee==="image/png"?".png":".jpg",ue=new File([pe],z.file.name.replace(/\.(heic|heif)$/i,de),{type:ee});m.push(ue),Q(O,{status:"success"})}else Q(O,{status:"error",error:"转换失败"})}}catch(pe){console.error("转换文件失败:",pe),Q(O,{status:"error",error:pe instanceof Error?pe.message:"未知错误"})}}const he=[...m,...I];he.length>0&&await E(he,N)},[k,I,N,E,ee,ae]),_=p.useCallback(()=>{I.length>0&&E(I,N),g(!1),D([]),y([])},[I,N,E]),S=p.useCallback(()=>{g(!1),D([]),y([]),P(!1)},[]),R=p.useCallback(m=>{m.preventDefault();const Q=m.dataTransfer.files;Q&&Q.length>0&&A(Q)},[A]),Y=p.useCallback(m=>{m.preventDefault()},[]),xe=p.useCallback(()=>{const m=document.createElement("input");m.type="file",m.accept="image/*,.heic,.heif",m.multiple=!0,m.onchange=Q=>{Q.target instanceof HTMLInputElement&&Q.target.files&&A(Q.target.files)},m.click()},[A]),G=()=>s.jsxs("div",{className:"w-full",children:[!e&&s.jsxs("div",{className:"flex items-center gap-4 mb-6",children:[s.jsx("button",{onClick:()=>{const m=document.createElement("input");m.type="file",m.accept="image/*,.heic,.heif",m.multiple=!0,m.onchange=Q=>{Q.target instanceof HTMLInputElement&&Q.target.files&&A(Q.target.files,!0)},m.click()},className:"px-7 py-3 rounded-full backdrop-blur-md transition-all duration-200 bg-[#2458d0] hover:bg-[#1c46af] text-white font-medium text-sm scale-105",children:"重新上传"}),s.jsx("button",{onClick:()=>{const m=document.createElement("input");m.type="file",m.accept="image/*,.heic,.heif",m.multiple=!0,m.onchange=Q=>{Q.target instanceof HTMLInputElement&&Q.target.files&&A(Q.target.files,!1)},m.click()},className:`p-2 rounded-lg font-medium transition-all duration-200
              ${u?"bg-sky-500/20 text-gray-100 hover:bg-sky-500/30":"bg-sky-500/10 text-gray-700 hover:bg-sky-500/20"}`,title:"添加图片",children:s.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 4v16m8-8H4"})})}),s.jsx("button",{onClick:r,className:`p-2 rounded-lg font-medium transition-all duration-200
              ${u?"bg-sky-500/20 text-gray-100 hover:bg-sky-500/30":"bg-sky-500/10 text-gray-700 hover:bg-sky-500/20"}`,title:"清空图片",children:s.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})})})]}),s.jsx("div",{className:`grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4 ${e?"p-0":""}`,children:o.map(m=>s.jsxs("div",{className:"relative group aspect-[3/2] rounded-lg overflow-hidden",style:{backgroundColor:u?"#1a1a1a":"#f3f4f6"},children:[s.jsx("img",{src:m.url,alt:m.name,className:"w-full h-full object-contain"}),!e&&s.jsxs(s.Fragment,{children:[s.jsx("div",{className:"absolute inset-0 bg-gradient-to-t from-black/30 to-transparent opacity-0 group-hover:opacity-100 transition-opacity duration-200"}),s.jsx("button",{onClick:()=>i(m.id),className:`absolute top-2 right-2 p-1.5 rounded-full opacity-0 group-hover:opacity-100 transition-opacity duration-200
                    ${u?"bg-gray-900/80 text-gray-100 hover:bg-gray-900":"bg-white/80 text-gray-700 hover:bg-white"}`,children:s.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})}),m.exif&&s.jsx("div",{className:"absolute bottom-0 left-0 right-0 p-3 text-sm text-white bg-gradient-to-t from-black/70 to-transparent",children:s.jsxs("div",{className:"space-y-1",children:[m.exif.Make!=="Unknown"&&m.exif.Model!=="Unknown"&&s.jsxs("p",{children:[m.exif.Make," ",m.exif.Model]}),m.exif.LensModel!=="Unknown"&&s.jsx("p",{children:m.exif.LensModel}),m.exif.FocalLength>0&&s.jsxs("p",{children:[m.exif.FocalLength,"mm"]}),m.exif.FNumber>0&&s.jsxs("p",{children:["f/",m.exif.FNumber]}),m.exif.ISO>0&&s.jsx("p",{children:m.exif.ISO}),m.exif.ExposureTime!=="0"&&s.jsx("p",{children:fn(m.exif.ExposureTime)})]})})]})]},m.id))})]});return o.length===0?s.jsxs(s.Fragment,{children:[s.jsx("div",{className:`flex flex-col items-center justify-center min-h-screen ${e?"demo-mode":"pt-12"}`,style:{background:"var(--bg-primary)",color:"var(--text-primary)"},children:s.jsx("div",{className:`w-full max-w-4xl ${e?"p-0 demo-content":"p-4 -mt-48"}`,children:e?s.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:o.map(m=>s.jsxs("div",{className:"relative aspect-[3/2] rounded-lg overflow-hidden",style:{background:"var(--bg-secondary)"},children:[s.jsx("img",{src:m.url,alt:m.name,className:"w-full h-full object-contain"}),s.jsx("div",{className:"absolute bottom-0 left-0 right-0 p-3 text-sm text-white bg-gradient-to-t from-black/70 to-transparent",children:s.jsxs("div",{className:"space-y-1",children:[m.exif.Make!=="Unknown"&&m.exif.Model!=="Unknown"&&s.jsxs("p",{children:[m.exif.Make," ",m.exif.Model]}),m.exif.LensModel!=="Unknown"&&s.jsx("p",{children:m.exif.LensModel}),m.exif.FocalLength>0&&s.jsxs("p",{children:[m.exif.FocalLength,"mm"]}),m.exif.FNumber>0&&s.jsxs("p",{children:["f/",m.exif.FNumber]}),m.exif.ISO>0&&s.jsx("p",{children:m.exif.ISO}),m.exif.ExposureTime!=="0"&&s.jsx("p",{children:fn(m.exif.ExposureTime)})]})})]},m.id))}):s.jsx(s.Fragment,{children:l?s.jsx("div",{className:"text-center",children:s.jsx("p",{style:{color:"var(--text-secondary)"},children:"处理中..."})}):o.length===0?s.jsxs("div",{className:"flex flex-col items-center justify-center",children:[s.jsxs("div",{className:`flex flex-col items-center justify-center w-[480px] h-[320px] border-4 border-dashed rounded-2xl p-8 cursor-pointer
                        transition-all duration-200`,style:{borderColor:n==="light"?"#cdcdcd":n==="dark"?"rgb(140 140 140 / 50%)":"var(--border-color)",background:n==="light"?"#f9fafb":n==="green"||n==="blue"?"var(--control-bg)":"var(--bg-secondary)",color:"var(--text-primary)"},onClick:xe,onDrop:R,onDragOver:Y,children:[s.jsx("svg",{className:"mx-auto h-12 w-12",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",style:{color:"var(--text-secondary)"},children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"M2.25 15.75l5.159-5.159a2.25 2.25 0 013.182 0l5.159 5.159m-1.5-1.5l1.409-1.409a2.25 2.25 0 013.182 0l2.909 2.909m-18 3.75h16.5a1.5 1.5 0 001.5-1.5V6a1.5 1.5 0 00-1.5-1.5H3.75A1.5 1.5 0 002.25 6v12a1.5 1.5 0 001.5 1.5zm10.5-11.25h.008v.008h-.008V8.25zm.375 0a.375.375 0 11-.75 0 .375.375 0 01.75 0z"})}),s.jsx("h3",{className:"mt-4 text-base font-medium",style:{color:"var(--text-primary)"},children:"点击或拖放图片到此处"}),s.jsx("p",{className:"mt-2 text-sm",style:{color:"var(--text-secondary)"},children:"支持导入图片进行对比"}),s.jsx("p",{className:"mt-1 text-xs",style:{color:"var(--text-secondary)",opacity:.7},children:"支持格式：JPG、PNG、GIF、WebP、HEIC等"})]}),s.jsxs("div",{className:"mt-4 flex items-center text-xs",style:{color:"var(--text-secondary)"},children:[s.jsx("svg",{className:"w-4 h-4 mr-1",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z"})}),s.jsx("span",{children:"隐私声明：所有图片仅在您的浏览器中本地处理，不会上传到任何服务器"})]})]}):G()})})}),d&&s.jsx(xr,{isOpen:d,files:k,onClose:S,onConfirm:w,onCancel:_,isConverting:M,outputFormat:ee,setOutputFormat:v,quality:ae,setQuality:F})]}):s.jsxs("div",{children:[G(),s.jsx(xr,{isOpen:d,onClose:S,onConfirm:w,onCancel:_,files:k,isConverting:M,outputFormat:ee,setOutputFormat:v,quality:ae,setQuality:F})]})},yr=({imageInfo:n})=>{const{exifSettings:e,themeMode:t}=De(),[r,i]=p.useState("");p.useEffect(()=>{const d=new Image;d.onload=()=>{i(`${d.naturalWidth} × ${d.naturalHeight}`)},d.src=n.url},[n.url]);const o=Object.entries({...n.exif,Resolution:r}).filter(([d,g])=>e[d]&&g!==void 0&&g!==null&&g!==""&&g!=="Unknown"&&g!=="NaN"&&g!=="Invalid Date"&&!(typeof g=="number"&&(isNaN(g)||g===0))&&!(typeof g=="string"&&(g==="0"||g.trim()==="0"||g.trim()==="0s")));if(o.length===0)return null;const a=(d,g)=>{switch(d){case"FocalLength":return`${g}mm`;case"FNumber":return`f/${g}`;case"ExposureTime":return fn(g);case"DateTimeOriginal":return new Date(g).toLocaleString();case"ISO":return g.toString();case"Resolution":case"FileName":case"Make":case"Model":case"LensModel":return String(g);default:return String(g)}},l=o.reduce((d,[g,k])=>g==="Make"||g==="Model"?(d.camera||(d.camera=[]),d.camera.push(String(k)),d):{...d,[g]:k},{}),h={},u={};return Object.entries(l).forEach(([d,g])=>{d==="camera"||d==="FocalLength"||d==="FNumber"||d==="ExposureTime"||d==="ISO"?h[d]=g:u[d]=g}),s.jsxs("div",{className:"absolute bottom-9 left-0 right-0 flex flex-col items-center space-y-2 pointer-events-none z-10",children:[Object.keys(h).length>0&&s.jsx("div",{className:`max-w-[95%] md:max-w-[85%] overflow-x-auto rounded-full px-5 py-2 backdrop-blur-md text-sm
          transition-all duration-300 scrollbar-hide pointer-events-auto select-none`,style:{background:"var(--control-bg)",color:"var(--control-text)",boxShadow:"0 4px 12px var(--shadow-color)",border:"1px solid var(--control-border)"},children:s.jsx("div",{className:"flex items-center space-x-2 flex-nowrap",children:Object.entries(h).map(([d,g])=>d==="camera"&&Array.isArray(g)?s.jsx("div",{className:"font-medium whitespace-nowrap",children:g.join(" ")},"camera"):s.jsxs("div",{className:"font-medium whitespace-nowrap flex items-center",children:[d!=="camera"&&s.jsx("span",{className:"mx-2 h-1 w-1 rounded-full bg-current opacity-40 flex-shrink-0"}),String(a(d,g))]},d))})}),Object.keys(u).length>0&&s.jsx("div",{className:`max-w-[80%] md:max-w-[60%] px-4 py-1.5 text-xs select-none
            transition-all duration-300 pointer-events-auto`,style:{color:"var(--control-text)",opacity:.8},children:s.jsx("div",{className:"flex items-center justify-center flex-wrap gap-x-3 gap-y-1",children:Object.entries(u).map(([d,g])=>s.jsx("div",{className:"flex items-center whitespace-nowrap",children:a(d,g)},d))})})]})},Si=({images:n=[]})=>{var Un,$n,zn,Wn,Hn,Vn,_n,Gn,Xn;const{themeMode:e,syncZoom:t,demoMode:r,showZoomControls:i,borderRadius:o,gridGap:a}=De(),{removeImage:l,addImages:h}=kt(),{isAnnotateMode:u,annotationTool:d,annotationColor:g,annotationStrokeWidth:k,annotationFontSize:D,annotations:I,addAnnotation:y,setAnnotations:M,undo:P,redo:N,selectedAnnotationId:V,setSelectedAnnotationId:ee,drawing:v,setDrawing:ae,editingTextId:F,setEditingTextId:E,deleteAnnotation:A}=Ie(),w=p.useRef([]),_=p.useRef([]),[S,R]=p.useState([]),[Y,xe]=p.useState(!1),[G,m]=p.useState(null),[Q,he]=p.useState({width:0,height:0}),[O,z]=p.useState(null),[pe,de]=p.useState(null),[ue,B]=p.useState(!1),[J,oe]=p.useState(null),[ne,f]=p.useState(""),[C,ye]=p.useState(null),le=p.useRef(null),ge=p.useRef(S);p.useEffect(()=>{ge.current=S},[S]);const re=p.useRef(t);p.useEffect(()=>{re.current=t},[t]),p.useEffect(()=>{var c;if(n.length===1){const j=(((c=n[0].exif)==null?void 0:c.Resolution)||"").match(/(\d+)\s*[×x]\s*(\d+)/);if(j){const T=parseInt(j[1],10),W=parseInt(j[2],10);he({width:T,height:W}),z([0,0,T,W])}}},[n]),p.useEffect(()=>{R(Array(n.length).fill({scale:1,x:0,y:0}))},[n.length]);const Re=p.useRef({isDragging:!1,currentIndex:-1,startX:0,startY:0});p.useEffect(()=>{w.current=w.current.slice(0,n.length),_.current=_.current.slice(0,n.length)},[n.length]);const En=(c,x)=>{R(j=>{if(re.current){const T=x(j[c]||{scale:1,x:0,y:0});return j.map(()=>({...T}))}else{const T=[...j];return T[c]=x(j[c]||{scale:1,x:0,y:0}),T}})};p.useEffect(()=>{const c=w.current,x=[],j=[];c.forEach((K,X)=>{if(!K)return;const se=L=>{L.preventDefault(),En(X,U=>{const H=L.deltaY*-.01,$=Math.max(.1,Math.min(10,U.scale+H));return{...U,scale:$}})},b=L=>{if(L.target.tagName!=="IMG"||u)return;const U=ge.current[X]||{x:0,y:0};Re.current={isDragging:!0,currentIndex:X,startX:L.clientX-U.x,startY:L.clientY-U.y},window.addEventListener("mousemove",T),window.addEventListener("mouseup",W),L.preventDefault()};K.addEventListener("wheel",se,{passive:!1}),K.addEventListener("mousedown",b),x[X]=se,j[X]=b});function T(K){if(!Re.current.isDragging)return;const{currentIndex:X,startX:se,startY:b}=Re.current;En(X,L=>({...L,x:K.clientX-se,y:K.clientY-b}))}function W(){Re.current.isDragging=!1,window.removeEventListener("mousemove",T),window.removeEventListener("mouseup",W)}return()=>{c.forEach((K,X)=>{K&&(x[X]&&K.removeEventListener("wheel",x[X]),j[X]&&K.removeEventListener("mousedown",j[X]))}),window.removeEventListener("mousemove",T),window.removeEventListener("mouseup",W)}},[u,n.length]);const Nn=c=>{const x=c.currentTarget;if(typeof x.createSVGPoint!="function")return[c.nativeEvent.offsetX,c.nativeEvent.offsetY];const j=x.createSVGPoint();j.x=c.clientX,j.y=c.clientY;const T=x.getScreenCTM();if(!T)return[0,0];const W=j.matrixTransform(T.inverse());return[W.x,W.y]};p.useEffect(()=>{if(!F)return;let c=!0;const x=j=>{const T=document.querySelector(".text-popover");setTimeout(()=>{if(c){c=!1;return}T&&!T.contains(j.target)&&(console.log("[window mousedown] 关闭弹窗"),E==null||E(null),de(null))},0)};return window.addEventListener("mousedown",x),()=>window.removeEventListener("mousedown",x)},[F]);const Mn=(c,x)=>{var W;if(!u||G||v&&v.imageId!==n[x].id)return;const[j,T]=Nn(c);if(d==="move"){const K=I[n[x].id]||[];let X=!1;for(let se=K.length-1;se>=0;se--){const b=K[se];if(b.type==="rect"||b.type==="ellipse"){const[L,U,H,$]=b.points;if(j>=Math.min(L,H)&&j<=Math.max(L,H)&&T>=Math.min(U,$)&&T<=Math.max(U,$)){ee(n[x].id,b.id),X=!0;break}}else if(b.type==="pen"){for(let L=0;L<b.points.length;L+=2)if(Math.abs(b.points[L]-j)<8&&Math.abs(b.points[L+1]-T)<8){ee(n[x].id,b.id),X=!0;break}}else if(b.type==="text"){const[L,U]=b.points;if(Math.abs(L-j)<40&&Math.abs(U-T)<24){ee(n[x].id,b.id),X=!0;break}}}X||ee(n[x].id,null);return}if(d==="text"){const X=c.currentTarget.getBoundingClientRect(),se=((W=S[x])==null?void 0:W.scale)||1,b=(c.clientX-X.left)/se,L=(c.clientY-X.top)/se;B(!0),oe({left:c.clientX,top:c.clientY}),ye([b,L]),f("");return}ae(d==="pen"?{type:"pen",start:[j,T],points:[j,T],imageId:n[x].id}:{type:d,start:[j,T],points:[j,T,j,T],imageId:n[x].id})},q=8,We=4,Ee=9,Me=4,He=({cx:c,cy:x,onPointerUp:j})=>{const[T,W]=p.useState(!1);return s.jsxs("g",{style:{cursor:"pointer"},onPointerDown:K=>{K.stopPropagation()},onPointerUp:j,onMouseEnter:()=>W(!0),onMouseLeave:()=>W(!1),children:[s.jsx("circle",{cx:c,cy:x,r:Ee,fill:T?"#007AFF":"#fff",stroke:"#007AFF",strokeWidth:1.5}),s.jsx("path",{d:`M${c-3},${x-3} L${c+3},${x+3} M${c-3},${x+3} L${c+3},${x-3}`,stroke:T?"#fff":"#007AFF",strokeWidth:1.5,strokeLinecap:"round"})]})},[Ve,_e]=p.useState(null),Tn=(c,x)=>{var W;if(!u)return;if(Ve){const K=c.clientX-Ve.x,X=c.clientY-Ve.y;(Math.abs(K)>2||Math.abs(X)>2)&&(m({imgIdx:Ve.imgIdx,annId:Ve.annId,start:[Ve.x,Ve.y],last:[c.clientX,c.clientY]}),_e(null));return}if(G){const[K,X]=[c.clientX,c.clientY],se=K-G.last[0],b=X-G.last[1],L=((W=S[x])==null?void 0:W.scale)||1,U=se/L,H=b/L;(Math.abs(U)>.01||Math.abs(H)>.01)&&(re.current?n.forEach($=>{V[$.id]&&Ie.getState().moveAnnotation($.id,V[$.id],U,H)}):Ie.getState().moveAnnotation(n[x].id,G.annId,U,H),m({...G,last:[K,X]}));return}if(!v||v.imageId!==n[x].id)return;const[j,T]=Nn(c);v&&v.type==="pen"?ae({...v,points:[...v.points,j,T]}):v&&ae({...v,points:[v.start[0],v.start[1],j,T]})},An=(c,x)=>{if(!u)return;if(Ve){_e(null);return}if(G){m(null);return}if(!v||v.imageId!==n[x].id)return;const j={id:`${Date.now()}-${Math.random().toString(36).slice(2)}`,type:v.type,points:v.points,color:g,strokeWidth:k};re.current?n.forEach(T=>y(T.id,j)):y(n[x].id,j),ae(null)};p.useEffect(()=>{if(!u)return;const c=x=>{(x.ctrlKey||x.metaKey)&&x.key.toLowerCase()==="z"&&n.length>0&&P(n[0].id),(x.ctrlKey||x.metaKey)&&x.key.toLowerCase()==="y"&&n.length>0&&N(n[0].id),(x.key==="Delete"||x.key==="Backspace")&&(re.current?n.forEach(j=>{const T=V[j.id];T&&Ie.getState().deleteAnnotation(j.id,T)}):n.forEach(j=>{const T=V[j.id];T&&Ie.getState().deleteAnnotation(j.id,T)}))};return window.addEventListener("keydown",c),()=>window.removeEventListener("keydown",c)},[u,n,P,N,V,re]),p.useEffect(()=>{n.length===0&&kt.setState({hasViewedImages:!1})},[n.length]);const Dn=()=>{if(ne.trim()&&C){const c={id:`${Date.now()}-${Math.random().toString(36).slice(2)}`,type:"text",points:C,color:g,strokeWidth:k,text:ne,fontSize:D};re.current?n.forEach(x=>y(x.id,c)):y(n[0].id,c)}B(!1),oe(null),f(""),ye(null)},ts=ue&&J?dt.createPortal(s.jsxs(s.Fragment,{children:[s.jsx("div",{className:"text-popover-mask",style:{position:"fixed",inset:0,zIndex:9998,background:"transparent"},onClick:Dn}),s.jsx("textarea",{ref:le,value:ne,onChange:c=>{f(c.target.value),le.current&&(le.current.style.width="2px",le.current.style.width=`${Math.max(180,le.current.scrollWidth)}px`)},onKeyDown:c=>{c.key==="Enter"&&!c.shiftKey?(c.preventDefault(),Dn()):c.key==="Escape"&&(c.preventDefault(),B(!1),oe(null),f(""),ye(null))},placeholder:"请输入文字...",style:{position:"fixed",left:J.left,top:J.top,width:"180px",minWidth:"2px",height:D+4,padding:"0 2px",margin:0,border:"none",outline:"none",background:"transparent",color:g,caretColor:g,fontSize:D,fontFamily:"system-ui, -apple-system, sans-serif",resize:"none",overflow:"hidden",whiteSpace:"nowrap",zIndex:9999,lineHeight:"1",verticalAlign:"middle",transform:"translate(-2px, -50%)",boxSizing:"border-box"}})]}),document.body):null;p.useEffect(()=>{ue&&le.current&&requestAnimationFrame(()=>{if(le.current){le.current.focus();const c=le.current.value.length;le.current.setSelectionRange(c,c)}})},[ue]);const[ns,Kt]=p.useState([]),gt=[1,2,5];p.useEffect(()=>{Kt(Array(n.length).fill(-1))},[n.length]);const Ln=(c,x)=>{Kt(j=>{const T=[...j];return T[c]===x?T[c]=-1:T[c]=x,T}),R(j=>{const T=[...j];if(ns[c]===x){if(re.current)return T.map(()=>({scale:1,x:0,y:0}));T[c]={...T[c],scale:1}}else{if(re.current)return T.map(()=>({scale:gt[x],x:0,y:0}));T[c]={...T[c],scale:gt[x]}}return T})};p.useEffect(()=>{Kt(c=>c.map((x,j)=>{var W;if(x===-1)return-1;const T=((W=S[j])==null?void 0:W.scale)||1;return Math.abs(T-gt[x])>.01?-1:x}))},[S]);const{enabled:Ae,keyframes:Fn,currentIdx:Ue,setKeyframe:Rn,setCurrentIdx:On,playing:jt,setPlaying:Bn,frameDuration:Jt,transitionDuration:It,transitionEasing:lt}=yn();return p.useEffect(()=>{var j,T,W;if(!Ae||n.length!==1)return;const c=0,x={scale:((j=S[c])==null?void 0:j.scale)||1,offsetX:((T=S[c])==null?void 0:T.x)||0,offsetY:((W=S[c])==null?void 0:W.y)||0};Rn(Ue,x)},[(Un=S[0])==null?void 0:Un.scale,($n=S[0])==null?void 0:$n.x,(zn=S[0])==null?void 0:zn.y,Ae,Ue,n.length]),ie.useEffect(()=>{var L,U,H;if(!Ae||n.length!==1)return;const c=0,x=Fn[Ue];if(!x)return;let j,T=0;const W=It||400,K={scale:((L=S[c])==null?void 0:L.scale)||1,x:((U=S[c])==null?void 0:U.x)||0,y:((H=S[c])==null?void 0:H.y)||0},X={scale:x.scale,x:x.offsetX,y:x.offsetY},se=$=>lt==="linear"?$:lt==="ease-in"?$*$:$<.5?2*$*$:-1+(4-2*$)*$,b=()=>{T+=16;const $=Math.min(T/W,1),te=se($),ve=K.scale+(X.scale-K.scale)*te,Ce=K.x+(X.x-K.x)*te,fe=K.y+(X.y-K.y)*te;R(ce=>{const je=[...ce];return je[c]={scale:ve,x:Ce,y:fe},je}),$<1&&(j=requestAnimationFrame(b))};return b(),()=>cancelAnimationFrame(j)},[Ue,Ae,n.length,It,lt]),p.useEffect(()=>{!Ae||n.length<=1||n.forEach((c,x)=>{var T,W,K;const j={scale:((T=S[x])==null?void 0:T.scale)||1,offsetX:((W=S[x])==null?void 0:W.x)||0,offsetY:((K=S[x])==null?void 0:K.y)||0};Rn(Ue,j)})},[S,Ae,Ue,n.length]),ie.useEffect(()=>{!Ae||n.length<=1||n.forEach((c,x)=>{var U,H,$;const j=Fn[Ue];if(!j)return;let T,W=0;const K=It||400,X={scale:((U=S[x])==null?void 0:U.scale)||1,x:((H=S[x])==null?void 0:H.x)||0,y:(($=S[x])==null?void 0:$.y)||0},se={scale:j.scale,x:j.offsetX,y:j.offsetY},b=te=>lt==="linear"?te:lt==="ease-in"?te*te:te<.5?2*te*te:-1+(4-2*te)*te,L=()=>{W+=16;const te=Math.min(W/K,1),ve=b(te),Ce=X.scale+(se.scale-X.scale)*ve,fe=X.x+(se.x-X.x)*ve,ce=X.y+(se.y-X.y)*ve;R(je=>{const me=[...je];return me[x]={scale:Ce,x:fe,y:ce},me}),te<1&&(T=requestAnimationFrame(L))};return L(),()=>cancelAnimationFrame(T)})},[Ue,Ae,n.length,It,lt]),p.useEffect(()=>{if(!Ae||!jt)return;let c=Ue,x;const j=()=>{c=(c+1)%5,On(c),c!==4?x=setTimeout(j,Jt||1200):Bn(!1)};return x=setTimeout(j,Jt||1200),()=>clearTimeout(x)},[jt,Ae,Jt]),ie.useEffect(()=>{if(!Ae)return;const c=x=>{if(!(x.target&&x.target.tagName==="INPUT")){if(x.code.startsWith("Digit")){const j=Number(x.code.replace("Digit",""));j>=1&&j<=5&&On(j-1)}x.code==="Space"&&(Bn(!jt),x.preventDefault())}};return window.addEventListener("keydown",c),()=>window.removeEventListener("keydown",c)},[Ae,jt]),n.length===0?null:s.jsxs("div",{className:"fixed inset-0 flex items-center justify-center",children:[n.length===1?s.jsx("div",{className:"w-full md:w-[90%] h-[80vh] px-4 flex items-center justify-center",children:s.jsx("div",{className:"relative w-full h-full flex items-center justify-center",children:s.jsxs("div",{ref:c=>w.current[0]=c,className:`w-full h-full ${e==="dark"?"bg-black":"bg-white"} shadow-lg overflow-hidden relative group`,style:{borderRadius:o},children:[i&&s.jsx("div",{className:"absolute left-1/2 transform -translate-x-1/2 bottom-36 z-30 flex flex-row items-end space-x-3 select-none mb-4",children:gt.map((c,x)=>{var K;const j=((K=S[0])==null?void 0:K.scale)||1;let T=!1;x===0&&j>=1&&j<2&&(T=!0),x===1&&j>=2&&j<5&&(T=!0),x===2&&j>=5&&(T=!0);const W=Number.isInteger(j)?`${j}x`:`${j.toFixed(1)}x`;return s.jsx("button",{onClick:()=>Ln(0,x),className:`w-9 h-9 flex items-center justify-center rounded-full font-semibold transition-all duration-200 shadow-md
                          border border-gray-300 dark:border-gray-700
                          bg-white/80 dark:bg-gray-900/80 backdrop-blur-md
                          hover:bg-sky-100/80 dark:hover:bg-gray-800/90
                          focus:outline-none focus:ring-2 focus:ring-sky-400 focus:ring-opacity-50
                        `,style:{minWidth:36,minHeight:36,maxWidth:36,maxHeight:36,outline:"none",position:"relative",transform:T?"scale(1.22)":"scale(1)"},title:`缩放到${c}x`,children:T?s.jsx("span",{className:"text-gray-700 dark:text-gray-100 font-medium whitespace-nowrap text-[13px] leading-none drop-shadow-sm",children:W}):s.jsxs("span",{className:"text-gray-700 dark:text-gray-200 font-medium whitespace-nowrap text-[13px] leading-none drop-shadow-sm",children:[c,"x"]})},c)})}),s.jsx("img",{ref:c=>_.current[0]=c,src:n[0].url,alt:n[0].exif.FileName,className:"w-full h-full object-contain select-none",style:{transform:`translate(${((Wn=S[0])==null?void 0:Wn.x)||0}px, ${((Hn=S[0])==null?void 0:Hn.y)||0}px) scale(${((Vn=S[0])==null?void 0:Vn.scale)||1})`,touchAction:"none",userSelect:"none",WebkitUserSelect:"none"},draggable:!1}),s.jsxs("svg",{className:"absolute inset-0 w-full h-full z-20",style:{transform:`translate(${((_n=S[0])==null?void 0:_n.x)||0}px, ${((Gn=S[0])==null?void 0:Gn.y)||0}px) scale(${((Xn=S[0])==null?void 0:Xn.scale)||1})`,pointerEvents:u?ue?"none":"auto":"none",touchAction:"none",userSelect:"none",WebkitUserSelect:"none"},onPointerDown:u?c=>Mn(c,0):void 0,onPointerMove:u?c=>Tn(c,0):void 0,onPointerUp:u?c=>An(c,0):void 0,children:[(I[n[0].id]||[]).map((c,x)=>{var T;const j=V[n[0].id]===c.id;if(c.type==="rect"){const[W,K,X,se]=c.points,b=Math.min(W,X),L=Math.min(K,se),U=Math.abs(X-W),H=Math.abs(se-K);return s.jsxs("g",{children:[s.jsx("rect",{x:b,y:L,width:U,height:H,stroke:c.color,strokeWidth:c.strokeWidth,vectorEffect:"non-scaling-stroke",fill:"none",onPointerDown:$=>{$.stopPropagation(),ee(n[0].id,c.id),d==="move"&&(re.current?n.forEach(te=>Ie.getState().pushUndo(te.id,I[te.id]||[])):Ie.getState().pushUndo(n[0].id,I[n[0].id]||[])),_e({x:$.clientX,y:$.clientY,annId:c.id,imgIdx:0})}}),d==="move"&&j&&s.jsxs("g",{children:[s.jsx("rect",{x:b-q,y:L-q,width:U+q*2,height:H+q*2,stroke:"#007AFF",strokeWidth:2,fill:"none",rx:We,strokeDasharray:"4 4",style:{filter:"drop-shadow(0 0 2px #007AFF88)"},pointerEvents:"all",onPointerDown:$=>{$.stopPropagation(),m({imgIdx:0,annId:c.id,start:[$.clientX,$.clientY],last:[$.clientX,$.clientY]})}}),s.jsx(He,{cx:b+U+q+Ee+Me,cy:L-q-Ee-Me,onPointerUp:$=>{$.stopPropagation(),re.current?n.forEach(te=>A(te.id,c.id)):A(n[0].id,c.id)}})]})]},c.id)}if(c.type==="ellipse"){const[W,K,X,se]=c.points,b=Math.min(W,X),L=Math.min(K,se),U=Math.abs(X-W),H=Math.abs(se-K);return s.jsxs("g",{children:[s.jsx("ellipse",{cx:(W+X)/2,cy:(K+se)/2,rx:U/2,ry:H/2,stroke:c.color,strokeWidth:c.strokeWidth,vectorEffect:"non-scaling-stroke",fill:"none",onPointerDown:$=>{$.stopPropagation(),ee(n[0].id,c.id),d==="move"&&(re.current?n.forEach(te=>Ie.getState().pushUndo(te.id,I[te.id]||[])):Ie.getState().pushUndo(n[0].id,I[n[0].id]||[])),_e({x:$.clientX,y:$.clientY,annId:c.id,imgIdx:0})}}),d==="move"&&j&&s.jsxs("g",{children:[s.jsx("rect",{x:b-q,y:L-q,width:U+q*2,height:H+q*2,stroke:"#007AFF",strokeWidth:2,fill:"none",rx:We,strokeDasharray:"4 4",style:{filter:"drop-shadow(0 0 2px #007AFF88)"},pointerEvents:"all",onPointerDown:$=>{$.stopPropagation(),m({imgIdx:0,annId:c.id,start:[$.clientX,$.clientY],last:[$.clientX,$.clientY]})}}),s.jsx(He,{cx:b+U+q+Ee+Me,cy:L-q-Ee-Me,onPointerUp:$=>{$.stopPropagation(),re.current?n.forEach(te=>A(te.id,c.id)):A(n[0].id,c.id)}})]})]},c.id)}if(c.type==="pen"){const W=c.points,K=W.length>=4?`M${W[0]},${W[1]} `+W.slice(2).map((U,H)=>H%2===0?`L${W[H+2]},${W[H+3]}`:"").join(" "):"";let X=1/0,se=1/0,b=-1/0,L=-1/0;for(let U=0;U<W.length;U+=2)X=Math.min(X,W[U]),se=Math.min(se,W[U+1]),b=Math.max(b,W[U]),L=Math.max(L,W[U+1]);return s.jsxs("g",{children:[s.jsx("path",{d:K,stroke:c.color,strokeWidth:c.strokeWidth,vectorEffect:"non-scaling-stroke",fill:"none",strokeLinejoin:"round",strokeLinecap:"round",onPointerDown:U=>{U.stopPropagation(),ee(n[0].id,c.id),d==="move"&&(re.current?n.forEach(H=>Ie.getState().pushUndo(H.id,I[H.id]||[])):Ie.getState().pushUndo(n[0].id,I[n[0].id]||[])),_e({x:U.clientX,y:U.clientY,annId:c.id,imgIdx:0})}}),d==="move"&&j&&s.jsxs("g",{children:[s.jsx("rect",{x:X-q,y:se-q,width:b-X+q*2,height:L-se+q*2,stroke:"#007AFF",strokeWidth:2,fill:"none",rx:We,strokeDasharray:"4 4",style:{filter:"drop-shadow(0 0 2px #007AFF88)"},pointerEvents:"all",onPointerDown:U=>{U.stopPropagation(),m({imgIdx:0,annId:c.id,start:[U.clientX,U.clientY],last:[U.clientX,U.clientY]})}}),s.jsx(He,{cx:b+q+Ee+Me,cy:se-q-Ee-Me,onPointerUp:U=>{U.stopPropagation(),re.current?n.forEach(H=>A(H.id,c.id)):A(n[0].id,c.id)}})]})]},c.id)}if(c.type==="text"){const[W,K]=c.points,X=(((T=c.text)==null?void 0:T.length)||0)*(c.fontSize||18)*.96,se=Math.max(120,X+16),b=40;return F===c.id?null:s.jsxs("g",{children:[s.jsx("text",{x:W,y:K,fontSize:c.fontSize||18,fill:c.color,textAnchor:"start",alignmentBaseline:"middle",style:{cursor:d==="move"?"move":"text",userSelect:"none",...j?{filter:"drop-shadow(0 0 2px #007AFF88)"}:{}},onDoubleClick:()=>E==null?void 0:E(c.id),onPointerDown:L=>{L.stopPropagation(),d==="move"&&(ee(n[0].id,c.id),m({imgIdx:0,annId:c.id,start:[L.clientX,L.clientY],last:[L.clientX,L.clientY]}))},children:c.text}),d==="move"&&j&&s.jsxs("g",{children:[s.jsx("rect",{x:W-q,y:K-b/2-q,width:se+q*2,height:b+q*2,stroke:"#007AFF",strokeWidth:2,fill:"none",rx:We,strokeDasharray:"4 4",style:{filter:"drop-shadow(0 0 2px #007AFF88)"},pointerEvents:"all",onPointerDown:L=>{L.stopPropagation(),m({imgIdx:0,annId:c.id,start:[L.clientX,L.clientY],last:[L.clientX,L.clientY]})}}),s.jsx(He,{cx:W+se+q+Ee+Me,cy:K-b/2-q-Ee-Me,onPointerUp:L=>{L.stopPropagation(),re.current?n.forEach(U=>A(U.id,c.id)):A(n[0].id,c.id)}})]})]},c.id)}return null}),v&&(re.current||n[0].id===v.imageId)&&(v.type==="rect"?s.jsx("rect",{x:Math.min(v.start[0],v.points[2]),y:Math.min(v.start[1],v.points[3]),width:Math.abs(v.points[2]-v.start[0]),height:Math.abs(v.points[3]-v.start[1]),stroke:g,strokeWidth:k,vectorEffect:"non-scaling-stroke",fill:"none",pointerEvents:"none"}):v.type==="ellipse"?s.jsx("ellipse",{cx:(v.start[0]+v.points[2])/2,cy:(v.start[1]+v.points[3])/2,rx:Math.abs(v.points[2]-v.start[0])/2,ry:Math.abs(v.points[3]-v.start[1])/2,stroke:g,strokeWidth:k,vectorEffect:"non-scaling-stroke",fill:"none",pointerEvents:"none"}):v.type==="pen"&&v.points.length>=4?s.jsx("path",{d:`M${v.points[0]},${v.points[1]} `+v.points.slice(2).map((c,x)=>x%2===0?`L${v.points[x+2]},${v.points[x+3]}`:"").join(" "),stroke:g,strokeWidth:k,vectorEffect:"non-scaling-stroke",fill:"none",strokeLinejoin:"round",strokeLinecap:"round",pointerEvents:"none"}):null)]}),s.jsx(yr,{imageInfo:n[0]})]})},n[0].id)}):s.jsx("div",{className:"w-full md:w-[90%] h-[80vh] items-center justify-center px-4 mx-auto grid",style:{gridTemplateColumns:`repeat(${n.length}, minmax(0, 1fr))`,gap:a},children:n.map((c,x)=>{var j,T,W,K,X,se;return s.jsxs("div",{ref:b=>w.current[x]=b,className:"w-full h-full shadow-lg overflow-hidden relative group",style:{borderRadius:o},children:[i&&s.jsx("div",{className:"absolute left-1/2 transform -translate-x-1/2 bottom-36 z-30 flex flex-row items-end space-x-3 select-none mb-4",children:gt.map((b,L)=>{var te;const U=((te=S[x])==null?void 0:te.scale)||1;let H=!1;L===0&&U>=1&&U<2&&(H=!0),L===1&&U>=2&&U<5&&(H=!0),L===2&&U>=5&&(H=!0);const $=Number.isInteger(U)?`${U}x`:`${U.toFixed(1)}x`;return s.jsx("button",{onClick:()=>Ln(x,L),className:`w-9 h-9 flex items-center justify-center rounded-full font-semibold transition-all duration-200 shadow-md
                          border border-gray-300 dark:border-gray-700
                          bg-white/80 dark:bg-gray-900/80 backdrop-blur-md
                          hover:bg-sky-100/80 dark:hover:bg-gray-800/90
                          focus:outline-none focus:ring-2 focus:ring-sky-400 focus:ring-opacity-50
                        `,style:{minWidth:36,minHeight:36,maxWidth:36,maxHeight:36,outline:"none",position:"relative",transform:H?"scale(1.22)":"scale(1)"},title:`缩放到${b}x`,children:H?s.jsx("span",{className:"text-gray-700 dark:text-gray-100 font-medium whitespace-nowrap text-[13px] leading-none drop-shadow-sm",children:$}):s.jsxs("span",{className:"text-gray-700 dark:text-gray-200 font-medium whitespace-nowrap text-[13px] leading-none drop-shadow-sm",children:[b,"x"]})},b)})}),s.jsx("img",{ref:b=>_.current[x]=b,src:c.url,alt:c.exif.FileName,className:"w-full h-full object-contain select-none",style:{transform:`translate(${((j=S[x])==null?void 0:j.x)||0}px, ${((T=S[x])==null?void 0:T.y)||0}px) scale(${((W=S[x])==null?void 0:W.scale)||1})`,touchAction:"none",userSelect:"none",WebkitUserSelect:"none"},draggable:!1}),s.jsxs("svg",{className:"absolute inset-0 w-full h-full z-20",style:{transform:`translate(${((K=S[x])==null?void 0:K.x)||0}px, ${((X=S[x])==null?void 0:X.y)||0}px) scale(${((se=S[x])==null?void 0:se.scale)||1})`,pointerEvents:u?"auto":"none",touchAction:"none",userSelect:"none",WebkitUserSelect:"none"},onPointerDown:u?b=>Mn(b,x):void 0,onPointerMove:u?b=>Tn(b,x):void 0,onPointerUp:u?b=>An(b,x):void 0,children:[(I[c.id]||[]).map(b=>{var U;const L=V[c.id]===b.id;if(b.type==="rect"){const[H,$,te,ve]=b.points,Ce=Math.min(H,te),fe=Math.min($,ve),ce=Math.abs(te-H),je=Math.abs(ve-$);return s.jsxs("g",{children:[s.jsx("rect",{x:Ce,y:fe,width:ce,height:je,stroke:b.color,strokeWidth:b.strokeWidth,vectorEffect:"non-scaling-stroke",fill:"none",onPointerDown:me=>{me.stopPropagation(),ee(c.id,b.id),d==="move"&&(re.current?n.forEach($e=>Ie.getState().pushUndo($e.id,I[$e.id]||[])):Ie.getState().pushUndo(c.id,I[c.id]||[])),_e({x:me.clientX,y:me.clientY,annId:b.id,imgIdx:x})}}),d==="move"&&L&&s.jsxs("g",{children:[s.jsx("rect",{x:Ce-q,y:fe-q,width:ce+q*2,height:je+q*2,stroke:"#007AFF",strokeWidth:2,fill:"none",rx:We,strokeDasharray:"4 4",style:{filter:"drop-shadow(0 0 2px #007AFF88)"},pointerEvents:"all",onPointerDown:me=>{me.stopPropagation(),m({imgIdx:x,annId:b.id,start:[me.clientX,me.clientY],last:[me.clientX,me.clientY]})}}),s.jsx(He,{cx:Ce+ce+q+Ee+Me,cy:fe-q-Ee-Me,onPointerUp:me=>{me.stopPropagation(),re.current?n.forEach($e=>A($e.id,b.id)):A(c.id,b.id)}})]})]},b.id)}if(b.type==="ellipse"){const[H,$,te,ve]=b.points,Ce=Math.min(H,te),fe=Math.min($,ve),ce=Math.abs(te-H),je=Math.abs(ve-$);return s.jsxs("g",{children:[s.jsx("ellipse",{cx:(H+te)/2,cy:($+ve)/2,rx:ce/2,ry:je/2,stroke:b.color,strokeWidth:b.strokeWidth,vectorEffect:"non-scaling-stroke",fill:"none",onPointerDown:me=>{me.stopPropagation(),ee(c.id,b.id),d==="move"&&(re.current?n.forEach($e=>Ie.getState().pushUndo($e.id,I[$e.id]||[])):Ie.getState().pushUndo(c.id,I[c.id]||[])),_e({x:me.clientX,y:me.clientY,annId:b.id,imgIdx:x})}}),d==="move"&&L&&s.jsxs("g",{children:[s.jsx("rect",{x:Ce-q,y:fe-q,width:ce+q*2,height:je+q*2,stroke:"#007AFF",strokeWidth:2,fill:"none",rx:We,strokeDasharray:"4 4",style:{filter:"drop-shadow(0 0 2px #007AFF88)"},pointerEvents:"all",onPointerDown:me=>{me.stopPropagation(),m({imgIdx:x,annId:b.id,start:[me.clientX,me.clientY],last:[me.clientX,me.clientY]})}}),s.jsx(He,{cx:Ce+ce+q+Ee+Me,cy:fe-q-Ee-Me,onPointerUp:me=>{me.stopPropagation(),re.current?n.forEach($e=>A($e.id,b.id)):A(c.id,b.id)}})]})]},b.id)}if(b.type==="pen"){const H=b.points,$=H.length>=4?`M${H[0]},${H[1]} `+H.slice(2).map((ce,je)=>je%2===0?`L${H[je+2]},${H[je+3]}`:"").join(" "):"";let te=1/0,ve=1/0,Ce=-1/0,fe=-1/0;for(let ce=0;ce<H.length;ce+=2)te=Math.min(te,H[ce]),ve=Math.min(ve,H[ce+1]),Ce=Math.max(Ce,H[ce]),fe=Math.max(fe,H[ce+1]);return s.jsxs("g",{children:[s.jsx("path",{d:$,stroke:b.color,strokeWidth:b.strokeWidth,vectorEffect:"non-scaling-stroke",fill:"none",strokeLinejoin:"round",strokeLinecap:"round",onPointerDown:ce=>{ce.stopPropagation(),ee(c.id,b.id),d==="move"&&(re.current?n.forEach(je=>Ie.getState().pushUndo(je.id,I[je.id]||[])):Ie.getState().pushUndo(c.id,I[c.id]||[])),_e({x:ce.clientX,y:ce.clientY,annId:b.id,imgIdx:x})}}),d==="move"&&L&&s.jsxs("g",{children:[s.jsx("rect",{x:te-q,y:ve-q,width:Ce-te+q*2,height:fe-ve+q*2,stroke:"#007AFF",strokeWidth:2,fill:"none",rx:We,strokeDasharray:"4 4",style:{filter:"drop-shadow(0 0 2px #007AFF88)"},pointerEvents:"all",onPointerDown:ce=>{ce.stopPropagation(),m({imgIdx:x,annId:b.id,start:[ce.clientX,ce.clientY],last:[ce.clientX,ce.clientY]})}}),s.jsx(He,{cx:Ce+q+Ee+Me,cy:ve-q-Ee-Me,onPointerUp:ce=>{ce.stopPropagation(),re.current?n.forEach(je=>A(je.id,b.id)):A(c.id,b.id)}})]})]},b.id)}if(b.type==="text"){const[H,$]=b.points,te=(((U=b.text)==null?void 0:U.length)||0)*(b.fontSize||18)*.96,ve=Math.max(120,te+16),Ce=40;return F===b.id?null:s.jsxs("g",{children:[s.jsx("text",{x:H,y:$,fontSize:b.fontSize||18,fill:b.color,textAnchor:"start",alignmentBaseline:"middle",style:{cursor:d==="move"?"move":"text",userSelect:"none",...L?{filter:"drop-shadow(0 0 2px #007AFF88)"}:{}},onDoubleClick:()=>E==null?void 0:E(b.id),onPointerDown:fe=>{fe.stopPropagation(),d==="move"&&(ee(c.id,b.id),m({imgIdx:x,annId:b.id,start:[fe.clientX,fe.clientY],last:[fe.clientX,fe.clientY]}))},children:b.text}),d==="move"&&L&&s.jsxs("g",{children:[s.jsx("rect",{x:H-q,y:$-Ce/2-q,width:ve+q*2,height:Ce+q*2,stroke:"#007AFF",strokeWidth:2,fill:"none",rx:We,strokeDasharray:"4 4",style:{filter:"drop-shadow(0 0 2px #007AFF88)"},pointerEvents:"all",onPointerDown:fe=>{fe.stopPropagation(),m({imgIdx:x,annId:b.id,start:[fe.clientX,fe.clientY],last:[fe.clientX,fe.clientY]})}}),s.jsx(He,{cx:H+ve+q+Ee+Me,cy:$-Ce/2-q-Ee-Me,onPointerUp:fe=>{fe.stopPropagation(),re.current?n.forEach(ce=>A(ce.id,b.id)):A(c.id,b.id)}})]})]},b.id)}return null}),v&&(re.current||c.id===v.imageId)&&(v.type==="rect"?s.jsx("rect",{x:Math.min(v.start[0],v.points[2]),y:Math.min(v.start[1],v.points[3]),width:Math.abs(v.points[2]-v.start[0]),height:Math.abs(v.points[3]-v.start[1]),stroke:g,strokeWidth:k,vectorEffect:"non-scaling-stroke",fill:"none",pointerEvents:"none"}):v.type==="ellipse"?s.jsx("ellipse",{cx:(v.start[0]+v.points[2])/2,cy:(v.start[1]+v.points[3])/2,rx:Math.abs(v.points[2]-v.start[0])/2,ry:Math.abs(v.points[3]-v.start[1])/2,stroke:g,strokeWidth:k,vectorEffect:"non-scaling-stroke",fill:"none",pointerEvents:"none"}):v.type==="pen"&&v.points.length>=4?s.jsx("path",{d:`M${v.points[0]},${v.points[1]} `+v.points.slice(2).map((b,L)=>L%2===0?`L${v.points[L+2]},${v.points[L+3]}`:"").join(" "),stroke:g,strokeWidth:k,vectorEffect:"non-scaling-stroke",fill:"none",strokeLinejoin:"round",strokeLinecap:"round",pointerEvents:"none"}):null)]}),!r&&s.jsx("button",{onClick:()=>{l(c.id)},className:`absolute top-2 right-2 z-50 p-1.5 rounded-full transition-all duration-200 opacity-0 group-hover:opacity-100
                    ${e==="dark"?"bg-gray-800/90 text-gray-100 hover:bg-gray-700":"bg-white/80 text-gray-700 hover:bg-white"}`,title:"删除图片",children:s.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})}),s.jsx(yr,{imageInfo:c})]},c.id)})}),ts]})};var Yr={exports:{}};(function(n){(function(e){var t=V(),r=ee(),i=v(),o=ae(),a={imagePlaceholder:void 0,cacheBust:!1},l={toSvg:h,toPng:d,toJpeg:g,toBlob:k,toPixelData:u,impl:{fontFaces:i,images:o,util:t,inliner:r,options:{}}};n.exports=l;function h(F,E){return E=E||{},D(E),Promise.resolve(F).then(function(w){return y(w,E.filter,!0)}).then(M).then(P).then(A).then(function(w){return N(w,E.width||t.width(F),E.height||t.height(F))});function A(w){return E.bgcolor&&(w.style.backgroundColor=E.bgcolor),E.width&&(w.style.width=E.width+"px"),E.height&&(w.style.height=E.height+"px"),E.style&&Object.keys(E.style).forEach(function(_){w.style[_]=E.style[_]}),w}}function u(F,E){return I(F,E||{}).then(function(A){return A.getContext("2d").getImageData(0,0,t.width(F),t.height(F)).data})}function d(F,E){return I(F,E||{}).then(function(A){return A.toDataURL()})}function g(F,E){return E=E||{},I(F,E).then(function(A){return A.toDataURL("image/jpeg",E.quality||1)})}function k(F,E){return I(F,E||{}).then(t.canvasToBlob)}function D(F){typeof F.imagePlaceholder>"u"?l.impl.options.imagePlaceholder=a.imagePlaceholder:l.impl.options.imagePlaceholder=F.imagePlaceholder,typeof F.cacheBust>"u"?l.impl.options.cacheBust=a.cacheBust:l.impl.options.cacheBust=F.cacheBust}function I(F,E){return h(F,E).then(t.makeImage).then(t.delay(100)).then(function(w){var _=A(F);return _.getContext("2d").drawImage(w,0,0),_});function A(w){var _=document.createElement("canvas");if(_.width=E.width||t.width(w),_.height=E.height||t.height(w),E.bgcolor){var S=_.getContext("2d");S.fillStyle=E.bgcolor,S.fillRect(0,0,_.width,_.height)}return _}}function y(F,E,A){if(!A&&E&&!E(F))return Promise.resolve();return Promise.resolve(F).then(w).then(function(R){return _(F,R,E)}).then(function(R){return S(F,R)});function w(R){return R instanceof HTMLCanvasElement?t.makeImage(R.toDataURL()):R.cloneNode(!1)}function _(R,Y,xe){var G=R.childNodes;if(G.length===0)return Promise.resolve(Y);return m(Y,t.asArray(G),xe).then(function(){return Y});function m(Q,he,O){var z=Promise.resolve();return he.forEach(function(pe){z=z.then(function(){return y(pe,O)}).then(function(de){de&&Q.appendChild(de)})}),z}}function S(R,Y){if(!(Y instanceof Element))return Y;return Promise.resolve().then(xe).then(G).then(m).then(Q).then(function(){return Y});function xe(){he(window.getComputedStyle(R),Y.style);function he(O,z){O.cssText?z.cssText=O.cssText:pe(O,z);function pe(de,ue){t.asArray(de).forEach(function(B){ue.setProperty(B,de.getPropertyValue(B),de.getPropertyPriority(B))})}}}function G(){[":before",":after"].forEach(function(O){he(O)});function he(O){var z=window.getComputedStyle(R,O),pe=z.getPropertyValue("content");if(pe===""||pe==="none")return;var de=t.uid();Y.className=Y.className+" "+de;var ue=document.createElement("style");ue.appendChild(B(de,O,z)),Y.appendChild(ue);function B(J,oe,ne){var f="."+J+":"+oe,C=ne.cssText?ye(ne):le(ne);return document.createTextNode(f+"{"+C+"}");function ye(ge){var re=ge.getPropertyValue("content");return ge.cssText+" content: "+re+";"}function le(ge){return t.asArray(ge).map(re).join("; ")+";";function re(Re){return Re+": "+ge.getPropertyValue(Re)+(ge.getPropertyPriority(Re)?" !important":"")}}}}}function m(){R instanceof HTMLTextAreaElement&&(Y.innerHTML=R.value),R instanceof HTMLInputElement&&Y.setAttribute("value",R.value)}function Q(){Y instanceof SVGElement&&(Y.setAttribute("xmlns","http://www.w3.org/2000/svg"),Y instanceof SVGRectElement&&["width","height"].forEach(function(he){var O=Y.getAttribute(he);O&&Y.style.setProperty(he,O)}))}}}function M(F){return i.resolveAll().then(function(E){var A=document.createElement("style");return F.appendChild(A),A.appendChild(document.createTextNode(E)),F})}function P(F){return o.inlineAll(F).then(function(){return F})}function N(F,E,A){return Promise.resolve(F).then(function(w){return w.setAttribute("xmlns","http://www.w3.org/1999/xhtml"),new XMLSerializer().serializeToString(w)}).then(t.escapeXhtml).then(function(w){return'<foreignObject x="0" y="0" width="100%" height="100%">'+w+"</foreignObject>"}).then(function(w){return'<svg xmlns="http://www.w3.org/2000/svg" width="'+E+'" height="'+A+'">'+w+"</svg>"}).then(function(w){return"data:image/svg+xml;charset=utf-8,"+w})}function V(){return{escape:Q,parseExtension:E,mimeType:A,dataAsUrl:m,isDataUrl:w,canvasToBlob:S,resolveUrl:R,getAndEncode:G,uid:Y(),delay:he,asArray:O,escapeXhtml:z,makeImage:xe,width:pe,height:de};function F(){var B="application/font-woff",J="image/jpeg";return{woff:B,woff2:B,ttf:"application/font-truetype",eot:"application/vnd.ms-fontobject",png:"image/png",jpg:J,jpeg:J,gif:"image/gif",tiff:"image/tiff",svg:"image/svg+xml"}}function E(B){var J=/\.([^\.\/]*?)$/g.exec(B);return J?J[1]:""}function A(B){var J=E(B).toLowerCase();return F()[J]||""}function w(B){return B.search(/^(data:)/)!==-1}function _(B){return new Promise(function(J){for(var oe=window.atob(B.toDataURL().split(",")[1]),ne=oe.length,f=new Uint8Array(ne),C=0;C<ne;C++)f[C]=oe.charCodeAt(C);J(new Blob([f],{type:"image/png"}))})}function S(B){return B.toBlob?new Promise(function(J){B.toBlob(J)}):_(B)}function R(B,J){var oe=document.implementation.createHTMLDocument(),ne=oe.createElement("base");oe.head.appendChild(ne);var f=oe.createElement("a");return oe.body.appendChild(f),ne.href=J,f.href=B,f.href}function Y(){var B=0;return function(){return"u"+J()+B++;function J(){return("0000"+(Math.random()*Math.pow(36,4)<<0).toString(36)).slice(-4)}}}function xe(B){return new Promise(function(J,oe){var ne=new Image;ne.onload=function(){J(ne)},ne.onerror=oe,ne.src=B})}function G(B){var J=3e4;return l.impl.options.cacheBust&&(B+=(/\?/.test(B)?"&":"?")+new Date().getTime()),new Promise(function(oe){var ne=new XMLHttpRequest;ne.onreadystatechange=ye,ne.ontimeout=le,ne.responseType="blob",ne.timeout=J,ne.open("GET",B,!0),ne.send();var f;if(l.impl.options.imagePlaceholder){var C=l.impl.options.imagePlaceholder.split(/,/);C&&C[1]&&(f=C[1])}function ye(){if(ne.readyState===4){if(ne.status!==200){f?oe(f):ge("cannot fetch resource: "+B+", status: "+ne.status);return}var re=new FileReader;re.onloadend=function(){var Re=re.result.split(/,/)[1];oe(Re)},re.readAsDataURL(ne.response)}}function le(){f?oe(f):ge("timeout of "+J+"ms occured while fetching resource: "+B)}function ge(re){console.error(re),oe("")}})}function m(B,J){return"data:"+J+";base64,"+B}function Q(B){return B.replace(/([.*+?^${}()|\[\]\/\\])/g,"\\$1")}function he(B){return function(J){return new Promise(function(oe){setTimeout(function(){oe(J)},B)})}}function O(B){for(var J=[],oe=B.length,ne=0;ne<oe;ne++)J.push(B[ne]);return J}function z(B){return B.replace(/#/g,"%23").replace(/\n/g,"%0A")}function pe(B){var J=ue(B,"border-left-width"),oe=ue(B,"border-right-width");return B.scrollWidth+J+oe}function de(B){var J=ue(B,"border-top-width"),oe=ue(B,"border-bottom-width");return B.scrollHeight+J+oe}function ue(B,J){var oe=window.getComputedStyle(B).getPropertyValue(J);return parseFloat(oe.replace("px",""))}}function ee(){var F=/url\(['"]?([^'"]+?)['"]?\)/g;return{inlineAll:_,shouldProcess:E,impl:{readUrls:A,inline:w}};function E(S){return S.search(F)!==-1}function A(S){for(var R=[],Y;(Y=F.exec(S))!==null;)R.push(Y[1]);return R.filter(function(xe){return!t.isDataUrl(xe)})}function w(S,R,Y,xe){return Promise.resolve(R).then(function(m){return Y?t.resolveUrl(m,Y):m}).then(xe||t.getAndEncode).then(function(m){return t.dataAsUrl(m,t.mimeType(R))}).then(function(m){return S.replace(G(R),"$1"+m+"$3")});function G(m){return new RegExp(`(url\\(['"]?)(`+t.escape(m)+`)(['"]?\\))`,"g")}}function _(S,R,Y){if(xe())return Promise.resolve(S);return Promise.resolve(S).then(A).then(function(G){var m=Promise.resolve(S);return G.forEach(function(Q){m=m.then(function(he){return w(he,Q,R,Y)})}),m});function xe(){return!E(S)}}}function v(){return{resolveAll:F,impl:{readAll:E}};function F(){return E().then(function(A){return Promise.all(A.map(function(w){return w.resolve()}))}).then(function(A){return A.join(`
`)})}function E(){return Promise.resolve(t.asArray(document.styleSheets)).then(w).then(A).then(function(S){return S.map(_)});function A(S){return S.filter(function(R){return R.type===CSSRule.FONT_FACE_RULE}).filter(function(R){return r.shouldProcess(R.style.getPropertyValue("src"))})}function w(S){var R=[];return S.forEach(function(Y){try{t.asArray(Y.cssRules||[]).forEach(R.push.bind(R))}catch(xe){console.log("Error while reading CSS rules from "+Y.href,xe.toString())}}),R}function _(S){return{resolve:function(){var Y=(S.parentStyleSheet||{}).href;return r.inlineAll(S.cssText,Y)},src:function(){return S.style.getPropertyValue("src")}}}}}function ae(){return{inlineAll:E,impl:{newImage:F}};function F(A){return{inline:w};function w(_){return t.isDataUrl(A.src)?Promise.resolve():Promise.resolve(A.src).then(_||t.getAndEncode).then(function(S){return t.dataAsUrl(S,t.mimeType(A.src))}).then(function(S){return new Promise(function(R,Y){A.onload=R,A.onerror=Y,A.src=S})})}}function E(A){if(!(A instanceof Element))return Promise.resolve(A);return w(A).then(function(){return A instanceof HTMLImageElement?F(A).inline():Promise.all(t.asArray(A.childNodes).map(function(_){return E(_)}))});function w(_){var S=_.style.getPropertyValue("background");return S?r.inlineAll(S).then(function(R){_.style.setProperty("background",R,_.style.getPropertyPriority("background"))}).then(function(){return _}):Promise.resolve(_)}}}})()})(Yr);var Ci=Yr.exports;const ji=Ir(Ci),sn=({text:n,children:e})=>{const[t,r]=p.useState(!1),{themeMode:i}=De(),o=i==="dark";return s.jsxs("div",{className:"relative inline-block",onMouseEnter:()=>r(!0),onMouseLeave:()=>r(!1),children:[e,t&&s.jsxs("div",{className:`absolute top-full left-1/2 transform -translate-x-1/2 translate-y-1 px-2 py-1 text-xs rounded whitespace-nowrap z-50 mt-1
            ${o?"bg-gray-800 text-gray-200 border border-gray-700":"bg-white text-gray-700 border border-gray-200"} shadow-lg`,children:[n,s.jsx("div",{className:`absolute bottom-full left-1/2 transform -translate-x-1/2 border-4 border-transparent 
              ${o?"border-b-gray-800":"border-b-white"}`})]})]})},Ii=ie.forwardRef(({isOpen:n,onClose:e},t)=>{const{exifSettings:r,toggleExifSetting:i,toggleAllExifSettings:o,showZoomControls:a,toggleShowZoomControls:l,themeMode:h,showExifInfo:u,toggleShowExifInfo:d,borderRadius:g,setBorderRadius:k,gridGap:D,setGridGap:I}=De(),y=h==="dark",[M,P]=ie.useState(n),[N,V]=ie.useState(!1);if(ie.useEffect(()=>{if(n){P(!0),V(!1);const w=requestAnimationFrame(()=>V(!0));return()=>cancelAnimationFrame(w)}else if(M){V(!1);const w=setTimeout(()=>P(!1),320);return()=>{clearTimeout(w)}}},[n,M]),!M)return null;const ee={FileName:"文件名",Resolution:"分辨率",Make:"相机品牌",Model:"相机型号",LensModel:"镜头型号",FocalLength:"焦距",FNumber:"光圈",ExposureTime:"快门速度",ISO:"ISO",DateTimeOriginal:"拍摄时间"},v=["Make","Model","FocalLength","FNumber","ExposureTime","ISO"],ae=["LensModel","FileName","Resolution","DateTimeOriginal"];Object.values(r).every(Boolean);const F=v.every(w=>r[w]),E=ae.every(w=>r[w]),A=(w,_,S)=>{if(w.key==="ArrowUp"||w.key==="ArrowDown"){w.preventDefault();let R=parseFloat(_),Y=_.replace(/[0-9.-]/g,"");Y||(Y="rem"),isNaN(R)&&(R=0),w.key==="ArrowUp"?R+=.1:R=Math.max(0,R-.1),R=Math.round(R*10)/10,S(`${R}${Y}`)}};return dt.createPortal(s.jsxs("div",{ref:t,className:"fixed right-[17rem] top-20 w-[272px] max-w-[90vw] md:max-w-[400px] max-h-[80vh] overflow-y-auto rounded-3xl px-7 py-4 backdrop-blur-lg text-sm shadow-lg shadow-black/10 transition-all duration-300 scrollbar-hide pointer-events-auto select-none z-[2000]",style:{background:"var(--control-bg)",color:"var(--control-text)",border:"1px solid var(--control-border)",opacity:N?1:0,transform:N?"scale(1) translateY(0px)":"scale(0.95) translateY(40px)",transition:"opacity 0.32s cubic-bezier(.4,0,.2,1), transform 0.32s cubic-bezier(.4,0,.2,1)",pointerEvents:M?"auto":"none"},children:[s.jsx("div",{className:"flex justify-between items-center mb-2",children:s.jsx("h3",{className:"text-base font-semibold",style:{color:"var(--control-text)"},children:"显示设置"})}),s.jsxs("div",{className:"flex items-center justify-between mt-1 mb-2",children:[s.jsx("span",{className:"text-sm font-semibold",style:{color:"var(--control-text)"},children:"EXIF信息"}),s.jsxs("label",{className:"relative inline-flex items-center cursor-pointer select-none",children:[s.jsx("input",{type:"checkbox",checked:u,onChange:d,className:"sr-only peer"}),s.jsx("div",{className:"w-11 h-6 rounded-full peer-focus:ring-2 peer-focus:ring-sky-400 peer-focus:ring-opacity-50 transition-colors duration-200",style:{background:u?"var(--control-highlight)":"var(--control-border)"},children:s.jsx("div",{className:"absolute top-0.5 left-0.5 w-5 h-5 rounded-full bg-white shadow-md transition-transform duration-200",style:{transform:u?"translateX(1.25rem)":"translateX(0)"}})})]})]}),u&&s.jsxs("div",{className:"flex flex-row gap-3 mb-2",children:[s.jsxs("div",{className:"flex-1 min-w-[120px]",children:[s.jsxs("div",{className:"flex items-center mb-1",children:[s.jsx("input",{type:"checkbox",checked:F,onChange:()=>{F?v.forEach(w=>{r[w]&&i(w)}):v.forEach(w=>{r[w]||i(w)})},className:"form-checkbox h-3.5 w-3.5 text-sky-500 rounded border-gray-300 focus:ring-sky-500 dark:border-gray-600 dark:bg-gray-700 dark:checked:bg-sky-500 mr-1"}),s.jsx("span",{className:"text-xs text-gray-500 dark:text-gray-300",children:"主要"})]}),s.jsx("div",{className:"space-y-1",children:v.map(w=>s.jsxs("label",{className:"flex items-center space-x-1 cursor-pointer hover:bg-gray-50 dark:hover:bg-gray-800 rounded-md transition-colors",children:[s.jsx("input",{type:"checkbox",checked:r[w],onChange:()=>i(w),className:"form-checkbox h-3.5 w-3.5 text-sky-500 rounded border-gray-300 focus:ring-sky-500 dark:border-gray-600 dark:bg-gray-700 dark:checked:bg-sky-500"}),s.jsx("span",{className:"text-sm text-gray-700 dark:text-gray-100",children:ee[w]||w})]},w))})]}),s.jsxs("div",{className:"flex-1 min-w-[120px]",children:[s.jsxs("div",{className:"flex items-center mb-1",children:[s.jsx("input",{type:"checkbox",checked:E,onChange:()=>{E?ae.forEach(w=>{r[w]&&i(w)}):ae.forEach(w=>{r[w]||i(w)})},className:"form-checkbox h-3.5 w-3.5 text-sky-500 rounded border-gray-300 focus:ring-sky-500 dark:border-gray-600 dark:bg-gray-700 dark:checked:bg-sky-500 mr-1"}),s.jsx("span",{className:"text-xs text-gray-500 dark:text-gray-300",children:"次要"})]}),s.jsx("div",{className:"space-y-1",children:ae.map(w=>s.jsxs("label",{className:"flex items-center space-x-1 cursor-pointer hover:bg-gray-50 dark:hover:bg-gray-800 rounded-md transition-colors",children:[s.jsx("input",{type:"checkbox",checked:r[w],onChange:()=>i(w),className:"form-checkbox h-3.5 w-3.5 text-sky-500 rounded border-gray-300 focus:ring-sky-500 dark:border-gray-600 dark:bg-gray-700 dark:checked:bg-sky-500"}),s.jsx("span",{className:"text-sm text-gray-700 dark:text-gray-100",children:ee[w]||w})]},w))})]})]}),s.jsx("div",{className:"border-t border-gray-200 dark:border-gray-700 my-3"}),s.jsxs("div",{className:"flex items-center justify-between mt-1 mb-2",children:[s.jsx("span",{className:"text-sm font-semibold text-gray-700 dark:text-gray-100",children:"缩放倍数显示"}),s.jsxs("label",{className:"relative inline-flex items-center cursor-pointer select-none",children:[s.jsx("input",{type:"checkbox",checked:a,onChange:l,className:"sr-only peer"}),s.jsx("div",{className:`w-11 h-6 bg-gray-300 dark:bg-gray-800 rounded-full peer-focus:ring-2 peer-focus:ring-sky-400 peer-focus:ring-opacity-50 transition-colors duration-200
             ${a?"bg-sky-500":y?"bg-gray-800":"bg-gray-300"}`,children:s.jsx("div",{className:`absolute top-0.5 left-0.5 w-5 h-5 rounded-full bg-white shadow-md transition-transform duration-200
              ${a?"translate-x-5":"translate-x-0"}`})})]})]}),s.jsx("div",{className:"border-t border-gray-200 dark:border-gray-700 my-3"}),s.jsxs("div",{className:"flex flex-col mt-1 mb-1",children:[s.jsxs("div",{className:"flex items-center justify-between mb-1",children:[s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx("span",{className:"text-sm font-semibold text-gray-700 dark:text-gray-100",children:"圆角大小"}),s.jsx("button",{type:"button",onClick:()=>k("0.5rem"),className:"p-1 rounded-full hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors",title:"恢复默认圆角",tabIndex:-1,style:{lineHeight:0},children:s.jsxs("svg",{width:"15",height:"15",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[s.jsx("polyline",{points:"1 4 1 10 7 10"}),s.jsx("path",{d:"M3.51 15a9 9 0 1 0 2.13-9.36L1 10"})]})})]}),s.jsx("input",{type:"text",value:g,onChange:w=>k(w.target.value),onKeyDown:w=>A(w,g,k),className:`w-20 px-3 py-1 text-sm text-center rounded-full border ${y?"bg-gray-800 border-gray-700 text-gray-100 focus:border-sky-500":"bg-white border-gray-300 text-gray-800 focus:border-sky-500"} focus:outline-none focus:ring-1 focus:ring-sky-500`,placeholder:"0.5rem"})]}),s.jsxs("div",{className:"flex items-center justify-between mb-1",children:[s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx("span",{className:"text-sm font-semibold text-gray-700 dark:text-gray-100",children:"间距大小"}),s.jsx("button",{type:"button",onClick:()=>I("1rem"),className:"p-1 rounded-full hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors",title:"恢复默认间距",tabIndex:-1,style:{lineHeight:0},children:s.jsxs("svg",{width:"15",height:"15",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[s.jsx("polyline",{points:"1 4 1 10 7 10"}),s.jsx("path",{d:"M3.51 15a9 9 0 1 0 2.13-9.36L1 10"})]})})]}),s.jsx("input",{type:"text",value:D,onChange:w=>I(w.target.value),onKeyDown:w=>A(w,D,I),className:`w-20 px-3 py-1 text-sm text-center rounded-full border ${y?"bg-gray-800 border-gray-700 text-gray-100 focus:border-sky-500":"bg-white border-gray-300 text-gray-800 focus:border-sky-500"} focus:outline-none focus:ring-1 focus:ring-sky-500`,placeholder:"1rem"})]}),s.jsx("div",{className:"mt-1 text-xs text-gray-500 dark:text-gray-400",children:"可使用px、rem或百分比"})]})]}),document.body)}),Pi=()=>{const{themeMode:n,toggleDemoMode:e,demoMode:t}=De(),{images:r,addImages:i,clearImages:o}=kt(),[a,l]=p.useState(!1),h=p.useRef(null),[u,d]=p.useState(!1),[g,k]=p.useState(!1),D=p.useRef(null),I=p.useRef(null),y=n==="dark",M=async P=>{if(!P)return;const N=Array.from(P).filter(ee=>ee.type.startsWith("image/"));if(N.length===0)return;o();const V=await Promise.all(N.map(hn));i(V)};return p.useEffect(()=>{if(!g)return;const P=N=>{D.current&&!D.current.contains(N.target)&&I.current&&!I.current.contains(N.target)&&k(!1)};return document.addEventListener("mousedown",P),()=>document.removeEventListener("mousedown",P)},[g]),r.length===0?null:s.jsxs("div",{className:"flex items-center space-x-4 setting-bar",children:[s.jsxs("div",{className:"relative",children:[s.jsx(sn,{text:"显示设置",children:s.jsx("button",{ref:I,onClick:()=>k(P=>!P),className:`p-3 rounded-full backdrop-blur-md transition-all duration-200 font-medium flex items-center
              ${y?"bg-gray-900 hover:bg-gray-800 text-white":"bg-sky-500/10 hover:bg-sky-500/20 text-gray-900"}`,children:s.jsxs("svg",{className:"w-5 h-5",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[s.jsx("circle",{cx:"12",cy:"12",r:"3"}),s.jsx("path",{d:"M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"})]})})}),s.jsx(Ii,{ref:D,isOpen:g,onClose:()=>k(!1)})]}),s.jsx(sn,{text:"演示模式",children:s.jsx("button",{onClick:e,className:`p-3 rounded-full backdrop-blur-md transition-all duration-200 ${t?"bg-sky-600 hover:bg-sky-700 text-white":y?"bg-gray-900 hover:bg-gray-800 text-white":"bg-sky-500/10 hover:bg-sky-500/20 text-gray-900 dark:text-white"} font-medium desktop-only`,children:s.jsx("svg",{className:"w-5 h-5",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:s.jsx("path",{d:"M8 3H5a2 2 0 0 0-2 2v3m18 0V5a2 2 0 0 0-2-2h-3m0 18h3a2 2 0 0 0 2-2v-3M3 16v3a2 2 0 0 0 2 2h3"})})})}),s.jsx("input",{type:"file",multiple:!0,accept:"image/*",className:"hidden",ref:h,onChange:P=>M(P.target.files)}),s.jsx("button",{onClick:()=>{var P;return(P=h.current)==null?void 0:P.click()},className:"px-7 py-3 rounded-full backdrop-blur-md transition-all duration-200 bg-[#2458d0] hover:bg-[#1c46af] text-white font-medium text-sm scale-105",children:"重新导入"}),s.jsxs("div",{className:"relative desktop-only",children:[s.jsx("input",{type:"file",multiple:!0,accept:"image/*",className:"hidden",id:"add-image-input",onChange:async P=>{if(P.target.files){const N=P.target.files,V=Array.from(N).filter(v=>v.type.startsWith("image/"));if(V.length===0)return;const ee=await Promise.all(V.map(hn));i(ee),P.target.value=""}}}),s.jsx(sn,{text:"添加图片",children:s.jsx("button",{onClick:()=>{var P;return(P=document.getElementById("add-image-input"))==null?void 0:P.click()},className:`p-3 rounded-full backdrop-blur-md transition-all duration-200 ${y?"bg-gray-900 hover:bg-gray-800 text-white":"bg-sky-500/10 hover:bg-sky-500/20 text-gray-900"} font-medium`,children:s.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 4v16m8-8H4"})})})})]})]})};var Kr={color:void 0,size:void 0,className:void 0,style:void 0,attr:void 0},br=ie.createContext&&ie.createContext(Kr),qe=function(){return qe=Object.assign||function(n){for(var e,t=1,r=arguments.length;t<r;t++){e=arguments[t];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(n[i]=e[i])}return n},qe.apply(this,arguments)},Ei=function(n,e){var t={};for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&e.indexOf(r)<0&&(t[r]=n[r]);if(n!=null&&typeof Object.getOwnPropertySymbols=="function")for(var i=0,r=Object.getOwnPropertySymbols(n);i<r.length;i++)e.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(n,r[i])&&(t[r[i]]=n[r[i]]);return t};function Jr(n){return n&&n.map(function(e,t){return ie.createElement(e.tag,qe({key:t},e.attr),Jr(e.child))})}function Xt(n){return function(e){return ie.createElement(Ni,qe({attr:qe({},n.attr)},e),Jr(n.child))}}function Ni(n){var e=function(t){var r=n.attr,i=n.size,o=n.title,a=Ei(n,["attr","size","title"]),l=i||t.size||"1em",h;return t.className&&(h=t.className),n.className&&(h=(h?h+" ":"")+n.className),ie.createElement("svg",qe({stroke:"currentColor",fill:"currentColor",strokeWidth:"0"},t.attr,r,a,{className:h,style:qe(qe({color:n.color||t.color},t.style),n.style),height:l,width:l,xmlns:"http://www.w3.org/2000/svg"}),o&&ie.createElement("title",null,o),n.children)};return br!==void 0?ie.createElement(br.Consumer,null,function(t){return e(t)}):e(Kr)}function Mi(n){return Xt({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"path",attr:{d:"M17 3a2.828 2.828 0 1 1 4 4L7.5 20.5 2 22l1.5-5.5L17 3z"}}]})(n)}function Ti(n){return Xt({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"polyline",attr:{points:"5 9 2 12 5 15"}},{tag:"polyline",attr:{points:"9 5 12 2 15 5"}},{tag:"polyline",attr:{points:"15 19 12 22 9 19"}},{tag:"polyline",attr:{points:"19 9 22 12 19 15"}},{tag:"line",attr:{x1:"2",y1:"12",x2:"22",y2:"12"}},{tag:"line",attr:{x1:"12",y1:"2",x2:"12",y2:"22"}}]})(n)}function Ai(n){return Xt({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"polyline",attr:{points:"4 7 4 4 20 4 20 7"}},{tag:"line",attr:{x1:"9",y1:"20",x2:"15",y2:"20"}},{tag:"line",attr:{x1:"12",y1:"4",x2:"12",y2:"20"}}]})(n)}function Di(n){return Xt({attr:{viewBox:"0 0 24 24"},child:[{tag:"path",attr:{fill:"none",d:"M0 0h24v24H0V0z"}},{tag:"path",attr:{d:"M6 19c0 1.1.9 2 2 2h8c1.1 0 2-.9 2-2V7H6v12zM8 9h8v10H8V9zm7.5-5l-1-1h-5l-1 1H5v2h14V4h-3.5z"}}]})(n)}function Yt(){return(Yt=Object.assign||function(n){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(n[r]=t[r])}return n}).apply(this,arguments)}function qr(n,e){if(n==null)return{};var t,r,i={},o=Object.keys(n);for(r=0;r<o.length;r++)e.indexOf(t=o[r])>=0||(i[t]=n[t]);return i}function pn(n){var e=p.useRef(n),t=p.useRef(function(r){e.current&&e.current(r)});return e.current=n,t.current}var Ct=function(n,e,t){return e===void 0&&(e=0),t===void 0&&(t=1),n>t?t:n<e?e:n},vt=function(n){return"touches"in n},gn=function(n){return n&&n.ownerDocument.defaultView||self},vr=function(n,e,t){var r=n.getBoundingClientRect(),i=vt(e)?function(o,a){for(var l=0;l<o.length;l++)if(o[l].identifier===a)return o[l];return o[0]}(e.touches,t):e;return{left:Ct((i.pageX-(r.left+gn(n).pageXOffset))/r.width),top:Ct((i.pageY-(r.top+gn(n).pageYOffset))/r.height)}},wr=function(n){!vt(n)&&n.preventDefault()},Zr=ie.memo(function(n){var e=n.onMove,t=n.onKey,r=qr(n,["onMove","onKey"]),i=p.useRef(null),o=pn(e),a=pn(t),l=p.useRef(null),h=p.useRef(!1),u=p.useMemo(function(){var D=function(M){wr(M),(vt(M)?M.touches.length>0:M.buttons>0)&&i.current?o(vr(i.current,M,l.current)):y(!1)},I=function(){return y(!1)};function y(M){var P=h.current,N=gn(i.current),V=M?N.addEventListener:N.removeEventListener;V(P?"touchmove":"mousemove",D),V(P?"touchend":"mouseup",I)}return[function(M){var P=M.nativeEvent,N=i.current;if(N&&(wr(P),!function(ee,v){return v&&!vt(ee)}(P,h.current)&&N)){if(vt(P)){h.current=!0;var V=P.changedTouches||[];V.length&&(l.current=V[0].identifier)}N.focus(),o(vr(N,P,l.current)),y(!0)}},function(M){var P=M.which||M.keyCode;P<37||P>40||(M.preventDefault(),a({left:P===39?.05:P===37?-.05:0,top:P===40?.05:P===38?-.05:0}))},y]},[a,o]),d=u[0],g=u[1],k=u[2];return p.useEffect(function(){return k},[k]),ie.createElement("div",Yt({},r,{onTouchStart:d,onMouseDown:d,className:"react-colorful__interactive",ref:i,onKeyDown:g,tabIndex:0,role:"slider"}))}),Pn=function(n){return n.filter(Boolean).join(" ")},Qr=function(n){var e=n.color,t=n.left,r=n.top,i=r===void 0?.5:r,o=Pn(["react-colorful__pointer",n.className]);return ie.createElement("div",{className:o,style:{top:100*i+"%",left:100*t+"%"}},ie.createElement("div",{className:"react-colorful__pointer-fill",style:{backgroundColor:e}}))},Ne=function(n,e,t){return e===void 0&&(e=0),t===void 0&&(t=Math.pow(10,e)),Math.round(t*n)/t},Li=function(n){return Ui(mn(n))},mn=function(n){return n[0]==="#"&&(n=n.substring(1)),n.length<6?{r:parseInt(n[0]+n[0],16),g:parseInt(n[1]+n[1],16),b:parseInt(n[2]+n[2],16),a:n.length===4?Ne(parseInt(n[3]+n[3],16)/255,2):1}:{r:parseInt(n.substring(0,2),16),g:parseInt(n.substring(2,4),16),b:parseInt(n.substring(4,6),16),a:n.length===8?Ne(parseInt(n.substring(6,8),16)/255,2):1}},Fi=function(n){return Bi(Oi(n))},Ri=function(n){var e=n.s,t=n.v,r=n.a,i=(200-e)*t/100;return{h:Ne(n.h),s:Ne(i>0&&i<200?e*t/100/(i<=100?i:200-i)*100:0),l:Ne(i/2),a:Ne(r,2)}},xn=function(n){var e=Ri(n);return"hsl("+e.h+", "+e.s+"%, "+e.l+"%)"},Oi=function(n){var e=n.h,t=n.s,r=n.v,i=n.a;e=e/360*6,t/=100,r/=100;var o=Math.floor(e),a=r*(1-t),l=r*(1-(e-o)*t),h=r*(1-(1-e+o)*t),u=o%6;return{r:Ne(255*[r,l,a,a,h,r][u]),g:Ne(255*[h,r,r,l,a,a][u]),b:Ne(255*[a,a,h,r,r,l][u]),a:Ne(i,2)}},Mt=function(n){var e=n.toString(16);return e.length<2?"0"+e:e},Bi=function(n){var e=n.r,t=n.g,r=n.b,i=n.a,o=i<1?Mt(Ne(255*i)):"";return"#"+Mt(e)+Mt(t)+Mt(r)+o},Ui=function(n){var e=n.r,t=n.g,r=n.b,i=n.a,o=Math.max(e,t,r),a=o-Math.min(e,t,r),l=a?o===e?(t-r)/a:o===t?2+(r-e)/a:4+(e-t)/a:0;return{h:Ne(60*(l<0?l+6:l)),s:Ne(o?a/o*100:0),v:Ne(o/255*100),a:i}},$i=ie.memo(function(n){var e=n.hue,t=n.onChange,r=Pn(["react-colorful__hue",n.className]);return ie.createElement("div",{className:r},ie.createElement(Zr,{onMove:function(i){t({h:360*i.left})},onKey:function(i){t({h:Ct(e+360*i.left,0,360)})},"aria-label":"Hue","aria-valuenow":Ne(e),"aria-valuemax":"360","aria-valuemin":"0"},ie.createElement(Qr,{className:"react-colorful__hue-pointer",left:e/360,color:xn({h:e,s:100,v:100,a:1})})))}),zi=ie.memo(function(n){var e=n.hsva,t=n.onChange,r={backgroundColor:xn({h:e.h,s:100,v:100,a:1})};return ie.createElement("div",{className:"react-colorful__saturation",style:r},ie.createElement(Zr,{onMove:function(i){t({s:100*i.left,v:100-100*i.top})},onKey:function(i){t({s:Ct(e.s+100*i.left,0,100),v:Ct(e.v-100*i.top,0,100)})},"aria-label":"Color","aria-valuetext":"Saturation "+Ne(e.s)+"%, Brightness "+Ne(e.v)+"%"},ie.createElement(Qr,{className:"react-colorful__saturation-pointer",top:1-e.v/100,left:e.s/100,color:xn(e)})))}),es=function(n,e){if(n===e)return!0;for(var t in n)if(n[t]!==e[t])return!1;return!0},Wi=function(n,e){return n.toLowerCase()===e.toLowerCase()||es(mn(n),mn(e))};function Hi(n,e,t){var r=pn(t),i=p.useState(function(){return n.toHsva(e)}),o=i[0],a=i[1],l=p.useRef({color:e,hsva:o});p.useEffect(function(){if(!n.equal(e,l.current.color)){var u=n.toHsva(e);l.current={hsva:u,color:e},a(u)}},[e,n]),p.useEffect(function(){var u;es(o,l.current.hsva)||n.equal(u=n.fromHsva(o),l.current.color)||(l.current={hsva:o,color:u},r(u))},[o,n,r]);var h=p.useCallback(function(u){a(function(d){return Object.assign({},d,u)})},[]);return[o,h]}var Vi=typeof window<"u"?p.useLayoutEffect:p.useEffect,_i=function(){return typeof __webpack_nonce__<"u"?__webpack_nonce__:void 0},kr=new Map,Gi=function(n){Vi(function(){var e=n.current?n.current.ownerDocument:document;if(e!==void 0&&!kr.has(e)){var t=e.createElement("style");t.innerHTML=`.react-colorful{position:relative;display:flex;flex-direction:column;width:200px;height:200px;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;cursor:default}.react-colorful__saturation{position:relative;flex-grow:1;border-color:transparent;border-bottom:12px solid #000;border-radius:8px 8px 0 0;background-image:linear-gradient(0deg,#000,transparent),linear-gradient(90deg,#fff,hsla(0,0%,100%,0))}.react-colorful__alpha-gradient,.react-colorful__pointer-fill{content:"";position:absolute;left:0;top:0;right:0;bottom:0;pointer-events:none;border-radius:inherit}.react-colorful__alpha-gradient,.react-colorful__saturation{box-shadow:inset 0 0 0 1px rgba(0,0,0,.05)}.react-colorful__alpha,.react-colorful__hue{position:relative;height:24px}.react-colorful__hue{background:linear-gradient(90deg,red 0,#ff0 17%,#0f0 33%,#0ff 50%,#00f 67%,#f0f 83%,red)}.react-colorful__last-control{border-radius:0 0 8px 8px}.react-colorful__interactive{position:absolute;left:0;top:0;right:0;bottom:0;border-radius:inherit;outline:none;touch-action:none}.react-colorful__pointer{position:absolute;z-index:1;box-sizing:border-box;width:28px;height:28px;transform:translate(-50%,-50%);background-color:#fff;border:2px solid #fff;border-radius:50%;box-shadow:0 2px 4px rgba(0,0,0,.2)}.react-colorful__interactive:focus .react-colorful__pointer{transform:translate(-50%,-50%) scale(1.1)}.react-colorful__alpha,.react-colorful__alpha-pointer{background-color:#fff;background-image:url('data:image/svg+xml;charset=utf-8,<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill-opacity=".05"><path d="M8 0h8v8H8zM0 8h8v8H0z"/></svg>')}.react-colorful__saturation-pointer{z-index:3}.react-colorful__hue-pointer{z-index:2}`,kr.set(e,t);var r=_i();r&&t.setAttribute("nonce",r),e.head.appendChild(t)}},[])},Xi=function(n){var e=n.className,t=n.colorModel,r=n.color,i=r===void 0?t.defaultColor:r,o=n.onChange,a=qr(n,["className","colorModel","color","onChange"]),l=p.useRef(null);Gi(l);var h=Hi(t,i,o),u=h[0],d=h[1],g=Pn(["react-colorful",e]);return ie.createElement("div",Yt({},a,{ref:l,className:g}),ie.createElement(zi,{hsva:u,onChange:d}),ie.createElement($i,{hue:u.h,onChange:d,className:"react-colorful__last-control"}))},Yi={defaultColor:"000",toHsva:Li,fromHsva:function(n){return Fi({h:n.h,s:n.s,v:n.v,a:1})},equal:Wi},Ki=function(n){return ie.createElement(Xi,Yt({},n,{colorModel:Yi}))};const Tt=["#FF3B30","#FFD60A","#2458d0"],Ji=[2,4,8],qi=72,Zi=999,Qi=[14,18,24],eo=[{type:"move",icon:s.jsx(Ti,{size:22,style:{display:"block"}}),label:"移动/选择标注"},{type:"rect",icon:s.jsx("svg",{width:"22",height:"22",viewBox:"0 0 22 22",style:{display:"block"},children:s.jsx("rect",{x:"4",y:"4",width:"14",height:"14",rx:"4",stroke:"currentColor",strokeWidth:"2.2",fill:"none"})}),label:"绘制矩形"},{type:"ellipse",icon:s.jsx("svg",{width:"22",height:"22",viewBox:"0 0 22 22",style:{display:"block"},children:s.jsx("ellipse",{cx:"11",cy:"11",rx:"7",ry:"7",stroke:"currentColor",strokeWidth:"2.2",fill:"none"})}),label:"绘制圆形"},{type:"pen",icon:s.jsx(Mi,{size:22,style:{display:"block"}}),label:"自由绘制"},{type:"text",icon:s.jsx(Ai,{size:22,style:{display:"block"}}),label:"添加文字"}];function Sr(n=28,e=16,t=1,r=1.35){const i=e/2;let o="";for(let a=0;a<=n;a++){const l=a,h=i+r*Math.sin(a/n*t*2*Math.PI);o+=a===0?`M${l},${h}`:` L${l},${h}`}return o}const yt=({text:n,children:e})=>{const[t,r]=p.useState(!1),{themeMode:i}=De();return s.jsxs("div",{className:"relative inline-block",onMouseEnter:()=>r(!0),onMouseLeave:()=>r(!1),children:[e,t&&s.jsxs("div",{className:`absolute top-full left-1/2 transform -translate-x-1/2 translate-y-1 px-2 py-1 text-xs rounded whitespace-nowrap z-50 mt-1
            ${i==="dark"?"bg-gray-800 text-gray-200 border border-gray-700":"bg-white text-gray-700 border border-gray-200"} shadow-lg`,children:[n,s.jsx("div",{className:`absolute bottom-full left-1/2 transform -translate-x-1/2 border-4 border-transparent
              ${i==="dark"?"border-b-gray-800":"border-b-white"}`})]})]})},to=()=>{const{annotationTool:n,setAnnotationTool:e,annotationStrokeWidth:t,setStrokeWidth:r,annotationColor:i,setAnnotationColor:o,annotationToolbar:a,clearAnnotations:l,isAnnotateMode:h,annotations:u,annotationFontSize:d,setAnnotationFontSize:g}=Ie(),[k,D]=p.useState(!1),[I,y]=p.useState("#FF3B30"),M=p.useRef(null),P=p.useRef(null),[N,V]=p.useState(!1),[ee,v]=p.useState(!1),[ae,F]=p.useState({x:0,y:0}),E=p.useRef({x:0,y:0});p.useRef(null);const[A,w]=p.useState({left:0,top:0}),[_,S]=p.useState(!1),R=p.useRef(null),[Y,xe]=p.useState({left:0,top:0}),[G,m]=p.useState(!1),Q=p.useRef(null),[he,O]=p.useState({left:0,top:0}),{themeMode:z}=De();ie.useEffect(()=>{a.visible?(V(!0),setTimeout(()=>{if(M.current){const f=M.current.getBoundingClientRect();F({x:(window.innerWidth-f.width)/2,y:window.innerHeight*.7})}v(!0)},10),o("#FF3B30"),y("#FF3B30"),r(4)):N&&v(!1)},[a.visible]),p.useLayoutEffect(()=>{if(!ee&&N){const f=setTimeout(()=>V(!1),350);return()=>clearTimeout(f)}},[ee,N]);const pe=f=>{if(f.target.closest(".toolbar-btn")||f.button!==0||!M.current)return;const C=M.current.getBoundingClientRect();E.current={x:f.clientX-C.left,y:f.clientY-C.top},window.addEventListener("pointermove",de),window.addEventListener("pointerup",ue)},de=f=>{F({x:f.clientX-E.current.x,y:f.clientY-E.current.y})},ue=()=>{window.removeEventListener("pointermove",de),window.removeEventListener("pointerup",ue)},B={position:"fixed",left:ae.x,top:ae.y,zIndex:1e3,width:"fit-content",height:qi,borderRadius:Zi,background:z==="dark"?"rgba(0, 0, 0, 0.92)":z==="green"||z==="blue"?"rgba(255, 255, 255, 0.25)":"rgba(255,255,255,0.92)",backdropFilter:"blur(16px) saturate(1.5)",boxShadow:z==="dark"?"0 8px 32px rgba(0,0,0,0.38)":"0 8px 32px rgba(0,0,0,0.18)",border:z==="dark"?"1.5px solid rgba(80,80,100,0.18)":"1.5px solid rgba(180,180,200,0.13)",display:"flex",flexDirection:"row",alignItems:"center",justifyContent:"center",gap:0,userSelect:"none",WebkitUserSelect:"none",touchAction:"none",opacity:ee?1:0,pointerEvents:N?"auto":"none",transform:ee?"scale(1) translateY(0px)":"scale(0.95) translateY(40px)",transition:"opacity 0.35s cubic-bezier(.4,0,.2,1), transform 0.35s cubic-bezier(.4,0,.2,1)",padding:"0 36px",boxSizing:"border-box",color:z==="dark"?"#e5e7eb":"#333"};ie.useEffect(()=>{if(k&&P.current){const f=P.current.getBoundingClientRect(),C=220,ye=170,le=100;let ge=f.left+f.width/2-C/2,re=f.top-ye-le;re<le&&(re=f.bottom+le),ge<8&&(ge=8),ge+C>window.innerWidth-8&&(ge=window.innerWidth-C-8),w({left:ge,top:re})}},[k,ae]),ie.useEffect(()=>{if(!k)return;const f=C=>{!C.target.closest(".color-popover")&&!C.target.closest(".toolbar-btn")&&D(!1)};return window.addEventListener("mousedown",f),()=>window.removeEventListener("mousedown",f)},[k]);const J={border:"none",borderRadius:"50%",width:40,height:40,minWidth:40,minHeight:40,maxWidth:40,maxHeight:40,display:"flex",alignItems:"center",justifyContent:"center",fontSize:22,transition:"box-shadow 0.18s, background 0.18s",padding:0,overflow:"hidden",background:"transparent"};if(ie.useEffect(()=>{if(_&&R.current){const f=R.current.getBoundingClientRect(),C=48,ye=140;let le=f.left+f.width/2-C/2,ge=f.top-ye-12;ge<8&&(ge=f.bottom+12),le<8&&(le=8),le+C>window.innerWidth-8&&(le=window.innerWidth-C-8),xe({left:le,top:ge})}if(_){const f=C=>{const ye=document.querySelector(".stroke-menu-popover");ye&&!ye.contains(C.target)&&R.current&&!R.current.contains(C.target)&&S(!1)};return window.addEventListener("mousedown",f),()=>window.removeEventListener("mousedown",f)}},[_,ae]),ie.useEffect(()=>{if(G&&Q.current){const f=Q.current.getBoundingClientRect(),C=48,ye=140;let le=f.left+f.width/2-C/2,ge=f.top-ye-12;ge<8&&(ge=f.bottom+12),le<8&&(le=8),le+C>window.innerWidth-8&&(le=window.innerWidth-C-8),O({left:le,top:ge})}if(G){const f=C=>{const ye=document.querySelector(".font-menu-popover");ye&&!ye.contains(C.target)&&Q.current&&!Q.current.contains(C.target)&&m(!1)};return window.addEventListener("mousedown",f),()=>window.removeEventListener("mousedown",f)}},[G,ae]),!N)return null;const oe=k?dt.createPortal(s.jsxs("div",{className:"color-popover",onPointerDown:f=>f.stopPropagation(),style:{position:"fixed",zIndex:3e3,left:A.left,top:A.top,width:220,background:"rgba(255,255,255,0.98)",borderRadius:18,boxShadow:"0 4px 24px rgba(0,0,0,0.13)",padding:18,display:"flex",flexDirection:"column",alignItems:"center",gap:12,border:"1.5px solid #e0e0e0",opacity:1,pointerEvents:"auto"},onClick:f=>f.stopPropagation(),children:[s.jsx(Ki,{color:I,onChange:f=>{y(f),o(f)},style:{width:180,height:120}}),s.jsx("input",{type:"text",value:I,onChange:f=>{y(f.target.value),o(f.target.value)},style:{width:90,fontSize:15,border:"1px solid #eee",borderRadius:8,padding:"3px 8px",textAlign:"center",marginTop:4},maxLength:9}),s.jsx("button",{style:{marginTop:8,fontSize:13,color:"#888",background:"none",border:"none",cursor:"pointer"},onClick:()=>D(!1),children:"关闭"})]}),document.body):null,ne=G?dt.createPortal(s.jsx("div",{className:"font-menu-popover",onPointerDown:f=>f.stopPropagation(),style:{position:"fixed",zIndex:3e3,left:he.left,top:he.top,width:48,background:"rgba(255,255,255,0.98)",borderRadius:25,boxShadow:"0 4px 24px rgba(0,0,0,0.13)",padding:10,display:"flex",flexDirection:"column",alignItems:"center",gap:12,border:"1.5px solid #e0e0e0",opacity:1,pointerEvents:"auto"},children:Qi.map(f=>s.jsx("button",{onClick:()=>{g(f),m(!1)},style:{width:32,height:32,borderRadius:"50%",border:"none",background:d===f?"#e6f0ff":"transparent",display:"flex",alignItems:"center",justifyContent:"center",boxShadow:"none",margin:0,padding:0,cursor:"pointer",fontSize:f,color:d===f?"#2458d0":"#333"},title:`字体${f}`,onMouseEnter:C=>C.currentTarget.style.boxShadow="0 0 0 3px #2458d066",onMouseLeave:C=>C.currentTarget.style.boxShadow=d===f?"0 0 0 3px #2458d066":"none",onFocus:C=>C.currentTarget.style.boxShadow="0 0 0 3px #2458d066",onBlur:C=>C.currentTarget.style.boxShadow=d===f?"0 0 0 3px #2458d066":"none",children:"T"},f))}),document.body):null;return s.jsxs("div",{ref:M,style:B,className:"annotation-toolbar",onPointerDown:pe,children:[s.jsxs("div",{style:{display:"flex",alignItems:"center",width:"100%"},children:[s.jsx("div",{style:{display:"flex",gap:12},children:eo.map(f=>s.jsx(yt,{text:f.label,children:s.jsx("button",{className:"toolbar-btn",ref:f.type==="text"?Q:void 0,onClick:()=>{e(f.type),f.type==="text"?m(C=>!C):m(!1)},style:{...J,background:n===f.type?"#e6f0ff":"transparent",color:n===f.type?z==="dark"?"#60a5fa":"#2458d0":z==="dark"?"#e5e7eb":"#333",boxShadow:n===f.type?"0 0 0 3px #2458d066":void 0},onMouseEnter:C=>C.currentTarget.style.boxShadow=n===f.type?"0 0 0 3px #2458d066":"0 0 0 3px #2458d033",onMouseLeave:C=>C.currentTarget.style.boxShadow=n===f.type?"0 0 0 3px #2458d066":"none",onFocus:C=>C.currentTarget.style.boxShadow=n===f.type?"0 0 0 3px #2458d066":"0 0 0 3px #2458d033",onBlur:C=>C.currentTarget.style.boxShadow=n===f.type?"0 0 0 3px #2458d066":"none",children:s.jsx("span",{style:{width:"100%",height:"100%",display:"flex",alignItems:"center",justifyContent:"center"},children:f.icon})})},f.type))}),s.jsx("div",{className:"annotation-toolbar-divider",style:{height:36,width:1.5,background:z==="dark"?"rgba(120,120,140,0.28)":"rgba(120,120,140,0.18)",margin:"0 16px"}}),s.jsxs("div",{style:{display:"flex",gap:12},children:[s.jsx(yt,{text:"线宽",children:s.jsx("button",{ref:R,className:"toolbar-btn",onClick:()=>S(f=>!f),style:{...J,background:"transparent",boxShadow:_?"0 0 0 3px #2458d066":"none",outline:"none",position:"relative",display:"flex",alignItems:"center",justifyContent:"center",padding:0,overflow:"hidden",color:z==="dark"?"#e5e7eb":"#333"},onMouseEnter:f=>{const C=f.currentTarget.querySelector("path");C&&C.setAttribute("stroke",t?z==="dark"?"#60a5fa":"#2458d0":z==="dark"?"#e5e7eb":"#333")},onMouseLeave:f=>{const C=f.currentTarget.querySelector("path");C&&C.setAttribute("stroke",t?z==="dark"?"#60a5fa":"#2458d0":z==="dark"?"#e5e7eb":"#333")},onFocus:f=>{const C=f.currentTarget.querySelector("path");C&&C.setAttribute("stroke",t?z==="dark"?"#60a5fa":"#2458d0":z==="dark"?"#e5e7eb":"#333")},onBlur:f=>{const C=f.currentTarget.querySelector("path");C&&C.setAttribute("stroke",t?z==="dark"?"#60a5fa":"#2458d0":z==="dark"?"#e5e7eb":"#333")},children:s.jsx("span",{style:{width:"100%",height:"100%",display:"flex",alignItems:"center",justifyContent:"center"},children:s.jsx("svg",{width:"28",height:t+16,viewBox:`0 0 28 ${t+16}`,style:{display:"block"},children:s.jsx("path",{d:Sr(28,t+16,1,1.35),stroke:z==="dark"?"#e5e7eb":"#333",strokeWidth:t,fill:"none",strokeLinecap:"round"})})})})}),_&&dt.createPortal(s.jsx("div",{className:"stroke-menu-popover",onPointerDown:f=>f.stopPropagation(),style:{position:"fixed",zIndex:3e3,left:Y.left,top:Y.top,width:48,background:z==="dark"?"rgba(24, 26, 32, 0.98)":"rgba(255,255,255,0.98)",borderRadius:25,boxShadow:z==="dark"?"0 4px 24px rgba(0,0,0,0.38)":"0 4px 24px rgba(0,0,0,0.13)",padding:10,display:"flex",flexDirection:"column",alignItems:"center",gap:12,border:z==="dark"?"1.5px solid rgba(80,80,100,0.18)":"1.5px solid #e0e0e0",opacity:1,pointerEvents:"auto"},children:Ji.map(f=>s.jsx("button",{onClick:()=>{r(f),S(!1)},style:{width:32,height:32,borderRadius:"50%",border:"none",background:t===f?"#e6f0ff":"transparent",display:"flex",alignItems:"center",justifyContent:"center",boxShadow:"none",margin:0,padding:0,cursor:"pointer"},title:`粗细${f}`,onMouseEnter:C=>C.currentTarget.style.boxShadow="0 0 0 3px #2458d066",onMouseLeave:C=>C.currentTarget.style.boxShadow=t===f?"0 0 0 3px #2458d066":"none",onFocus:C=>C.currentTarget.style.boxShadow="0 0 0 3px #2458d066",onBlur:C=>C.currentTarget.style.boxShadow=t===f?"0 0 0 3px #2458d066":"none",children:s.jsx("svg",{width:"28",height:f+16,viewBox:`0 0 28 ${f+16}`,style:{display:"block"},children:s.jsx("path",{d:Sr(28,f+16,1,1.35),stroke:t===f?z==="dark"?"#60a5fa":"#2458d0":z==="dark"?"#e5e7eb":"#333",strokeWidth:f,fill:"none",strokeLinecap:"round"})})},f))}),document.body)]}),s.jsx("div",{className:"annotation-toolbar-divider",style:{height:36,width:1.5,background:z==="dark"?"rgba(120,120,140,0.28)":"rgba(120,120,140,0.18)",margin:"0 16px"}}),s.jsxs("div",{style:{display:"flex",gap:12},children:[Tt.map(f=>s.jsx(yt,{text:f,children:s.jsx("button",{className:"toolbar-btn",onClick:()=>o(f),style:{...J,background:z==="dark"?"#23272f":"#fff",boxShadow:i===f?"0 0 0 3px #2458d066":void 0,border:"none",outline:"none",position:"relative",display:"flex",alignItems:"center",justifyContent:"center",padding:0,overflow:"hidden"},onMouseEnter:C=>C.currentTarget.style.boxShadow=i===f?"0 0 0 3px #2458d066":"0 0 0 3px #2458d033",onMouseLeave:C=>C.currentTarget.style.boxShadow=i===f?"0 0 0 3px #2458d066":"none",onFocus:C=>C.currentTarget.style.boxShadow=i===f?"0 0 0 3px #2458d066":"0 0 0 3px #2458d033",onBlur:C=>C.currentTarget.style.boxShadow=i===f?"0 0 0 3px #2458d066":"none",children:s.jsx("span",{style:{width:"100%",height:"100%",display:"flex",alignItems:"center",justifyContent:"center"},children:s.jsx("span",{style:{display:"block",width:25,height:25,borderRadius:"50%",background:f}})})})},f)),s.jsx(yt,{text:"更多颜色",children:s.jsx("button",{ref:P,className:"toolbar-btn",style:{...J,background:z==="dark"?"#23272f":"#fff",boxShadow:!Tt.includes(i)&&I===i||k?"0 0 0 3px #2458d066":"none",outline:"none",position:"relative",display:"flex",alignItems:"center",justifyContent:"center",padding:0,overflow:"hidden"},onClick:()=>D(f=>!f),onMouseEnter:f=>f.currentTarget.style.boxShadow="0 0 0 3px #2458d066",onMouseLeave:f=>f.currentTarget.style.boxShadow=!Tt.includes(i)&&I===i||k?"0 0 0 3px #2458d066":"none",onFocus:f=>f.currentTarget.style.boxShadow="0 0 0 3px #2458d066",onBlur:f=>f.currentTarget.style.boxShadow=!Tt.includes(i)&&I===i||k?"0 0 0 3px #2458d066":"none",children:s.jsxs("span",{style:{width:"100%",height:"100%",display:"flex",alignItems:"center",justifyContent:"center",position:"relative"},children:[s.jsxs("svg",{width:"30",height:"30",viewBox:"0 0 30 30",fill:"none",xmlns:"http://www.w3.org/2000/svg",style:{display:"block",margin:"auto"},children:[s.jsx("circle",{cx:"15",cy:"15",r:"13",stroke:"#bbb",strokeWidth:"3",fill:"none"}),s.jsx("path",{d:"M15 2 A13 13 0 0 1 28 15",stroke:"#FF3B30",strokeWidth:"4",fill:"none"}),s.jsx("path",{d:"M28 15 A13 13 0 0 1 15 28",stroke:"#FFD60A",strokeWidth:"4",fill:"none"}),s.jsx("path",{d:"M15 28 A13 13 0 0 1 2 15",stroke:"#007AFF",strokeWidth:"4",fill:"none"}),s.jsx("path",{d:"M2 15 A13 13 0 0 1 15 2",stroke:"#34C759",strokeWidth:"4",fill:"none"})]}),s.jsx("span",{style:{position:"absolute",left:"50%",top:"50%",transform:"translate(-50%,-50%)",width:20,height:20,borderRadius:"50%",background:I,border:"1.5px solid #eee",boxShadow:"0 0 2px #007AFF44",display:"flex",alignItems:"center",justifyContent:"center"}})]})})})]}),s.jsx("div",{className:"annotation-toolbar-divider",style:{height:36,width:1.5,background:z==="dark"?"rgba(120,120,140,0.28)":"rgba(120,120,140,0.18)",margin:"0 16px"}}),s.jsx("div",{style:{display:"flex",gap:0},children:s.jsx(yt,{text:"清空所有标注",children:s.jsx("button",{className:"toolbar-btn",onClick:()=>{Object.keys(u).forEach(f=>l(f))},style:{...J,background:z==="dark"?"#23272f":"#fff",color:"#FF3B30",boxShadow:"none"},onMouseEnter:f=>f.currentTarget.style.boxShadow="0 0 0 3px #FF3B3066",onMouseLeave:f=>f.currentTarget.style.boxShadow="none",onFocus:f=>f.currentTarget.style.boxShadow="0 0 0 3px #FF3B3066",onBlur:f=>f.currentTarget.style.boxShadow="none",children:s.jsx("span",{style:{width:"100%",height:"100%",display:"flex",alignItems:"center",justifyContent:"center"},children:s.jsx(Di,{size:22,style:{display:"block",margin:"auto"}})})})})})]}),oe,ne]})},Cr=72,no=999,ro=()=>{var Y,xe;const{keyframes:n,currentIdx:e,setCurrentIdx:t,playing:r,setPlaying:i,enabled:o,frameDuration:a,transitionDuration:l,transitionEasing:h,setFrameDuration:u,setTransitionDuration:d,setTransitionEasing:g}=yn(),{themeMode:k}=De(),[D,I]=p.useState(!1),[y,M]=p.useState(!1),[P,N]=p.useState(null),V=p.useRef(null),ee=p.useRef({x:0,y:0}),[v,ae]=p.useState(!1),F=p.useRef(null);p.useEffect(()=>{o?(I(!0),setTimeout(()=>{if(V.current&&!P){const G=V.current.getBoundingClientRect();N({x:(window.innerWidth-G.width)/2,y:window.innerHeight*.7})}M(!0)},10)):D&&M(!1)},[o]),p.useEffect(()=>{if(!y&&D){const G=setTimeout(()=>I(!1),350);return()=>clearTimeout(G)}},[y,D]);const E=G=>{if(G.target.closest("button")||G.button!==0||!V.current)return;const m=V.current.getBoundingClientRect();ee.current={x:G.clientX-m.left,y:G.clientY-m.top},window.addEventListener("pointermove",A),window.addEventListener("pointerup",w)},A=G=>{N(m=>m&&{x:G.clientX-ee.current.x,y:G.clientY-ee.current.y})},w=()=>{window.removeEventListener("pointermove",A),window.removeEventListener("pointerup",w)},_=()=>{var G;return P?P.x:(window.innerWidth-(((G=V.current)==null?void 0:G.offsetWidth)||0))/2},S=()=>P?P.y:window.innerHeight*.7;if(p.useEffect(()=>{if(!v)return;const G=m=>{F.current&&!F.current.contains(m.target)&&V.current&&!V.current.contains(m.target)&&ae(!1)};return document.addEventListener("mousedown",G),()=>document.removeEventListener("mousedown",G)},[v]),p.useEffect(()=>{l!==1e3&&d(1e3)},[]),!D)return null;const R={position:"fixed",left:_(),top:S(),zIndex:1e3,width:"fit-content",height:Cr,borderRadius:no,background:k==="dark"?"rgba(0, 0, 0, 0.92)":k==="green"||k==="blue"?"rgba(255, 255, 255, 0.25)":"rgba(255,255,255,0.92)",backdropFilter:"blur(16px) saturate(1.5)",boxShadow:k==="dark"?"0 8px 32px rgba(0,0,0,0.38)":"0 8px 32px rgba(0,0,0,0.18)",border:k==="dark"?"1.5px solid rgba(80,80,100,0.18)":"1.5px solid rgba(180,180,200,0.13)",display:"flex",flexDirection:"row",alignItems:"center",justifyContent:"center",gap:0,userSelect:"none",WebkitUserSelect:"none",touchAction:"none",opacity:y?1:0,pointerEvents:D?"auto":"none",transform:y?"scale(1) translateY(0px)":"scale(0.95) translateY(40px)",transition:"opacity 0.35s cubic-bezier(.4,0,.2,1), transform 0.35s cubic-bezier(.4,0,.2,1)",padding:"0 36px",boxSizing:"border-box",color:k==="dark"?"#e5e7eb":"#333",cursor:"default"};return s.jsxs(s.Fragment,{children:[s.jsxs("div",{ref:V,className:"keyframe-panel floating-toolbar-panel",style:R,onPointerDown:E,children:[s.jsx("button",{onClick:()=>i(!r),style:{width:40,height:40,borderRadius:"50%",border:"none",background:r?"#e6f0ff":"#fff",color:r?"#2458d0":"#333",display:"flex",alignItems:"center",justifyContent:"center",fontSize:22,boxShadow:r?"0 0 0 3px #2458d066":void 0,cursor:"pointer",marginRight:24},title:r?"暂停（空格）":"播放（空格）",children:r?s.jsxs("svg",{width:"22",height:"22",viewBox:"0 0 22 22",children:[s.jsx("rect",{x:"5",y:"4",width:"4",height:"14",rx:"2",fill:"currentColor"}),s.jsx("rect",{x:"13",y:"4",width:"4",height:"14",rx:"2",fill:"currentColor"})]}):s.jsx("svg",{width:"22",height:"22",viewBox:"0 0 22 22",children:s.jsx("polygon",{points:"6,4 18,11 6,18",fill:"currentColor"})})}),s.jsx("button",{onClick:()=>ae(G=>!G),style:{width:36,height:36,borderRadius:"50%",border:"none",background:"#f4f4f4",color:"#888",display:"flex",alignItems:"center",justifyContent:"center",fontSize:18,marginRight:18,cursor:"pointer"},title:"关键帧动画设置",children:s.jsxs("svg",{width:"20",height:"20",viewBox:"0 0 20 20",fill:"none",children:[s.jsx("circle",{cx:"10",cy:"10",r:"8",stroke:"currentColor",strokeWidth:"2"}),s.jsx("path",{d:"M10 6v4l2 2",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round"})]})}),s.jsx("div",{style:{display:"flex",gap:18},children:n.map((G,m)=>s.jsx("button",{onClick:()=>{t(m),r&&i(!1)},style:{width:40,height:40,borderRadius:"50%",border:"none",background:e===m?"#e6f0ff":"#fff",color:e===m?"#2458d0":"#333",display:"flex",alignItems:"center",justifyContent:"center",fontSize:18,boxShadow:e===m?"0 0 0 3px #2458d066":void 0,cursor:"pointer",position:"relative"},title:`关键帧${m+1}（${m+1}）`,children:m+1},m))})]}),D&&s.jsx("div",{style:{position:"fixed",left:_()+(((Y=V.current)==null?void 0:Y.offsetWidth)||0)/2,top:S()+Cr+8,transform:"translateX(-50%)",zIndex:1100,minWidth:180,textAlign:"center",fontSize:12,color:"#888",fontWeight:400,letterSpacing:.2,userSelect:"none",pointerEvents:"none"},className:"keyframe-hint",children:"快捷键：1-5切换，空格播放/暂停"}),v&&s.jsxs("div",{ref:F,className:"fixed min-w-[260px] max-w-[90vw] md:max-w-[400px] max-h-[80vh] overflow-y-auto rounded-3xl px-7 py-4 backdrop-blur-lg text-sm shadow-lg shadow-black/10 transition-all duration-300 scrollbar-hide pointer-events-auto select-none z-[2000] border",style:{left:_()+(((xe=V.current)==null?void 0:xe.offsetWidth)||0)/2,top:S()-16,transform:"translate(-50%, -100%)",background:k==="dark"?"rgba(0, 0, 0, 0.92)":k==="green"||k==="blue"?"rgba(255, 255, 255, 0.25)":"rgba(255,255,255,0.92)",color:k==="dark"?"#e5e7eb":"#333",borderColor:k==="dark"?"rgba(80,80,100,0.18)":"rgba(180,180,200,0.13)"},onClick:G=>G.stopPropagation(),children:[s.jsxs("div",{style:{marginBottom:20},children:[s.jsx("div",{style:{fontWeight:500,marginBottom:10},children:"每帧停留时间"}),s.jsxs("div",{style:{display:"flex",gap:12},children:[s.jsx("button",{type:"button",onClick:()=>u(1e3),className:`font-medium border transition-all duration-200 focus:outline-none ${a===1e3?"bg-sky-500 text-white border-sky-500 shadow":"bg-gray-100 text-gray-700 border-gray-200 hover:bg-sky-100"}`,style:{width:"100px",height:"36px",borderRadius:"18px",whiteSpace:"nowrap",display:"flex",alignItems:"center",justifyContent:"center"},children:"短（1秒）"}),s.jsx("button",{type:"button",onClick:()=>u(3e3),className:`font-medium border transition-all duration-200 focus:outline-none ${a===3e3?"bg-sky-500 text-white border-sky-500 shadow":"bg-gray-100 text-gray-700 border-gray-200 hover:bg-sky-100"}`,style:{width:"100px",height:"36px",borderRadius:"18px",whiteSpace:"nowrap",display:"flex",alignItems:"center",justifyContent:"center"},children:"中（3秒）"}),s.jsx("button",{type:"button",onClick:()=>u(5e3),className:`font-medium border transition-all duration-200 focus:outline-none ${a===5e3?"bg-sky-500 text-white border-sky-500 shadow":"bg-gray-100 text-gray-700 border-gray-200 hover:bg-sky-100"}`,style:{width:"100px",height:"36px",borderRadius:"18px",whiteSpace:"nowrap",display:"flex",alignItems:"center",justifyContent:"center"},children:"长（5秒）"})]})]}),s.jsxs("div",{style:{marginBottom:12},children:[s.jsx("div",{style:{fontWeight:500,marginBottom:10},children:"过渡时间"}),s.jsxs("div",{style:{display:"flex",gap:12},children:[s.jsx("button",{type:"button",onClick:()=>d(500),className:`font-medium border transition-all duration-200 focus:outline-none ${l===500?"bg-sky-500 text-white border-sky-500 shadow":"bg-gray-100 text-gray-700 border-gray-200 hover:bg-sky-100"}`,style:{width:"100px",height:"36px",borderRadius:"18px",whiteSpace:"nowrap",display:"flex",alignItems:"center",justifyContent:"center"},children:"快（0.5秒）"}),s.jsx("button",{type:"button",onClick:()=>d(1e3),className:`font-medium border transition-all duration-200 focus:outline-none ${l===1e3?"bg-sky-500 text-white border-sky-500 shadow":"bg-gray-100 text-gray-700 border-gray-200 hover:bg-sky-100"}`,style:{width:"100px",height:"36px",borderRadius:"18px",whiteSpace:"nowrap",display:"flex",alignItems:"center",justifyContent:"center"},children:"正常（1秒）"}),s.jsx("button",{type:"button",onClick:()=>d(3e3),className:`font-medium border transition-all duration-200 focus:outline-none ${l===3e3?"bg-sky-500 text-white border-sky-500 shadow":"bg-gray-100 text-gray-700 border-gray-200 hover:bg-sky-100"}`,style:{width:"100px",height:"36px",borderRadius:"18px",whiteSpace:"nowrap",display:"flex",alignItems:"center",justifyContent:"center"},children:"慢（3秒）"})]})]})]})]})},jr=({text:n,children:e})=>{const[t,r]=p.useState(!1),{themeMode:i}=De(),o=i==="dark";return s.jsxs("div",{className:"relative inline-block",onMouseEnter:()=>r(!0),onMouseLeave:()=>r(!1),children:[e,t&&s.jsxs("div",{className:`absolute top-full left-1/2 transform -translate-x-1/2 translate-y-1 px-2 py-1 text-xs rounded whitespace-nowrap z-50 mt-1
            ${o?"bg-gray-800 text-gray-200 border border-gray-700":"bg-white text-gray-700 border border-gray-200"} shadow-lg`,children:[n,s.jsx("div",{className:`absolute bottom-full left-1/2 transform -translate-x-1/2 border-4 border-transparent 
              ${o?"border-b-gray-800":"border-b-white"}`})]})]})},so=({isOpen:n,onClose:e,themeMode:t,setThemeMode:r,syncZoom:i,toggleSyncZoom:o,images:a})=>s.jsxs(s.Fragment,{children:[s.jsx("div",{className:`fixed inset-0 bg-black/50 z-40 transition-opacity ${n?"opacity-100":"opacity-0 pointer-events-none"}`,onClick:e}),s.jsxs("div",{className:`fixed top-0 left-0 bottom-0 w-64 z-50 p-4 transform transition-transform ${n?"translate-x-0":"-translate-x-full"} overflow-y-auto`,style:{background:"var(--control-bg)",color:"var(--control-text)"},children:[s.jsxs("div",{className:"flex justify-between items-center mb-4",children:[s.jsx("h2",{className:"text-xl font-semibold",style:{color:"var(--control-text)"},children:"设置"}),s.jsx("button",{onClick:e,className:"p-2 rounded-full hover:bg-gray-200 dark:hover:bg-gray-800",style:{color:"var(--control-text)"},children:s.jsx("svg",{className:"w-5 h-5",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:s.jsx("path",{d:"M6 18L18 6M6 6l12 12",strokeLinecap:"round",strokeLinejoin:"round"})})})]}),s.jsxs("div",{className:"space-y-4",children:[s.jsxs("div",{className:"mb-4",children:[s.jsx("h3",{className:"text-lg font-medium mb-2",style:{color:"var(--control-text)"},children:"主题设置"}),s.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[s.jsx("button",{onClick:()=>r("light"),className:`p-3 rounded-lg flex items-center justify-center ${t==="light"?"ring-2 ring-sky-500":"border"}`,style:{background:"#f9fafb",borderColor:"var(--control-border)"},children:s.jsxs("div",{className:"flex items-center",children:[s.jsx("div",{className:"w-5 h-5 rounded-full flex items-center justify-center bg-white mr-2",children:s.jsxs("svg",{className:"w-3 h-3",viewBox:"0 0 24 24",fill:"none",stroke:"#4b5563",strokeWidth:"2",children:[s.jsx("circle",{cx:"12",cy:"12",r:"5"}),s.jsx("path",{d:"M12 1v2M12 21v2M4.22 4.22l1.42 1.42M18.36 18.36l1.42 1.42M1 12h2M21 12h2M4.22 19.78l1.42-1.42M18.36 5.64l1.42-1.42"})]})}),s.jsx("span",{style:{color:"#4b5563"},children:"浅色模式"})]})}),s.jsx("button",{onClick:()=>r("dark"),className:`p-3 rounded-lg flex items-center justify-center ${t==="dark"?"ring-2 ring-sky-500":"border"}`,style:{background:"#111827",borderColor:"var(--control-border)"},children:s.jsxs("div",{className:"flex items-center",children:[s.jsx("div",{className:"w-5 h-5 rounded-full flex items-center justify-center bg-gray-800 mr-2",children:s.jsx("svg",{className:"w-3 h-3",viewBox:"0 0 24 24",fill:"none",stroke:"#d1d5db",strokeWidth:"2",children:s.jsx("path",{d:"M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"})})}),s.jsx("span",{style:{color:"#d1d5db"},children:"深色模式"})]})}),s.jsx("button",{onClick:()=>r("green"),className:`p-3 rounded-lg flex items-center justify-center ${t==="green"?"ring-2 ring-sky-500":"border"}`,style:{background:"#00291d",borderColor:"var(--control-border)"},children:s.jsxs("div",{className:"flex items-center",children:[s.jsx("div",{className:"w-5 h-5 rounded-full mr-2",style:{background:"#00b140"}}),s.jsx("span",{style:{color:"#b4e6d2"},children:"绿幕模式"})]})}),s.jsx("button",{onClick:()=>r("blue"),className:`p-3 rounded-lg flex items-center justify-center ${t==="blue"?"ring-2 ring-sky-500":"border"}`,style:{background:"#001e3c",borderColor:"var(--control-border)"},children:s.jsxs("div",{className:"flex items-center",children:[s.jsx("div",{className:"w-5 h-5 rounded-full mr-2",style:{background:"#0047AB"}}),s.jsx("span",{style:{color:"#b9d4f0"},children:"蓝幕模式"})]})})]})]}),s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsx("span",{style:{color:"var(--control-text)"},children:"同步缩放"}),s.jsxs("label",{className:"inline-flex items-center",children:[s.jsx("input",{type:"checkbox",checked:i,onChange:o,className:"sr-only peer"}),s.jsx("div",{className:`relative w-11 h-6 rounded-full transition-all duration-200 
                  cursor-pointer
                  after:content-[''] after:absolute after:top-0.5 after:left-0.5 
                  after:bg-white after:rounded-full after:h-5 after:w-5 
                  after:shadow-md after:transition-all`,style:{background:i?"var(--control-highlight)":"var(--control-border)",transform:i?"translateX(1.25rem)":"translateX(0)"}})]})]})]})]})]}),io=()=>{const{themeMode:n,setThemeMode:e,syncZoom:t,toggleSyncZoom:r,demoMode:i,toggleDemoMode:o}=De(),{images:a,hasViewedImages:l}=kt(),{isAnnotateMode:h,setAnnotateMode:u,setToolbarVisible:d}=Ie(),{enabled:g,setEnabled:k}=yn(),[D,I]=p.useState(!1),[y,M]=p.useState(!1),[P,N]=p.useState(!1),[V,ee]=p.useState(!1),[v,ae]=p.useState(!1),F=p.useRef(null),E=p.useRef(null),[A,w]=p.useState({top:0,left:0}),[_,S]=p.useState(!1),[R,Y]=p.useState(!1);p.useEffect(()=>{if(v){S(!0),Y(!1);const O=requestAnimationFrame(()=>Y(!0));return()=>cancelAnimationFrame(O)}else if(_){Y(!1);const O=setTimeout(()=>S(!1),320);return()=>clearTimeout(O)}},[v,_]),p.useLayoutEffect(()=>{if(v&&F.current){const O=F.current.getBoundingClientRect();w({top:O.bottom+8,left:O.right})}},[v]);const[xe,G]=p.useState(!1),m=async()=>{try{G(!0),document.body.classList.add("demo-mode-active"),await new Promise(ne=>setTimeout(ne,300));const O=document.querySelector("main");if(!O)throw new Error("找不到主要内容区域");const z=await ji.toBlob(O,{quality:.95,bgcolor:n==="dark"?"#000000":"#f9fafb",height:O.scrollHeight,width:O.scrollWidth,style:{transform:"none","transform-origin":"center",zoom:"1"}});let pe=[];a.length>0&&a.forEach(ne=>{var ye,le;const f=((ye=ne.exif)==null?void 0:ye.Make)||"",C=((le=ne.exif)==null?void 0:le.Model)||"";(f||C)&&pe.push((f+" "+C).trim().replace(/\s+/g,"+"))});let de=pe.join("_VS_");const ue=new Date,B=ue.getFullYear()+("0"+(ue.getMonth()+1)).slice(-2)+("0"+ue.getDate()).slice(-2)+"_"+("0"+ue.getHours()).slice(-2)+("0"+ue.getMinutes()).slice(-2)+("0"+ue.getSeconds()).slice(-2);de?de+="_"+B+".png":de="Screenshot_"+B+".png";const J=URL.createObjectURL(z),oe=document.createElement("a");oe.href=J,oe.download=de,oe.click(),URL.revokeObjectURL(J),document.body.classList.remove("demo-mode-active"),G(!1)}catch(O){console.error("截图失败:",O),document.body.classList.remove("demo-mode-active"),G(!1),alert("截图失败，请重试")}},Q=n==="dark";p.useEffect(()=>{const O=z=>{E.current&&!E.current.contains(z.target)&&F.current&&!F.current.contains(z.target)&&ae(!1)};return v&&document.addEventListener("mousedown",O),()=>{document.removeEventListener("mousedown",O)}},[v]),p.useEffect(()=>{document.documentElement.classList.remove("dark-theme","light-theme","green-theme","blue-theme"),document.documentElement.classList.remove("dark","dark-mode"),document.documentElement.classList.add(`${n}-theme`),Q&&(document.documentElement.classList.add("dark"),document.documentElement.classList.add("dark-mode"))},[n,Q]),p.useEffect(()=>{const O=()=>{!document.fullscreenElement&&i&&o()};return document.addEventListener("fullscreenchange",O),()=>{document.removeEventListener("fullscreenchange",O)}},[i,o]),p.useEffect(()=>{if(i){document.body.classList.add("demo-mode-active"),document.documentElement.requestFullscreen().catch(()=>{o()}),I(!0);const O=setTimeout(()=>{I(!1)},3e3);return()=>{clearTimeout(O),document.body.classList.remove("demo-mode-active")}}else document.body.classList.remove("demo-mode-active"),I(!1),document.fullscreenElement&&document.exitFullscreen().catch(()=>{console.error("退出全屏失败")})},[i,o]),p.useEffect(()=>{d(h)},[h,d]),p.useEffect(()=>{g&&h&&u(!1)},[g]),p.useEffect(()=>{h&&g&&k(!1)},[h]);const he=g&&!i;return s.jsx("div",{className:"h-screen overflow-hidden",style:{background:"var(--bg-primary)",color:"var(--text-primary)"},children:s.jsxs("div",{className:"flex flex-col h-full",children:[s.jsxs("div",{className:"fixed top-0 left-0 right-0 h-16 z-50 px-6 flex items-center justify-between backdrop-blur-md app-header",style:{background:n==="green"||n==="blue"?"var(--control-bg)":"var(--bg-secondary)",borderBottom:"1px solid var(--border-color)"},children:[s.jsxs("div",{className:"flex items-center space-x-4",children:[s.jsx("button",{className:"menu-button mr-2 p-2 rounded-full hover:bg-gray-200/50 dark:hover:bg-gray-800/50 hidden",onClick:()=>ee(!0),style:{color:"var(--control-text)"},children:s.jsx("svg",{className:"w-5 h-5",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:s.jsx("path",{d:"M4 6h16M4 12h16M4 18h16",strokeLinecap:"round",strokeLinejoin:"round"})})}),s.jsxs("div",{className:"flex items-center",children:[s.jsx("h1",{className:"text-xl font-semibold",style:{color:"var(--control-text)"},children:"ComparePhotos"}),s.jsx("button",{onClick:()=>N(!0),className:"ml-2 w-6 h-6 rounded-full flex items-center justify-center transition-colors",style:{background:"var(--control-border)",color:"var(--control-text)"},title:"关于",children:s.jsx("svg",{className:"w-3.5 h-3.5",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M13 16h-1v-4h-1m1-4h.01M12 2a10 10 0 110 20 10 10 0 010-20z"})})})]}),a.length>0&&s.jsxs(s.Fragment,{children:[s.jsxs("div",{className:"px-4 py-1.5 rounded-full backdrop-blur-md transition-all duration-200 flex items-center desktop-only",style:{background:"var(--control-bg)",color:"var(--control-text)"},children:[s.jsx("span",{className:"text-sm font-medium mr-3",children:"同步"}),s.jsxs("label",{className:"inline-flex items-center",children:[s.jsx("input",{type:"checkbox",checked:t,onChange:r,className:"sr-only peer"}),s.jsx("div",{className:`relative w-14 h-7 rounded-full transition-all duration-200 
                      ${t?"bg-sky-500":"bg-gray-300 dark:bg-gray-700"} 
                      cursor-pointer
                      after:content-[''] after:absolute after:top-1 after:left-1 
                      after:bg-white after:rounded-full after:h-5 after:w-5 
                      after:shadow-md after:transition-all
                      ${t?"after:translate-x-7":"after:translate-x-0"}
                      peer-focus:ring-2 peer-focus:ring-sky-400 peer-focus:ring-opacity-50`,style:{background:t?"var(--control-highlight)":"var(--control-border)"},children:s.jsx("span",{className:"sr-only",children:"同步操作"})})]})]}),s.jsxs("div",{className:"px-4 py-1.5 rounded-full backdrop-blur-md transition-all duration-200 ml-2 flex items-center desktop-only",style:{background:h?"var(--control-highlight)":"var(--control-bg)",color:h?"white":"var(--control-text)"},children:[s.jsx("span",{className:"text-sm font-medium mr-3",children:"标注"}),s.jsxs("label",{className:"inline-flex items-center",children:[s.jsx("input",{type:"checkbox",checked:h,onChange:O=>u(O.target.checked),className:"sr-only peer"}),s.jsx("div",{className:`relative w-14 h-7 rounded-full transition-all duration-200 
                      cursor-pointer
                      after:content-[''] after:absolute after:top-1 after:left-1 
                      after:bg-white after:rounded-full after:h-5 after:w-5 
                      after:shadow-md after:transition-all
                      ${h?"after:translate-x-7":"after:translate-x-0"}
                      peer-focus:ring-2 peer-focus:ring-sky-400 peer-focus:ring-opacity-50`,style:{background:h?"rgba(255, 255, 255, 0.3)":"var(--control-border)"},children:s.jsx("span",{className:"sr-only",children:"开启标注"})})]})]}),s.jsxs("div",{className:"px-4 py-1.5 rounded-full backdrop-blur-md transition-all duration-200 ml-2 flex items-center desktop-only",style:{background:g?"var(--control-highlight)":"var(--control-bg)",color:g?"white":"var(--control-text)"},children:[s.jsx("span",{className:"text-sm font-medium mr-3",children:"关键帧"}),s.jsxs("label",{className:"inline-flex items-center",children:[s.jsx("input",{type:"checkbox",checked:g,onChange:O=>k(O.target.checked),className:"sr-only peer"}),s.jsx("div",{className:`relative w-14 h-7 rounded-full transition-all duration-200 
                      cursor-pointer
                      after:content-[''] after:absolute after:top-1 after:left-1 
                      after:bg-white after:rounded-full after:h-5 after:w-5 
                      after:shadow-md after:transition-all
                      ${g?"after:translate-x-7":"after:translate-x-0"}
                      peer-focus:ring-2 peer-focus:ring-sky-400 peer-focus:ring-opacity-50`,style:{background:g?"rgba(255, 255, 255, 0.3)":"var(--control-border)"},children:s.jsx("span",{className:"sr-only",children:"关键帧开关"})})]})]})]})]}),s.jsxs("div",{className:"flex items-center space-x-4 setting-bar",children:[a.length>0&&s.jsx("div",{className:"relative desktop-only",children:s.jsx(jr,{text:"截图",children:s.jsx("button",{onClick:m,disabled:xe,className:`p-3 rounded-full backdrop-blur-md transition-all duration-200 font-medium flex items-center
                      ${Q?"bg-gray-900 hover:bg-gray-800 text-white":"bg-sky-500/10 hover:bg-sky-500/20 text-gray-900"}
                      ${xe?"opacity-50 cursor-not-allowed":""}`,children:s.jsxs("svg",{className:"w-5 h-5",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[s.jsx("path",{d:"M23 19a2 2 0 0 1-2 2H3a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h4l2-3h6l2 3h4a2 2 0 0 1 2 2z"}),s.jsx("circle",{cx:"12",cy:"13",r:"4"})]})})})}),s.jsxs("div",{className:"relative desktop-only",children:[s.jsx(jr,{text:"主题选择",children:s.jsxs("button",{ref:F,onClick:()=>ae(O=>!O),className:`p-3 rounded-full backdrop-blur-md transition-all duration-200 font-medium flex items-center
                    ${Q?"bg-gray-900 hover:bg-gray-800 text-white":"bg-sky-500/10 hover:bg-sky-500/20 text-gray-900"}`,children:[n==="light"&&s.jsxs("svg",{className:"w-5 h-5",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[s.jsx("circle",{cx:"12",cy:"12",r:"5"}),s.jsx("path",{d:"M12 1v2M12 21v2M4.22 4.22l1.42 1.42M18.36 18.36l1.42 1.42M1 12h2M21 12h2M4.22 19.78l1.42-1.42M18.36 5.64l1.42-1.42"})]}),n==="dark"&&s.jsx("svg",{className:"w-5 h-5",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:s.jsx("path",{d:"M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"})}),n==="green"&&s.jsx("div",{className:"w-5 h-5 rounded-full",style:{background:"#00b140"}}),n==="blue"&&s.jsx("div",{className:"w-5 h-5 rounded-full",style:{background:"#0047AB"}})]})}),_&&dt.createPortal(s.jsx("div",{ref:E,className:"fixed min-w-[200px] rounded-3xl backdrop-blur-lg shadow-lg z-50 overflow-hidden pointer-events-auto",style:{top:`${A.top}px`,left:`${A.left}px`,transform:"translateX(-100%)",background:"var(--control-bg)",border:"1px solid var(--control-border)",color:"var(--control-text)",opacity:R?1:0,scale:R?"1":"0.95",transition:"opacity 0.2s, scale 0.2s",transformOrigin:"top right"},children:s.jsxs("div",{className:"py-2",children:[s.jsxs("button",{onClick:()=>{e("light"),ae(!1)},className:"w-full px-4 py-2 text-left hover:bg-black/10 dark:hover:bg-white/10 flex items-center",children:[s.jsx("div",{className:"w-6 h-6 rounded-full flex items-center justify-center bg-white mr-3",children:s.jsxs("svg",{className:"w-3.5 h-3.5",viewBox:"0 0 24 24",fill:"none",stroke:"#4b5563",strokeWidth:"2",children:[s.jsx("circle",{cx:"12",cy:"12",r:"5"}),s.jsx("path",{d:"M12 1v2M12 21v2M4.22 4.22l1.42 1.42M18.36 18.36l1.42 1.42M1 12h2M21 12h2M4.22 19.78l1.42-1.42M18.36 5.64l1.42-1.42"})]})}),s.jsx("span",{children:"浅色模式"}),n==="light"&&s.jsx("svg",{className:"w-4 h-4 ml-auto",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:s.jsx("path",{d:"M5 13l4 4L19 7",strokeLinecap:"round",strokeLinejoin:"round"})})]}),s.jsxs("button",{onClick:()=>{e("dark"),ae(!1)},className:"w-full px-4 py-2 text-left hover:bg-black/10 dark:hover:bg-white/10 flex items-center",children:[s.jsx("div",{className:"w-6 h-6 rounded-full flex items-center justify-center bg-gray-800 mr-3",children:s.jsx("svg",{className:"w-3.5 h-3.5",viewBox:"0 0 24 24",fill:"none",stroke:"#d1d5db",strokeWidth:"2",children:s.jsx("path",{d:"M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"})})}),s.jsx("span",{children:"深色模式"}),n==="dark"&&s.jsx("svg",{className:"w-4 h-4 ml-auto",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:s.jsx("path",{d:"M5 13l4 4L19 7",strokeLinecap:"round",strokeLinejoin:"round"})})]}),s.jsxs("button",{onClick:()=>{e("green"),ae(!1)},className:"w-full px-4 py-2 text-left hover:bg-black/10 dark:hover:bg-white/10 flex items-center",children:[s.jsx("div",{className:"w-6 h-6 rounded-full mr-3",style:{background:"#00b140"}}),s.jsx("span",{children:"绿幕模式"}),n==="green"&&s.jsx("svg",{className:"w-4 h-4 ml-auto",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:s.jsx("path",{d:"M5 13l4 4L19 7",strokeLinecap:"round",strokeLinejoin:"round"})})]}),s.jsxs("button",{onClick:()=>{e("blue"),ae(!1)},className:"w-full px-4 py-2 text-left hover:bg-black/10 dark:hover:bg-white/10 flex items-center",children:[s.jsx("div",{className:"w-6 h-6 rounded-full mr-3",style:{background:"#0047AB"}}),s.jsx("span",{children:"蓝幕模式"}),n==="blue"&&s.jsx("svg",{className:"w-4 h-4 ml-auto",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:s.jsx("path",{d:"M5 13l4 4L19 7",strokeLinecap:"round",strokeLinejoin:"round"})})]})]})}),document.body)]}),s.jsx(Pi,{})]})]}),s.jsxs("main",{className:"h-full pt-16",children:[a.length===0&&!l?s.jsx(ki,{}):s.jsx(Si,{images:a}),s.jsx(to,{})]}),s.jsx("footer",{className:"fixed bottom-0 left-0 right-0 p-6 backdrop-blur-md app-footer",style:{background:n==="green"||n==="blue"?"var(--control-bg)":"var(--bg-secondary)",borderTop:"1px solid var(--border-color)",color:"var(--control-text)"},children:s.jsxs("div",{className:"max-w-screen-xl mx-auto flex items-center justify-between",children:[s.jsxs("div",{className:"flex items-center space-x-2 group",children:[s.jsx("span",{className:"text-sm transition-all duration-300 group-hover:text-sky-500",children:"Created by Jim"}),s.jsx("span",{className:"text-sm opacity-60",children:"•"}),s.jsxs("a",{href:"https://space.bilibili.com/13818699",target:"_blank",rel:"noopener noreferrer",className:"flex items-center space-x-1.5 text-sm transition-all duration-300 hover:text-sky-500",children:[s.jsx("svg",{className:"w-4 h-4",viewBox:"0 0 24 24",fill:"currentColor",children:s.jsx("path",{d:"M17.813 4.653h.854c1.51.054 2.769.578 3.773 1.574 1.004.995 1.524 2.249 1.56 3.76v7.36c-.036 1.51-.556 2.769-1.56 3.773s-2.262 1.524-3.773 1.56H5.333c-1.51-.036-2.769-.556-3.773-1.56S.036 18.858 0 17.347v-7.36c.036-1.511.556-2.765 1.56-3.76 1.004-.996 2.262-1.52 3.773-1.574h.774l-1.174-1.12a1.234 1.234 0 0 1-.373-.906c0-.356.124-.658.373-.907l.027-.027c.267-.249.573-.373.92-.373.347 0 .653.124.92.373L9.653 4.44c.071.071.134.142.187.213h4.267a.836.836 0 0 1 .16-.213l2.853-2.747c.267-.249.573-.373.92-.373.347 0 .662.151.929.4.267.249.391.551.391.907 0 .355-.124.657-.373.906L17.813 4.653zM5.333 7.24c-.746.018-1.373.276-1.88.773-.506.498-.769 1.13-.786 1.894v7.52c.017.764.28 1.395.786 1.893.507.498 1.134.756 1.88.773h13.334c.746-.017 1.373-.275 1.88-.773.506-.498.769-1.129.786-1.893v-7.52c-.017-.765-.28-1.396-.786-1.894-.507-.497-1.134-.755-1.88-.773H5.333zM8 11.107c.373 0 .684.124.933.373.25.249.383.569.4.96v1.173c-.017.391-.15.711-.4.96-.249.25-.56.374-.933.374s-.684-.125-.933-.374c-.25-.249-.383-.569-.4-.96V12.44c0-.373.129-.689.386-.947.258-.257.574-.386.947-.386zm8 0c.373 0 .684.124.933.373.25.249.383.569.4.96v1.173c-.017.391-.15.711-.4.96-.249.25-.56.374-.933.374s-.684-.125-.933-.374c-.25-.249-.383-.569-.4-.96V12.44c0-.373.129-.689.386-.947.258-.257.574-.386.947-.386zm8 0c.373 0 .684.124.933.373.25.249.383.569.4.96v1.173c-.017.391-.15.711-.4.96-.249.25-.56.374-.933.374s-.684-.125-.933-.374c-.25-.249-.383-.569-.4-.96V12.44c0-.373.129-.689.386-.947.258-.257.574-.386.947-.386zm8 0c.373 0 .684.124.933.373.25.249.383.569.4.96v1.173c-.017.391-.15.711-.4.96-.249.25-.56.374-.933.374s-.684-.125-.933-.374c-.25-.249-.383-.569-.4-.96V12.44c0-.373.129-.689.386-.947.258-.257.574-.386.947-.386zm8 0c.373 0 .684.124.933.373.25.249.383.569.4.96v1.173c-.017.391-.15.711-.4.96-.249.25-.56.374-.933.374s-.684-.125-.933-.374c-.25-.249-.383-.569-.4-.96V12.44c0-.373.129-.689.386-.947.258-.257.574-.386.947-.386zm8 0c.373 0 .684.124.933.373.25.249.383.569.4.96v1.173c-.017.391-.15.711-.4.96-.249.25-.56.374-.933.374s-.684-.125-.933-.374c-.25-.249-.383-.569-.4-.96V12.44c0-.373.129-.689.386-.947.258-.257.574-.386.947-.386zm8 0c.373 0 .684.124.933.373.25.249.383.569.4.96v1.173c-.017.391-.15.711-.4.96-.249.25-.56.374-.933.374s-.684-.125-.933-.374c-.25-.249-.383-.569-.4-.96V12.44c0-.373.129-.689.386-.947.258-.257.574-.386.947-.386zm8 0c.373 0 .684.124.933.373.25.249.383.569.4.96v1.173c-.017.391-.15.711-.4.96-.249.25-.56.374-.933.374s-.684-.125-.933-.374c-.25-.249-.383-.569-.4-.96V12.44c0-.373.129-.689.386-.947.258-.257.574-.386.947-.386zm8 0c.373 0 .684.124.933.373.25.249.383.569.4.96v1.173c-.017.391-.15.711-.4.96-.249.25-.56.374-.933.374s-.684-.125-.933-.374c-.25-.249-.383-.569-.4-.96V12.44c.017-.391.15-.711.4-.96.249-.249.56-.373.933-.373Z"})}),s.jsx("span",{children:"@Jim超爱玩"})]}),s.jsx("span",{className:"text-sm opacity-60",children:"•"}),s.jsxs("span",{className:"text-sm opacity-60",children:["© ",new Date().getFullYear()]}),s.jsx("span",{className:"text-sm opacity-60",children:"•"}),s.jsx("span",{className:"text-sm opacity-60",children:"v1.2.0"}),s.jsx("span",{className:"text-sm opacity-60",children:"•"}),s.jsx("button",{className:"text-sm text-sky-500 hover:underline focus:outline-none focus:underline ml-2",onClick:()=>M(!0),style:{background:"none",border:"none",padding:0,cursor:"pointer"},children:"工具好用？打赏作者。"})]}),s.jsx("div",{className:"text-sm opacity-60",children:"Made with ❤️ in China"})]})}),y&&s.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/40",onClick:()=>M(!1),children:s.jsxs("div",{className:"bg-white dark:bg-gray-900 rounded-xl shadow-2xl p-8 flex flex-col items-center relative",onClick:O=>O.stopPropagation(),children:[s.jsx("span",{className:"absolute top-2 right-3 text-2xl text-gray-400 hover:text-gray-700 dark:hover:text-gray-200 cursor-pointer",onClick:()=>M(!1),children:"×"}),s.jsx("div",{className:"w-48 h-48 mb-4 flex items-center justify-center bg-gray-100 dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700",children:s.jsx("img",{src:"/placeholder-qrcode.jpeg",alt:"打赏二维码",className:"max-w-full max-h-full object-contain"})}),s.jsx("div",{className:"text-base font-medium text-gray-700 dark:text-gray-200",children:"感谢支持！"})]})}),P&&s.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/40",onClick:()=>N(!1),children:s.jsxs("div",{className:"bg-white dark:bg-gray-900 rounded-xl shadow-2xl p-8 max-w-md w-full flex flex-col relative",onClick:O=>O.stopPropagation(),children:[s.jsx("span",{className:"absolute top-2 right-3 text-2xl text-gray-400 hover:text-gray-700 dark:hover:text-gray-200 cursor-pointer",onClick:()=>N(!1),children:"×"}),s.jsx("h2",{className:"text-xl font-bold text-gray-800 dark:text-gray-100 mb-4",children:"关于 ComparePhotos"}),s.jsxs("div",{className:"mb-4",children:[s.jsx("h3",{className:"text-md font-semibold text-gray-700 dark:text-gray-300 mb-2",children:"版本信息"}),s.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:"当前版本: v1.2.0"})]}),s.jsxs("div",{className:"mb-4",children:[s.jsx("h3",{className:"text-md font-semibold text-gray-700 dark:text-gray-300 mb-2",children:"更新日志"}),s.jsxs("ul",{className:"text-sm text-gray-600 dark:text-gray-400 space-y-1 list-disc pl-5",children:[s.jsx("li",{children:"新增主题选择：可选择浅色、深色、跟随系统"}),s.jsx("li",{children:"新增关键帧功能：支持多帧缩放/平移动画，自动记录、平滑切换、快捷键切换与自动播放"}),s.jsx("li",{children:"关键帧时间设置面板UI与功能优化：样式与显示设置面板统一，现代毛玻璃圆角弹窗"}),s.jsx("li",{children:"停留时间、过渡时间为按钮组切换，选中高亮，过渡时间选项为快（0.5秒）、正常（1秒，默认）、慢（3秒）"})]})]}),s.jsxs("div",{className:"mb-4",children:[s.jsx("h3",{className:"text-md font-semibold text-gray-700 dark:text-gray-300 mb-2",children:"链接"}),s.jsxs("div",{className:"space-y-2",children:[s.jsxs("a",{href:"https://github.com/jimmcheung/photoCompare",target:"_blank",rel:"noopener noreferrer",className:"flex items-center space-x-2 text-sm text-sky-600 dark:text-sky-400 hover:underline",children:[s.jsx("svg",{className:"w-4 h-4",viewBox:"0 0 24 24",fill:"currentColor",children:s.jsx("path",{d:"M12 .297c-6.63 0-12 5.373-12 12 0 5.303 3.438 9.8 8.205 11.385.6.113.82-.258.82-.577 0-.285-.01-1.04-.015-2.04-3.338.724-4.042-1.61-4.042-1.61C4.422 18.07 3.633 17.7 3.633 17.7c-1.087-.744.084-.729.084-.729 1.205.084 1.838 1.236 1.838 1.236 1.07 1.835 2.809 1.305 3.495.998.108-.776.417-1.305.76-1.605-2.665-.3-5.466-1.332-5.466-5.93 0-1.31.465-2.38 1.235-3.22-.135-.303-.54-1.523.105-3.176 0 0 1.005-.322 3.3 1.23.96-.267 1.98-.399 3-.405 1.02.006 2.04.138 3 .405 2.28-1.552 3.285-1.23 3.285-1.23.645 1.653.24 2.873.12 3.176.765.84 1.23 1.91 1.23 3.22 0 4.61-2.805 5.625-5.475 5.92.42.36.81 1.096.81 2.22 0 1.606-.015 2.896-.015 3.286 0 .315.21.69.825.57C20.565 22.092 24 17.592 24 12.297c0-6.627-5.373-12-12-12"})}),s.jsx("span",{children:"GitHub 仓库"})]}),s.jsxs("a",{href:"https://space.bilibili.com/13818699",target:"_blank",rel:"noopener noreferrer",className:"flex items-center space-x-2 text-sm text-sky-600 dark:text-sky-400 hover:underline",children:[s.jsx("svg",{className:"w-4 h-4",viewBox:"0 0 24 24",fill:"currentColor",children:s.jsx("path",{d:"M17.813 4.653h.854c1.51.054 2.769.578 3.773 1.574 1.004.995 1.524 2.249 1.56 3.76v7.36c-.036 1.51-.556 2.769-1.56 3.773s-2.262 1.524-3.773 1.56H5.333c-1.51-.036-2.769-.556-3.773-1.56S.036 18.858 0 17.347v-7.36c.036-1.511.556-2.765 1.56-3.76 1.004-.996 2.262-1.52 3.773-1.574h.774l-1.174-1.12a1.234 1.234 0 0 1-.373-.906c0-.356.124-.658.373-.907l.027-.027c.267-.249.573-.373.92-.373.347 0 .653.124.92.373L9.653 4.44c.071.071.134.142.187.213h4.267a.836.836 0 0 1 .16-.213l2.853-2.747c.267-.249.573-.373.92-.373.347 0 .662.151.929.4.267.249.391.551.391.907 0 .355-.124.657-.373.906L17.813 4.653zM5.333 7.24c-.746.018-1.373.276-1.88.773-.506.498-.769 1.13-.786 1.894v7.52c.017.764.28 1.395.786 1.893.507.498 1.134.756 1.88.773h13.334c.746-.017 1.373-.275 1.88-.773.506-.498.769-1.129.786-1.893v-7.52c-.017-.765-.28-1.396-.786-1.894-.507-.497-1.134-.755-1.88-.773H5.333zM8 11.107c.373 0 .684.124.933.373.25.249.383.569.4.96v1.173c-.017.391-.15.711-.4.96-.249.25-.56.374-.933.374s-.684-.125-.933-.374c-.25-.249-.383-.569-.4-.96V12.44c0-.373.129-.689.386-.947.258-.257.574-.386.947-.386zm8 0c.373 0 .684.124.933.373.25.249.383.569.4.96v1.173c-.017.391-.15.711-.4.96-.249.25-.56.374-.933.374s-.684-.125-.933-.374c-.25-.249-.383-.569-.4-.96V12.44c0-.373.129-.689.386-.947.258-.257.574-.386.947-.386zm8 0c.373 0 .684.124.933.373.25.249.383.569.4.96v1.173c-.017.391-.15.711-.4.96-.249.25-.56.374-.933.374s-.684-.125-.933-.374c-.25-.249-.383-.569-.4-.96V12.44c0-.373.129-.689.386-.947.258-.257.574-.386.947-.386zm8 0c.373 0 .684.124.933.373.25.249.383.569.4.96v1.173c-.017.391-.15.711-.4.96-.249.25-.56.374-.933.374s-.684-.125-.933-.374c-.25-.249-.383-.569-.4-.96V12.44c0-.373.129-.689.386-.947.258-.257.574-.386.947-.386zm8 0c.373 0 .684.124.933.373.25.249.383.569.4.96v1.173c-.017.391-.15.711-.4.96-.249.25-.56.374-.933.374s-.684-.125-.933-.374c-.25-.249-.383-.569-.4-.96V12.44c0-.373.129-.689.386-.947.258-.257.574-.386.947-.386zm8 0c.373 0 .684.124.933.373.25.249.383.569.4.96v1.173c-.017.391-.15.711-.4.96-.249.25-.56.374-.933.374s-.684-.125-.933-.374c-.25-.249-.383-.569-.4-.96V12.44c0-.373.129-.689.386-.947.258-.257.574-.386.947-.386zm8 0c.373 0 .684.124.933.373.25.249.383.569.4.96v1.173c-.017.391-.15.711-.4.96-.249.25-.56.374-.933.374s-.684-.125-.933-.374c-.25-.249-.383-.569-.4-.96V12.44c0-.373.129-.689.386-.947.258-.257.574-.386.947-.386zm8 0c.373 0 .684.124.933.373.25.249.383.569.4.96v1.173c-.017.391-.15.711-.4.96-.249.25-.56.374-.933.374s-.684-.125-.933-.374c-.25-.249-.383-.569-.4-.96V12.44c0-.373.129-.689.386-.947.258-.257.574-.386.947-.386zm8 0c.373 0 .684.124.933.373.25.249.383.569.4.96v1.173c-.017.391-.15.711-.4.96-.249.25-.56.374-.933.374s-.684-.125-.933-.374c-.25-.249-.383-.569-.4-.96V12.44c.017-.391.15-.711.4-.96.249-.249.56-.373.933-.373Z"})}),s.jsx("span",{children:"B站: @Jim超爱玩"})]})]})]}),s.jsxs("div",{className:"mb-4",children:[s.jsx("h3",{className:"text-md font-semibold text-gray-700 dark:text-gray-300 mb-2",children:"鸣谢"}),s.jsxs("a",{href:"https://space.bilibili.com/96625571",target:"_blank",rel:"noopener noreferrer",className:"flex items-center space-x-2 text-sm text-sky-600 dark:text-sky-400 hover:underline",children:[s.jsx("svg",{className:"w-4 h-4",viewBox:"0 0 24 24",fill:"currentColor",children:s.jsx("path",{d:"M17.813 4.653h.854c1.51.054 2.769.578 3.773 1.574 1.004.995 1.524 2.249 1.56 3.76v7.36c-.036 1.51-.556 2.769-1.56 3.773s-2.262 1.524-3.773 1.56H5.333c-1.51-.036-2.769-.556-3.773-1.56S.036 18.858 0 17.347v-7.36c.036-1.511.556-2.765 1.56-3.76 1.004-.996 2.262-1.52 3.773-1.574h.774l-1.174-1.12a1.234 1.234 0 0 1-.373-.906c0-.356.124-.658.373-.907l.027-.027c.267-.249.573-.373.92-.373.347 0 .653.124.92.373L9.653 4.44c.071.071.134.142.187.213h4.267a.836.836 0 0 1 .16-.213l2.853-2.747c.267-.249.573-.373.92-.373.347 0 .662.151.929.4.267.249.391.551.391.907 0 .355-.124.657-.373.906L17.813 4.653zM5.333 7.24c-.746.018-1.373.276-1.88.773-.506.498-.769 1.13-.786 1.894v7.52c.017.764.28 1.395.786 1.893.507.498 1.134.756 1.88.773h13.334c.746-.017 1.373-.275 1.88-.773.506-.498.769-1.129.786-1.893v-7.52c-.017-.765-.28-1.396-.786-1.894-.507-.497-1.134-.755-1.88-.773H5.333zM8 11.107c.373 0 .684.124.933.373.25.249.383.569.4.96v1.173c-.017.391-.15.711-.4.96-.249.25-.56.374-.933.374s-.684-.125-.933-.374c-.25-.249-.383-.569-.4-.96V12.44c0-.373.129-.689.386-.947.258-.257.574-.386.947-.386zm8 0c.373 0 .684.124.933.373.25.249.383.569.4.96v1.173c-.017.391-.15.711-.4.96-.249.25-.56.374-.933.374s-.684-.125-.933-.374c-.25-.249-.383-.569-.4-.96V12.44c0-.373.129-.689.386-.947.258-.257.574-.386.947-.386zm8 0c.373 0 .684.124.933.373.25.249.383.569.4.96v1.173c-.017.391-.15.711-.4.96-.249.25-.56.374-.933.374s-.684-.125-.933-.374c-.25-.249-.383-.569-.4-.96V12.44c0-.373.129-.689.386-.947.258-.257.574-.386.947-.386zm8 0c.373 0 .684.124.933.373.25.249.383.569.4.96v1.173c-.017.391-.15.711-.4.96-.249.25-.56.374-.933.374s-.684-.125-.933-.374c-.25-.249-.383-.569-.4-.96V12.44c0-.373.129-.689.386-.947.258-.257.574-.386.947-.386zm8 0c.373 0 .684.124.933.373.25.249.383.569.4.96v1.173c-.017.391-.15.711-.4.96-.249.25-.56.374-.933.374s-.684-.125-.933-.374c-.25-.249-.383-.569-.4-.96V12.44c0-.373.129-.689.386-.947.258-.257.574-.386.947-.386zm8 0c.373 0 .684.124.933.373.25.249.383.569.4.96v1.173c-.017.391-.15.711-.4.96-.249.25-.56.374-.933.374s-.684-.125-.933-.374c-.25-.249-.383-.569-.4-.96V12.44c0-.373.129-.689.386-.947.258-.257.574-.386.947-.386zm8 0c.373 0 .684.124.933.373.25.249.383.569.4.96v1.173c-.017.391-.15.711-.4.96-.249.25-.56.374-.933.374s-.684-.125-.933-.374c-.25-.249-.383-.569-.4-.96V12.44c0-.373.129-.689.386-.947.258-.257.574-.386.947-.386zm8 0c.373 0 .684.124.933.373.25.249.383.569.4.96v1.173c-.017.391-.15.711-.4.96-.249.25-.56.374-.933.374s-.684-.125-.933-.374c-.25-.249-.383-.569-.4-.96V12.44c.017-.391.15-.711.4-.96.249-.249.56-.373.933-.373Z"})}),s.jsx("span",{children:"B站：@熊熊Bearie"})]})]}),s.jsxs("div",{className:"text-sm text-gray-500 dark:text-gray-400 mt-2",children:["© ",new Date().getFullYear()," Jim. 保留所有权利。"]})]})}),D&&s.jsx("div",{className:"fixed inset-0 flex items-center justify-center pointer-events-none",children:s.jsx("div",{className:"bg-black bg-opacity-75 text-white px-6 py-3 rounded-lg",children:"按 ESC 退出演示模式"})}),s.jsx(so,{isOpen:V,onClose:()=>ee(!1),themeMode:n,setThemeMode:e,syncZoom:t,toggleSyncZoom:r,images:a}),he&&s.jsx(ro,{})]})})};on.createRoot(document.getElementById("root")).render(s.jsx(ie.StrictMode,{children:s.jsx(io,{})}));
